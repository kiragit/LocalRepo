<!DOCTYPE html>

<html>
<head>
  <title>mocha.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>mocha.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>CommonJS require()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">require</span><span class="hljs-params">(p)</span></span>{
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>.resolve(p)
      , mod = <span class="hljs-built_in">require</span>.modules[path];
    <span class="hljs-keyword">if</span> (!mod) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'failed to require "'</span> + p + <span class="hljs-string">'"'</span>);
    <span class="hljs-keyword">if</span> (!mod.exports) {
      mod.exports = {};
      mod.call(mod.exports, mod, mod.exports, <span class="hljs-built_in">require</span>.relative(path));
    }
    <span class="hljs-keyword">return</span> mod.exports;
  }

<span class="hljs-built_in">require</span>.modules = {};

<span class="hljs-built_in">require</span>.resolve = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(path)</span></span>{
    <span class="hljs-keyword">var</span> orig = path
      , reg = path + <span class="hljs-string">'.js'</span>
      , index = path + <span class="hljs-string">'/index.js'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.modules[reg] &amp;&amp; reg
      || <span class="hljs-built_in">require</span>.modules[index] &amp;&amp; index
      || orig;
  };

<span class="hljs-built_in">require</span>.register = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(path, fn)</span></span>{
    <span class="hljs-built_in">require</span>.modules[path] = fn;
  };

<span class="hljs-built_in">require</span>.relative = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(parent)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(p)</span></span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-string">'.'</span> != p.charAt(<span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>(p);
      
      <span class="hljs-keyword">var</span> path = parent.split(<span class="hljs-string">'/'</span>)
        , segs = p.split(<span class="hljs-string">'/'</span>);
      path.pop();
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; segs.length; i++) {
        <span class="hljs-keyword">var</span> seg = segs[i];
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'..'</span> == seg) path.pop();
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">'.'</span> != seg) path.push(seg);
      }

      <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>(path.join(<span class="hljs-string">'/'</span>));
    };
  };


<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"browser/debug.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type)</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    
  }
};
}); <span class="hljs-comment">// module: browser/debug.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"browser/diff.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

}); <span class="hljs-comment">// module: browser/diff.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"browser/events.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module exports.
 */</span>

exports.EventEmitter = EventEmitter;

<span class="hljs-comment">/**
 * Check if `obj` is an array.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isArray</span><span class="hljs-params">(obj)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'[object Array]'</span> == {}.toString.call(obj);
}

<span class="hljs-comment">/**
 * Event emitter constructor.
 *
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventEmitter</span><span class="hljs-params">()</span></span>{};

<span class="hljs-comment">/**
 * Adds a listener.
 *
 * @api public
 */</span>

EventEmitter.prototype.on = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, fn)</span> </span>{
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$events) {
    <span class="hljs-keyword">this</span>.$events = {};
  }

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$events[name]) {
    <span class="hljs-keyword">this</span>.$events[name] = fn;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isArray(<span class="hljs-keyword">this</span>.$events[name])) {
    <span class="hljs-keyword">this</span>.$events[name].push(fn);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.$events[name] = [<span class="hljs-keyword">this</span>.$events[name], fn];
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

EventEmitter.prototype.addListener = EventEmitter.prototype.on;

<span class="hljs-comment">/**
 * Adds a volatile listener.
 *
 * @api public
 */</span>

EventEmitter.prototype.once = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, fn)</span> </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span> <span class="hljs-params">()</span> </span>{
    self.removeListener(name, on);
    fn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  };

  on.listener = fn;
  <span class="hljs-keyword">this</span>.on(name, on);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Removes a listener.
 *
 * @api public
 */</span>

EventEmitter.prototype.removeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, fn)</span> </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$events &amp;&amp; <span class="hljs-keyword">this</span>.$events[name]) {
    <span class="hljs-keyword">var</span> list = <span class="hljs-keyword">this</span>.$events[name];

    <span class="hljs-keyword">if</span> (isArray(list)) {
      <span class="hljs-keyword">var</span> pos = -<span class="hljs-number">1</span>;

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = list.length; i &lt; l; i++) {
        <span class="hljs-keyword">if</span> (list[i] === fn || (list[i].listener &amp;&amp; list[i].listener === fn)) {
          pos = i;
          <span class="hljs-keyword">break</span>;
        }
      }

      <span class="hljs-keyword">if</span> (pos &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
      }

      list.splice(pos, <span class="hljs-number">1</span>);

      <span class="hljs-keyword">if</span> (!list.length) {
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.$events[name];
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (list === fn || (list.listener &amp;&amp; list.listener === fn)) {
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.$events[name];
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Removes all listeners for an event.
 *
 * @api public
 */</span>

EventEmitter.prototype.removeAllListeners = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{
  <span class="hljs-keyword">if</span> (name === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">this</span>.$events = {};
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$events &amp;&amp; <span class="hljs-keyword">this</span>.$events[name]) {
    <span class="hljs-keyword">this</span>.$events[name] = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Gets all listeners for a certain event.
 *
 * @api public
 */</span>

EventEmitter.prototype.listeners = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$events) {
    <span class="hljs-keyword">this</span>.$events = {};
  }

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$events[name]) {
    <span class="hljs-keyword">this</span>.$events[name] = [];
  }

  <span class="hljs-keyword">if</span> (!isArray(<span class="hljs-keyword">this</span>.$events[name])) {
    <span class="hljs-keyword">this</span>.$events[name] = [<span class="hljs-keyword">this</span>.$events[name]];
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$events[name];
};

<span class="hljs-comment">/**
 * Emits an event.
 *
 * @api public
 */</span>

EventEmitter.prototype.emit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> </span>{
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$events) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>.$events[name];

  <span class="hljs-keyword">if</span> (!handler) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);

  <span class="hljs-keyword">if</span> (<span class="hljs-string">'function'</span> == <span class="hljs-keyword">typeof</span> handler) {
    handler.apply(<span class="hljs-keyword">this</span>, args);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isArray(handler)) {
    <span class="hljs-keyword">var</span> listeners = handler.slice();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = listeners.length; i &lt; l; i++) {
      listeners[i].apply(<span class="hljs-keyword">this</span>, args);
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};
}); <span class="hljs-comment">// module: browser/events.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"browser/fs.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

}); <span class="hljs-comment">// module: browser/fs.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"browser/path.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

}); <span class="hljs-comment">// module: browser/path.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"browser/progress.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Expose `Progress`.
 */</span>

<span class="hljs-built_in">module</span>.exports = Progress;

<span class="hljs-comment">/**
 * Initialize a new `Progress` indicator.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Progress</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">this</span>.percent = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">this</span>.size(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">this</span>.fontSize(<span class="hljs-number">11</span>);
  <span class="hljs-keyword">this</span>.font(<span class="hljs-string">'helvetica, arial, sans-serif'</span>);
}

<span class="hljs-comment">/**
 * Set progress size to `n`.
 *
 * @param {Number} n
 * @return {Progress} for chaining
 * @api public
 */</span>

Progress.prototype.size = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span></span>{
  <span class="hljs-keyword">this</span>._size = n;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set text to `str`.
 *
 * @param {String} str
 * @return {Progress} for chaining
 * @api public
 */</span>

Progress.prototype.text = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">this</span>._text = str;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set font size to `n`.
 *
 * @param {Number} n
 * @return {Progress} for chaining
 * @api public
 */</span>

Progress.prototype.fontSize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span></span>{
  <span class="hljs-keyword">this</span>._fontSize = n;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set font `family`.
 *
 * @param {String} family
 * @return {Progress} for chaining
 */</span>

Progress.prototype.font = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(family)</span></span>{
  <span class="hljs-keyword">this</span>._font = family;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Update percentage to `n`.
 *
 * @param {Number} n
 * @return {Progress} for chaining
 */</span>

Progress.prototype.update = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span></span>{
  <span class="hljs-keyword">this</span>.percent = n;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Draw on `ctx`.
 *
 * @param {CanvasRenderingContext2d} ctx
 * @return {Progress} for chaining
 */</span>

Progress.prototype.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx)</span></span>{
  <span class="hljs-keyword">var</span> percent = <span class="hljs-built_in">Math</span>.min(<span class="hljs-keyword">this</span>.percent, <span class="hljs-number">100</span>)
    , size = <span class="hljs-keyword">this</span>._size
    , half = size / <span class="hljs-number">2</span>
    , x = half
    , y = half
    , rad = half - <span class="hljs-number">1</span>
    , fontSize = <span class="hljs-keyword">this</span>._fontSize;

  ctx.font = fontSize + <span class="hljs-string">'px '</span> + <span class="hljs-keyword">this</span>._font;

  <span class="hljs-keyword">var</span> angle = <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> * (percent / <span class="hljs-number">100</span>);
  ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, size, size);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>outer circle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctx.strokeStyle = <span class="hljs-string">'#9f9f9f'</span>;
  ctx.beginPath();
  ctx.arc(x, y, rad, <span class="hljs-number">0</span>, angle, <span class="hljs-literal">false</span>);
  ctx.stroke();</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>inner circle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctx.strokeStyle = <span class="hljs-string">'#eee'</span>;
  ctx.beginPath();
  ctx.arc(x, y, rad - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, angle, <span class="hljs-literal">true</span>);
  ctx.stroke();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> text = <span class="hljs-keyword">this</span>._text || (percent | <span class="hljs-number">0</span>) + <span class="hljs-string">'%'</span>
    , w = ctx.measureText(text).width;

  ctx.fillText(
      text
    , x - w / <span class="hljs-number">2</span> + <span class="hljs-number">1</span>
    , y + fontSize / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

}); <span class="hljs-comment">// module: browser/progress.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"browser/tty.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

exports.isatty = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

exports.getWindowSize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">return</span> [<span class="hljs-built_in">window</span>.innerHeight, <span class="hljs-built_in">window</span>.innerWidth];
};
}); <span class="hljs-comment">// module: browser/tty.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"context.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Expose `Context`.
 */</span>

<span class="hljs-built_in">module</span>.exports = Context;

<span class="hljs-comment">/**
 * Initialize a new `Context`.
 *
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Context</span><span class="hljs-params">()</span></span>{}

<span class="hljs-comment">/**
 * Set or get the context `Runnable` to `runnable`.
 *
 * @param {Runnable} runnable
 * @return {Context}
 * @api private
 */</span>

Context.prototype.runnable = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(runnable)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == <span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._runnable;
  <span class="hljs-keyword">this</span>.test = <span class="hljs-keyword">this</span>._runnable = runnable;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set test timeout `ms`.
 *
 * @param {Number} ms
 * @return {Context} self
 * @api private
 */</span>

Context.prototype.timeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ms)</span></span>{
  <span class="hljs-keyword">this</span>.runnable().timeout(ms);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set test slowness threshold `ms`.
 *
 * @param {Number} ms
 * @return {Context} self
 * @api private
 */</span>

Context.prototype.slow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ms)</span></span>{
  <span class="hljs-keyword">this</span>.runnable().slow(ms);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Inspect the context void of `._runnable`.
 *
 * @return {String}
 * @api private
 */</span>

Context.prototype.inspect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, val)</span></span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'_runnable'</span> == key) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'test'</span> == key) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">return</span> val;
  }, <span class="hljs-number">2</span>);
};

}); <span class="hljs-comment">// module: context.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"hook.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Runnable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./runnable'</span>);

<span class="hljs-comment">/**
 * Expose `Hook`.
 */</span>

<span class="hljs-built_in">module</span>.exports = Hook;

<span class="hljs-comment">/**
 * Initialize a new `Hook` with the given `title` and callback `fn`.
 *
 * @param {String} title
 * @param {Function} fn
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Hook</span><span class="hljs-params">(title, fn)</span> </span>{
  Runnable.call(<span class="hljs-keyword">this</span>, title, fn);
  <span class="hljs-keyword">this</span>.type = <span class="hljs-string">'hook'</span>;
}

<span class="hljs-comment">/**
 * Inherit from `Runnable.prototype`.
 */</span>

Hook.prototype = <span class="hljs-keyword">new</span> Runnable;
Hook.prototype.constructor = Hook;


<span class="hljs-comment">/**
 * Get or set the test `err`.
 *
 * @param {Error} err
 * @return {Error}
 * @api public
 */</span>

Hook.prototype.error = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == <span class="hljs-built_in">arguments</span>.length) {
    <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">this</span>._error;
    <span class="hljs-keyword">this</span>._error = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> err;
  }

  <span class="hljs-keyword">this</span>._error = err;
};


}); <span class="hljs-comment">// module: hook.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"interfaces/bdd.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../suite'</span>)
  , Test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../test'</span>);

<span class="hljs-comment">/**
 * BDD-style interface:
 * 
 *      describe('Array', function(){
 *        describe('#indexOf()', function(){
 *          it('should return -1 when not present', function(){
 *
 *          });
 *
 *          it('should return the index when present', function(){
 *
 *          });
 *        });
 *      });
 * 
 */</span>

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
  <span class="hljs-keyword">var</span> suites = [suite];

  suite.on(<span class="hljs-string">'pre-require'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context, file, mocha)</span></span>{

    <span class="hljs-comment">/**
     * Execute before running tests.
     */</span>

    context.before = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].beforeAll(fn);
    };

    <span class="hljs-comment">/**
     * Execute after running tests.
     */</span>

    context.after = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].afterAll(fn);
    };

    <span class="hljs-comment">/**
     * Execute before each test case.
     */</span>

    context.beforeEach = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].beforeEach(fn);
    };

    <span class="hljs-comment">/**
     * Execute after each test case.
     */</span>

    context.afterEach = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].afterEach(fn);
    };

    <span class="hljs-comment">/**
     * Describe a "suite" with the given `title`
     * and callback `fn` containing nested suites
     * and/or tests.
     */</span>
  
    context.describe = context.context = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> suite = Suite.create(suites[<span class="hljs-number">0</span>], title);
      suites.unshift(suite);
      fn();
      suites.shift();
      <span class="hljs-keyword">return</span> suite;
    };

    <span class="hljs-comment">/**
     * Pending describe.
     */</span>

    context.xdescribe =
    context.xcontext =
    context.describe.skip = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> suite = Suite.create(suites[<span class="hljs-number">0</span>], title);
      suite.pending = <span class="hljs-literal">true</span>;
      suites.unshift(suite);
      fn();
      suites.shift();
    };

    <span class="hljs-comment">/**
     * Exclusive suite.
     */</span>

    context.describe.only = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> suite = context.describe(title, fn);
      mocha.grep(suite.fullTitle());
    };

    <span class="hljs-comment">/**
     * Describe a specification or test-case
     * with the given `title` and callback `fn`
     * acting as a thunk.
     */</span>

    context.it = context.specify = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> suite = suites[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">if</span> (suite.pending) <span class="hljs-keyword">var</span> fn = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">var</span> test = <span class="hljs-keyword">new</span> Test(title, fn);
      suite.addTest(test);
      <span class="hljs-keyword">return</span> test;
    };

    <span class="hljs-comment">/**
     * Exclusive test-case.
     */</span>

    context.it.only = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> test = context.it(title, fn);
      mocha.grep(test.fullTitle());
    };

    <span class="hljs-comment">/**
     * Pending test case.
     */</span>

    context.xit =
    context.xspecify =
    context.it.skip = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title)</span></span>{
      context.it(title);
    };
  });
};

}); <span class="hljs-comment">// module: interfaces/bdd.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"interfaces/exports.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../suite'</span>)
  , Test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../test'</span>);

<span class="hljs-comment">/**
 * TDD-style interface:
 * 
 *     exports.Array = {
 *       '#indexOf()': {
 *         'should return -1 when the value is not present': function(){
 *           
 *         },
 *
 *         'should return the correct index when the value is present': function(){
 *           
 *         }
 *       }
 *     };
 * 
 */</span>

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
  <span class="hljs-keyword">var</span> suites = [suite];

  suite.on(<span class="hljs-string">'require'</span>, visit);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">visit</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">var</span> suite;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> obj) {
      <span class="hljs-keyword">if</span> (<span class="hljs-string">'function'</span> == <span class="hljs-keyword">typeof</span> obj[key]) {
        <span class="hljs-keyword">var</span> fn = obj[key];
        <span class="hljs-keyword">switch</span> (key) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">'before'</span>:
            suites[<span class="hljs-number">0</span>].beforeAll(fn);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'after'</span>:
            suites[<span class="hljs-number">0</span>].afterAll(fn);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'beforeEach'</span>:
            suites[<span class="hljs-number">0</span>].beforeEach(fn);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'afterEach'</span>:
            suites[<span class="hljs-number">0</span>].afterEach(fn);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">default</span>:
            suites[<span class="hljs-number">0</span>].addTest(<span class="hljs-keyword">new</span> Test(key, fn));
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> suite = Suite.create(suites[<span class="hljs-number">0</span>], key);
        suites.unshift(suite);
        visit(obj[key]);
        suites.shift();
      }
    }
  }
};
}); <span class="hljs-comment">// module: interfaces/exports.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"interfaces/index.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

exports.bdd = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./bdd'</span>);
exports.tdd = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./tdd'</span>);
exports.qunit = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./qunit'</span>);
exports.exports = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./exports'</span>);

}); <span class="hljs-comment">// module: interfaces/index.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"interfaces/qunit.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../suite'</span>)
  , Test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../test'</span>);

<span class="hljs-comment">/**
 * QUnit-style interface:
 * 
 *     suite('Array');
 *     
 *     test('#length', function(){
 *       var arr = [1,2,3];
 *       ok(arr.length == 3);
 *     });
 *     
 *     test('#indexOf()', function(){
 *       var arr = [1,2,3];
 *       ok(arr.indexOf(1) == 0);
 *       ok(arr.indexOf(2) == 1);
 *       ok(arr.indexOf(3) == 2);
 *     });
 *     
 *     suite('String');
 *     
 *     test('#length', function(){
 *       ok('foo'.length == 3);
 *     });
 * 
 */</span>

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
  <span class="hljs-keyword">var</span> suites = [suite];

  suite.on(<span class="hljs-string">'pre-require'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context)</span></span>{

    <span class="hljs-comment">/**
     * Execute before running tests.
     */</span>

    context.before = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].beforeAll(fn);
    };

    <span class="hljs-comment">/**
     * Execute after running tests.
     */</span>

    context.after = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].afterAll(fn);
    };

    <span class="hljs-comment">/**
     * Execute before each test case.
     */</span>

    context.beforeEach = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].beforeEach(fn);
    };

    <span class="hljs-comment">/**
     * Execute after each test case.
     */</span>

    context.afterEach = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].afterEach(fn);
    };

    <span class="hljs-comment">/**
     * Describe a "suite" with the given `title`.
     */</span>
  
    context.suite = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title)</span></span>{
      <span class="hljs-keyword">if</span> (suites.length &gt; <span class="hljs-number">1</span>) suites.shift();
      <span class="hljs-keyword">var</span> suite = Suite.create(suites[<span class="hljs-number">0</span>], title);
      suites.unshift(suite);
    };

    <span class="hljs-comment">/**
     * Describe a specification or test-case
     * with the given `title` and callback `fn`
     * acting as a thunk.
     */</span>

    context.test = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      suites[<span class="hljs-number">0</span>].addTest(<span class="hljs-keyword">new</span> Test(title, fn));
    };
  });
};

}); <span class="hljs-comment">// module: interfaces/qunit.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"interfaces/tdd.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../suite'</span>)
  , Test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../test'</span>);

<span class="hljs-comment">/**
 * TDD-style interface:
 *
 *      suite('Array', function(){
 *        suite('#indexOf()', function(){
 *          suiteSetup(function(){
 *
 *          });
 *          
 *          test('should return -1 when not present', function(){
 *
 *          });
 *
 *          test('should return the index when present', function(){
 *
 *          });
 *
 *          suiteTeardown(function(){
 *
 *          });
 *        });
 *      });
 *
 */</span>

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
  <span class="hljs-keyword">var</span> suites = [suite];

  suite.on(<span class="hljs-string">'pre-require'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context, file, mocha)</span></span>{

    <span class="hljs-comment">/**
     * Execute before each test case.
     */</span>

    context.setup = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].beforeEach(fn);
    };

    <span class="hljs-comment">/**
     * Execute after each test case.
     */</span>

    context.teardown = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].afterEach(fn);
    };

    <span class="hljs-comment">/**
     * Execute before the suite.
     */</span>

    context.suiteSetup = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].beforeAll(fn);
    };

    <span class="hljs-comment">/**
     * Execute after the suite.
     */</span>

    context.suiteTeardown = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
      suites[<span class="hljs-number">0</span>].afterAll(fn);
    };

    <span class="hljs-comment">/**
     * Describe a "suite" with the given `title`
     * and callback `fn` containing nested suites
     * and/or tests.
     */</span>

    context.suite = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> suite = Suite.create(suites[<span class="hljs-number">0</span>], title);
      suites.unshift(suite);
      fn();
      suites.shift();
      <span class="hljs-keyword">return</span> suite;
    };

    <span class="hljs-comment">/**
     * Exclusive test-case.
     */</span>

    context.suite.only = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> suite = context.suite(title, fn);
      mocha.grep(suite.fullTitle());
    };

    <span class="hljs-comment">/**
     * Describe a specification or test-case
     * with the given `title` and callback `fn`
     * acting as a thunk.
     */</span>

    context.test = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> test = <span class="hljs-keyword">new</span> Test(title, fn);
      suites[<span class="hljs-number">0</span>].addTest(test);
      <span class="hljs-keyword">return</span> test;
    };

    <span class="hljs-comment">/**
     * Exclusive test-case.
     */</span>

    context.test.only = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(title, fn)</span></span>{
      <span class="hljs-keyword">var</span> test = context.test(title, fn);
      mocha.grep(test.fullTitle());
    };
  });
};

}); <span class="hljs-comment">// module: interfaces/tdd.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"mocha.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{
<span class="hljs-comment">/*!
 * mocha
 * Copyright(c) 2011 TJ Holowaychuk &lt;tj@vision-media.ca&gt;
 * MIT Licensed
 */</span>

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/path'</span>)
  , utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>);

<span class="hljs-comment">/**
 * Expose `Mocha`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Mocha;

<span class="hljs-comment">/**
 * Expose internals.
 */</span>

exports.utils = utils;
exports.interfaces = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./interfaces'</span>);
exports.reporters = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./reporters'</span>);
exports.Runnable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./runnable'</span>);
exports.Context = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./context'</span>);
exports.Runner = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./runner'</span>);
exports.Suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./suite'</span>);
exports.Hook = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./hook'</span>);
exports.Test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./test'</span>);

<span class="hljs-comment">/**
 * Return image `name` path.
 *
 * @param {String} name
 * @return {String}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">image</span><span class="hljs-params">(name)</span> </span>{
  <span class="hljs-keyword">return</span> __dirname + <span class="hljs-string">'/../images/'</span> + name + <span class="hljs-string">'.png'</span>;
}

<span class="hljs-comment">/**
 * Setup mocha with `options`.
 *
 * Options:
 *
 *   - `ui` name "bdd", "tdd", "exports" etc
 *   - `reporter` reporter instance, defaults to `mocha.reporters.Dot`
 *   - `globals` array of accepted globals
 *   - `timeout` timeout in milliseconds
 *   - `slow` milliseconds to wait before considering a test slow
 *   - `ignoreLeaks` ignore global leaks
 *   - `grep` string or regexp to filter tests with
 *
 * @param {Object} options
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Mocha</span><span class="hljs-params">(options)</span> </span>{
  options = options || {};
  <span class="hljs-keyword">this</span>.files = [];
  <span class="hljs-keyword">this</span>.options = options;
  <span class="hljs-keyword">this</span>.grep(options.grep);
  <span class="hljs-keyword">this</span>.suite = <span class="hljs-keyword">new</span> exports.Suite(<span class="hljs-string">''</span>, <span class="hljs-keyword">new</span> exports.Context);
  <span class="hljs-keyword">this</span>.ui(options.ui);
  <span class="hljs-keyword">this</span>.reporter(options.reporter);
  <span class="hljs-keyword">if</span> (options.timeout) <span class="hljs-keyword">this</span>.timeout(options.timeout);
  <span class="hljs-keyword">if</span> (options.slow) <span class="hljs-keyword">this</span>.slow(options.slow);
}

<span class="hljs-comment">/**
 * Add test `file`.
 *
 * @param {String} file
 * @api public
 */</span>

Mocha.prototype.addFile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file)</span></span>{
  <span class="hljs-keyword">this</span>.files.push(file);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set reporter to `reporter`, defaults to "dot".
 *
 * @param {String|Function} reporter name of a reporter or a reporter constructor
 * @api public
 */</span>

Mocha.prototype.reporter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(reporter)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'function'</span> == <span class="hljs-keyword">typeof</span> reporter) {
    <span class="hljs-keyword">this</span>._reporter = reporter;
  } <span class="hljs-keyword">else</span> {
    reporter = reporter || <span class="hljs-string">'dot'</span>;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">this</span>._reporter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./reporters/'</span> + reporter);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">this</span>._reporter = <span class="hljs-built_in">require</span>(reporter);
    }
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._reporter) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'invalid reporter "'</span> + reporter + <span class="hljs-string">'"'</span>);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set test UI `name`, defaults to "bdd".
 *
 * @param {String} bdd
 * @api public
 */</span>

Mocha.prototype.ui = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span></span>{
  name = name || <span class="hljs-string">'bdd'</span>;
  <span class="hljs-keyword">this</span>._ui = exports.interfaces[name];
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._ui) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'invalid interface "'</span> + name + <span class="hljs-string">'"'</span>);
  <span class="hljs-keyword">this</span>._ui = <span class="hljs-keyword">this</span>._ui(<span class="hljs-keyword">this</span>.suite);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Load registered files.
 *
 * @api private
 */</span>

Mocha.prototype.loadFiles = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> suite = <span class="hljs-keyword">this</span>.suite;
  <span class="hljs-keyword">var</span> pending = <span class="hljs-keyword">this</span>.files.length;
  <span class="hljs-keyword">this</span>.files.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file)</span></span>{
    file = path.resolve(file);
    suite.emit(<span class="hljs-string">'pre-require'</span>, global, file, self);
    suite.emit(<span class="hljs-string">'require'</span>, <span class="hljs-built_in">require</span>(file), file, self);
    suite.emit(<span class="hljs-string">'post-require'</span>, global, file, self);
    --pending || (fn &amp;&amp; fn());
  });
};

<span class="hljs-comment">/**
 * Enable growl support.
 *
 * @api private
 */</span>

Mocha.prototype._growl = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(runner, reporter)</span> </span>{
  <span class="hljs-keyword">var</span> notify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'growl'</span>);

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> stats = reporter.stats;
    <span class="hljs-keyword">if</span> (stats.failures) {
      <span class="hljs-keyword">var</span> msg = stats.failures + <span class="hljs-string">' of '</span> + runner.total + <span class="hljs-string">' tests failed'</span>;
      notify(msg, { name: <span class="hljs-string">'mocha'</span>, title: <span class="hljs-string">'Failed'</span>, image: image(<span class="hljs-string">'error'</span>) });
    } <span class="hljs-keyword">else</span> {
      notify(stats.passes + <span class="hljs-string">' tests passed in '</span> + stats.duration + <span class="hljs-string">'ms'</span>, {
          name: <span class="hljs-string">'mocha'</span>
        , title: <span class="hljs-string">'Passed'</span>
        , image: image(<span class="hljs-string">'ok'</span>)
      });
    }
  });
};

<span class="hljs-comment">/**
 * Add regexp to grep, if `re` is a string it is escaped.
 *
 * @param {RegExp|String} re
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.grep = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(re)</span></span>{
  <span class="hljs-keyword">this</span>.options.grep = <span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> re
    ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(utils.escapeRegexp(re))
    : re;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Invert `.grep()` matches.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.invert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">this</span>.options.invert = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Ignore global leaks.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.ignoreLeaks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">this</span>.options.ignoreLeaks = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Enable global leak checking.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.checkLeaks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">this</span>.options.ignoreLeaks = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Enable growl support.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.growl = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">this</span>.options.growl = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Ignore `globals` array or string.
 *
 * @param {Array|String} globals
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.globals = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(globals)</span></span>{
  <span class="hljs-keyword">this</span>.options.globals = (<span class="hljs-keyword">this</span>.options.globals || []).concat(globals);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set the timeout in milliseconds.
 *
 * @param {Number} timeout
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.timeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(timeout)</span></span>{
  <span class="hljs-keyword">this</span>.suite.timeout(timeout);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set slowness threshold in milliseconds.
 *
 * @param {Number} slow
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.slow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(slow)</span></span>{
  <span class="hljs-keyword">this</span>.suite.slow(slow);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Run tests and invoke `fn()` when complete.
 *
 * @param {Function} fn
 * @return {Runner}
 * @api public
 */</span>

Mocha.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.files.length) <span class="hljs-keyword">this</span>.loadFiles();
  <span class="hljs-keyword">var</span> suite = <span class="hljs-keyword">this</span>.suite;
  <span class="hljs-keyword">var</span> options = <span class="hljs-keyword">this</span>.options;
  <span class="hljs-keyword">var</span> runner = <span class="hljs-keyword">new</span> exports.Runner(suite);
  <span class="hljs-keyword">var</span> reporter = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>._reporter(runner);
  runner.ignoreLeaks = options.ignoreLeaks;
  <span class="hljs-keyword">if</span> (options.grep) runner.grep(options.grep, options.invert);
  <span class="hljs-keyword">if</span> (options.globals) runner.globals(options.globals);
  <span class="hljs-keyword">if</span> (options.growl) <span class="hljs-keyword">this</span>._growl(runner, reporter);
  <span class="hljs-keyword">return</span> runner.run(fn);
};

}); <span class="hljs-comment">// module: mocha.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"ms.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Helpers.
 */</span>

<span class="hljs-keyword">var</span> s = <span class="hljs-number">1000</span>;
<span class="hljs-keyword">var</span> m = s * <span class="hljs-number">60</span>;
<span class="hljs-keyword">var</span> h = m * <span class="hljs-number">60</span>;
<span class="hljs-keyword">var</span> d = h * <span class="hljs-number">24</span>;

<span class="hljs-comment">/**
 * Parse or format the given `val`.
 *
 * @param {String|Number} val
 * @return {String|Number}
 * @api public
 */</span>

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(val)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> val) <span class="hljs-keyword">return</span> parse(val);
  <span class="hljs-keyword">return</span> format(val);
}

<span class="hljs-comment">/**
 * Parse the given `str` and return milliseconds.
 *
 * @param {String} str
 * @return {Number}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse</span><span class="hljs-params">(str)</span> </span>{
  <span class="hljs-keyword">var</span> m = <span class="hljs-regexp">/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i</span>.exec(str);
  <span class="hljs-keyword">if</span> (!m) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">var</span> n = <span class="hljs-built_in">parseFloat</span>(m[<span class="hljs-number">1</span>]);
  <span class="hljs-keyword">var</span> type = (m[<span class="hljs-number">2</span>] || <span class="hljs-string">'ms'</span>).toLowerCase();
  <span class="hljs-keyword">switch</span> (type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'years'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'year'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'y'</span>:
      <span class="hljs-keyword">return</span> n * <span class="hljs-number">31557600000</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'days'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'day'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:
      <span class="hljs-keyword">return</span> n * <span class="hljs-number">86400000</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'hours'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'hour'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:
      <span class="hljs-keyword">return</span> n * <span class="hljs-number">3600000</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'minutes'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'minute'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'m'</span>:
      <span class="hljs-keyword">return</span> n * <span class="hljs-number">60000</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'seconds'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'second'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>:
      <span class="hljs-keyword">return</span> n * <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'ms'</span>:
      <span class="hljs-keyword">return</span> n;
  }
}

<span class="hljs-comment">/**
 * Format the given `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format</span><span class="hljs-params">(ms)</span> </span>{
  <span class="hljs-keyword">if</span> (ms == d) <span class="hljs-keyword">return</span> (ms / d) + <span class="hljs-string">' day'</span>;
  <span class="hljs-keyword">if</span> (ms &gt; d) <span class="hljs-keyword">return</span> (ms / d) + <span class="hljs-string">' days'</span>;
  <span class="hljs-keyword">if</span> (ms == h) <span class="hljs-keyword">return</span> (ms / h) + <span class="hljs-string">' hour'</span>;
  <span class="hljs-keyword">if</span> (ms &gt; h) <span class="hljs-keyword">return</span> (ms / h) + <span class="hljs-string">' hours'</span>;
  <span class="hljs-keyword">if</span> (ms == m) <span class="hljs-keyword">return</span> (ms / m) + <span class="hljs-string">' minute'</span>;
  <span class="hljs-keyword">if</span> (ms &gt; m) <span class="hljs-keyword">return</span> (ms / m) + <span class="hljs-string">' minutes'</span>;
  <span class="hljs-keyword">if</span> (ms == s) <span class="hljs-keyword">return</span> (ms / s) + <span class="hljs-string">' second'</span>;
  <span class="hljs-keyword">if</span> (ms &gt; s) <span class="hljs-keyword">return</span> (ms / s) + <span class="hljs-string">' seconds'</span>;
  <span class="hljs-keyword">return</span> ms + <span class="hljs-string">' ms'</span>;
}
}); <span class="hljs-comment">// module: ms.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/base.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> tty = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/tty'</span>)
  , diff = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/diff'</span>)
  , ms = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../ms'</span>);

<span class="hljs-comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="hljs-keyword">var</span> <span class="hljs-built_in">Date</span> = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="hljs-comment">/**
 * Check if both stdio streams are associated with a tty.
 */</span>

<span class="hljs-keyword">var</span> isatty = tty.isatty(<span class="hljs-number">1</span>) &amp;&amp; tty.isatty(<span class="hljs-number">2</span>);

<span class="hljs-comment">/**
 * Expose `Base`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Base;

<span class="hljs-comment">/**
 * Enable coloring by default.
 */</span>

exports.useColors = isatty;

<span class="hljs-comment">/**
 * Default color map.
 */</span>

exports.colors = {
    <span class="hljs-string">'pass'</span>: <span class="hljs-number">90</span>
  , <span class="hljs-string">'fail'</span>: <span class="hljs-number">31</span>
  , <span class="hljs-string">'bright pass'</span>: <span class="hljs-number">92</span>
  , <span class="hljs-string">'bright fail'</span>: <span class="hljs-number">91</span>
  , <span class="hljs-string">'bright yellow'</span>: <span class="hljs-number">93</span>
  , <span class="hljs-string">'pending'</span>: <span class="hljs-number">36</span>
  , <span class="hljs-string">'suite'</span>: <span class="hljs-number">0</span>
  , <span class="hljs-string">'error title'</span>: <span class="hljs-number">0</span>
  , <span class="hljs-string">'error message'</span>: <span class="hljs-number">31</span>
  , <span class="hljs-string">'error stack'</span>: <span class="hljs-number">90</span>
  , <span class="hljs-string">'checkmark'</span>: <span class="hljs-number">32</span>
  , <span class="hljs-string">'fast'</span>: <span class="hljs-number">90</span>
  , <span class="hljs-string">'medium'</span>: <span class="hljs-number">33</span>
  , <span class="hljs-string">'slow'</span>: <span class="hljs-number">31</span>
  , <span class="hljs-string">'green'</span>: <span class="hljs-number">32</span>
  , <span class="hljs-string">'light'</span>: <span class="hljs-number">90</span>
  , <span class="hljs-string">'diff gutter'</span>: <span class="hljs-number">90</span>
  , <span class="hljs-string">'diff added'</span>: <span class="hljs-number">42</span>
  , <span class="hljs-string">'diff removed'</span>: <span class="hljs-number">41</span>
};

<span class="hljs-comment">/**
 * Color `str` with the given `type`,
 * allowing colors to be disabled,
 * as well as user-defined color
 * schemes.
 *
 * @param {String} type
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

<span class="hljs-keyword">var</span> color = exports.color = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type, str)</span> </span>{
  <span class="hljs-keyword">if</span> (!exports.useColors) <span class="hljs-keyword">return</span> str;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'\u001b['</span> + exports.colors[type] + <span class="hljs-string">'m'</span> + str + <span class="hljs-string">'\u001b[0m'</span>;
};

<span class="hljs-comment">/**
 * Expose term window size, with some
 * defaults for when stderr is not a tty.
 */</span>

exports.window = {
  width: isatty
    ? process.stdout.getWindowSize
      ? process.stdout.getWindowSize(<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]
      : tty.getWindowSize()[<span class="hljs-number">1</span>]
    : <span class="hljs-number">75</span>
};

<span class="hljs-comment">/**
 * Expose some basic cursor interactions
 * that are common among reporters.
 */</span>

exports.cursor = {
  hide: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(<span class="hljs-string">'\u001b[?25l'</span>);
  },

  show: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(<span class="hljs-string">'\u001b[?25h'</span>);
  },

  deleteLine: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(<span class="hljs-string">'\u001b[2K'</span>);
  },

  beginningOfLine: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(<span class="hljs-string">'\u001b[0G'</span>);
  },

  CR: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    exports.cursor.deleteLine();
    exports.cursor.beginningOfLine();
  }
};

<span class="hljs-comment">/**
 * Outut the given `failures` as a list.
 *
 * @param {Array} failures
 * @api public
 */</span>

exports.list = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(failures)</span></span>{
  <span class="hljs-built_in">console</span>.error();
  failures.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, i)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> fmt = color(<span class="hljs-string">'error title'</span>, <span class="hljs-string">'  %s) %s:\n'</span>)
      + color(<span class="hljs-string">'error message'</span>, <span class="hljs-string">'     %s'</span>)
      + color(<span class="hljs-string">'error stack'</span>, <span class="hljs-string">'\n%s\n'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>msg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> err = test.err
      , message = err.message || <span class="hljs-string">''</span>
      , stack = err.stack || message
      , index = stack.indexOf(message) + message.length
      , msg = stack.slice(<span class="hljs-number">0</span>, index)
      , actual = err.actual
      , expected = err.expected;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>actual / expected diff</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> actual &amp;&amp; <span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> expected) {
      <span class="hljs-keyword">var</span> len = <span class="hljs-built_in">Math</span>.max(actual.length, expected.length);

      <span class="hljs-keyword">if</span> (len &lt; <span class="hljs-number">20</span>) msg = errorDiff(err, <span class="hljs-string">'Chars'</span>);
      <span class="hljs-keyword">else</span> msg = errorDiff(err, <span class="hljs-string">'Words'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>linenos</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> lines = msg.split(<span class="hljs-string">'\n'</span>);
      <span class="hljs-keyword">if</span> (lines.length &gt; <span class="hljs-number">4</span>) {
        <span class="hljs-keyword">var</span> width = <span class="hljs-built_in">String</span>(lines.length).length;
        msg = lines.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str, i)</span></span>{
          <span class="hljs-keyword">return</span> pad(++i, width) + <span class="hljs-string">' |'</span> + <span class="hljs-string">' '</span> + str;
        }).join(<span class="hljs-string">'\n'</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>legend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      msg = <span class="hljs-string">'\n'</span>
        + color(<span class="hljs-string">'diff removed'</span>, <span class="hljs-string">'actual'</span>)
        + <span class="hljs-string">' '</span>
        + color(<span class="hljs-string">'diff added'</span>, <span class="hljs-string">'expected'</span>)
        + <span class="hljs-string">'\n\n'</span>
        + msg
        + <span class="hljs-string">'\n'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>indent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      msg = msg.replace(<span class="hljs-regexp">/^/gm</span>, <span class="hljs-string">'      '</span>);

      fmt = color(<span class="hljs-string">'error title'</span>, <span class="hljs-string">'  %s) %s:\n%s'</span>)
        + color(<span class="hljs-string">'error stack'</span>, <span class="hljs-string">'\n%s\n'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>indent stack trace without msg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stack = stack.slice(index ? index + <span class="hljs-number">1</span> : index)
      .replace(<span class="hljs-regexp">/^/gm</span>, <span class="hljs-string">'  '</span>);

    <span class="hljs-built_in">console</span>.error(fmt, (i + <span class="hljs-number">1</span>), test.fullTitle(), msg, stack);
  });
};

<span class="hljs-comment">/**
 * Initialize a new `Base` reporter.
 *
 * All other reporters generally
 * inherit from this reporter, providing
 * stats such as test duration, number
 * of tests passed / failed etc.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Base</span><span class="hljs-params">(runner)</span> </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats = { suites: <span class="hljs-number">0</span>, tests: <span class="hljs-number">0</span>, passes: <span class="hljs-number">0</span>, pending: <span class="hljs-number">0</span>, failures: <span class="hljs-number">0</span> }
    , failures = <span class="hljs-keyword">this</span>.failures = [];

  <span class="hljs-keyword">if</span> (!runner) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">this</span>.runner = runner;

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    stats.start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>;
  });

  runner.on(<span class="hljs-string">'suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    stats.suites = stats.suites || <span class="hljs-number">0</span>;
    suite.root || stats.suites++;
  });

  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    stats.tests = stats.tests || <span class="hljs-number">0</span>;
    stats.tests++;
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    stats.passes = stats.passes || <span class="hljs-number">0</span>;

    <span class="hljs-keyword">var</span> medium = test.slow() / <span class="hljs-number">2</span>;
    test.speed = test.duration &gt; test.slow()
      ? <span class="hljs-string">'slow'</span>
      : test.duration &gt; medium
        ? <span class="hljs-string">'medium'</span>
        : <span class="hljs-string">'fast'</span>;

    stats.passes++;
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    stats.failures = stats.failures || <span class="hljs-number">0</span>;
    stats.failures++;
    test.err = err;
    failures.push(test);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    stats.end = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>;
    stats.duration = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span> - stats.start;
  });

  runner.on(<span class="hljs-string">'pending'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    stats.pending++;
  });
}

<span class="hljs-comment">/**
 * Output common epilogue used by many of
 * the bundled reporters.
 *
 * @api public
 */</span>

Base.prototype.epilogue = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">this</span>.stats
    , fmt
    , tests;

  <span class="hljs-built_in">console</span>.log();

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pluralize</span><span class="hljs-params">(n)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> == n ? <span class="hljs-string">'test'</span> : <span class="hljs-string">'tests'</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>failure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (stats.failures) {
    fmt = color(<span class="hljs-string">'bright fail'</span>, <span class="hljs-string">'  '</span>)
      + color(<span class="hljs-string">'fail'</span>, <span class="hljs-string">' %d of %d %s failed'</span>)
      + color(<span class="hljs-string">'light'</span>, <span class="hljs-string">':'</span>)

    <span class="hljs-built_in">console</span>.error(fmt,
      stats.failures,
      <span class="hljs-keyword">this</span>.runner.total,
      pluralize(<span class="hljs-keyword">this</span>.runner.total));

    Base.list(<span class="hljs-keyword">this</span>.failures);
    <span class="hljs-built_in">console</span>.error();
    <span class="hljs-keyword">return</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>pass</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fmt = color(<span class="hljs-string">'bright pass'</span>, <span class="hljs-string">'  '</span>)
    + color(<span class="hljs-string">'green'</span>, <span class="hljs-string">' %d %s complete'</span>)
    + color(<span class="hljs-string">'light'</span>, <span class="hljs-string">' (%s)'</span>);

  <span class="hljs-built_in">console</span>.log(fmt,
    stats.tests || <span class="hljs-number">0</span>,
    pluralize(stats.tests),
    ms(stats.duration));</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>pending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (stats.pending) {
    fmt = color(<span class="hljs-string">'pending'</span>, <span class="hljs-string">'  '</span>)
      + color(<span class="hljs-string">'pending'</span>, <span class="hljs-string">' %d %s pending'</span>);

    <span class="hljs-built_in">console</span>.log(fmt, stats.pending, pluralize(stats.pending));
  }

  <span class="hljs-built_in">console</span>.log();
};

<span class="hljs-comment">/**
 * Pad the given `str` to `len`.
 *
 * @param {String} str
 * @param {String} len
 * @return {String}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pad</span><span class="hljs-params">(str, len)</span> </span>{
  str = <span class="hljs-built_in">String</span>(str);
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(len - str.length + <span class="hljs-number">1</span>).join(<span class="hljs-string">' '</span>) + str;
}

<span class="hljs-comment">/**
 * Return a character diff for `err`.
 *
 * @param {Error} err
 * @return {String}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorDiff</span><span class="hljs-params">(err, type)</span> </span>{
  <span class="hljs-keyword">return</span> diff[<span class="hljs-string">'diff'</span> + type](err.actual, err.expected).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span></span>{
    str.value = str.value
      .replace(<span class="hljs-regexp">/\t/g</span>, <span class="hljs-string">'&lt;tab&gt;'</span>)
      .replace(<span class="hljs-regexp">/\r/g</span>, <span class="hljs-string">'&lt;CR&gt;'</span>)
      .replace(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">'&lt;LF&gt;\n'</span>);
    <span class="hljs-keyword">if</span> (str.added) <span class="hljs-keyword">return</span> colorLines(<span class="hljs-string">'diff added'</span>, str.value);
    <span class="hljs-keyword">if</span> (str.removed) <span class="hljs-keyword">return</span> colorLines(<span class="hljs-string">'diff removed'</span>, str.value);
    <span class="hljs-keyword">return</span> str.value;
  }).join(<span class="hljs-string">''</span>);
}

<span class="hljs-comment">/**
 * Color lines for `str`, using the color `name`.
 *
 * @param {String} name
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">colorLines</span><span class="hljs-params">(name, str)</span> </span>{
  <span class="hljs-keyword">return</span> str.split(<span class="hljs-string">'\n'</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span></span>{
    <span class="hljs-keyword">return</span> color(name, str);
  }).join(<span class="hljs-string">'\n'</span>);
}

}); <span class="hljs-comment">// module: reporters/base.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/doc.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>);

<span class="hljs-comment">/**
 * Expose `Doc`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Doc;

<span class="hljs-comment">/**
 * Initialize a new `Doc` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Doc</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , total = runner.total
    , indents = <span class="hljs-number">2</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indent</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(indents).join(<span class="hljs-string">'  '</span>);
  }

  runner.on(<span class="hljs-string">'suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    <span class="hljs-keyword">if</span> (suite.root) <span class="hljs-keyword">return</span>;
    ++indents;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s&lt;section class="suite"&gt;'</span>, indent());
    ++indents;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s&lt;h1&gt;%s&lt;/h1&gt;'</span>, indent(), suite.title);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s&lt;dl&gt;'</span>, indent());
  });

  runner.on(<span class="hljs-string">'suite end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    <span class="hljs-keyword">if</span> (suite.root) <span class="hljs-keyword">return</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s&lt;/dl&gt;'</span>, indent());
    --indents;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s&lt;/section&gt;'</span>, indent());
    --indents;
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s  &lt;dt&gt;%s&lt;/dt&gt;'</span>, indent(), test.title);
    <span class="hljs-keyword">var</span> code = utils.escape(utils.clean(test.fn.toString()));
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s  &lt;dd&gt;&lt;pre&gt;&lt;code&gt;%s&lt;/code&gt;&lt;/pre&gt;&lt;/dd&gt;'</span>, indent(), code);
  });
}

}); <span class="hljs-comment">// module: reporters/doc.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/dot.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `Dot`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Dot;

<span class="hljs-comment">/**
 * Initialize a new `Dot` matrix test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Dot</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , width = Base.window.width * <span class="hljs-number">.75</span> | <span class="hljs-number">0</span>
    , c = <span class="hljs-string">''</span>
    , n = <span class="hljs-number">0</span>;

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(<span class="hljs-string">'\n  '</span>);
  });

  runner.on(<span class="hljs-string">'pending'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    process.stdout.write(color(<span class="hljs-string">'pending'</span>, c));
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-keyword">if</span> (++n % width == <span class="hljs-number">0</span>) process.stdout.write(<span class="hljs-string">'\n  '</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'slow'</span> == test.speed) {
      process.stdout.write(color(<span class="hljs-string">'bright yellow'</span>, c));
    } <span class="hljs-keyword">else</span> {
      process.stdout.write(color(test.speed, c));
    }
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    <span class="hljs-keyword">if</span> (++n % width == <span class="hljs-number">0</span>) process.stdout.write(<span class="hljs-string">'\n  '</span>);
    process.stdout.write(color(<span class="hljs-string">'fail'</span>, c));
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-built_in">console</span>.log();
    self.epilogue();
  });
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

Dot.prototype = <span class="hljs-keyword">new</span> Base;
Dot.prototype.constructor = Dot;

}); <span class="hljs-comment">// module: reporters/dot.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/html-cov.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> JSONCov = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./json-cov'</span>)
  , fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/fs'</span>);

<span class="hljs-comment">/**
 * Expose `HTMLCov`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = HTMLCov;

<span class="hljs-comment">/**
 * Initialize a new `JsCoverage` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">HTMLCov</span><span class="hljs-params">(runner)</span> </span>{
  <span class="hljs-keyword">var</span> jade = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jade'</span>)
    , file = __dirname + <span class="hljs-string">'/templates/coverage.jade'</span>
    , str = fs.readFileSync(file, <span class="hljs-string">'utf8'</span>)
    , fn = jade.compile(str, { filename: file })
    , self = <span class="hljs-keyword">this</span>;

  JSONCov.call(<span class="hljs-keyword">this</span>, runner, <span class="hljs-literal">false</span>);

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(fn({
        cov: self.cov
      , coverageClass: coverageClass
    }));
  });
}

<span class="hljs-comment">/**
 * Return coverage class for `n`.
 *
 * @return {String}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">coverageClass</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">if</span> (n &gt;= <span class="hljs-number">75</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'high'</span>;
  <span class="hljs-keyword">if</span> (n &gt;= <span class="hljs-number">50</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'medium'</span>;
  <span class="hljs-keyword">if</span> (n &gt;= <span class="hljs-number">25</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'low'</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'terrible'</span>;
}
}); <span class="hljs-comment">// module: reporters/html-cov.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/html.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>)
  , Progress = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../browser/progress'</span>)
  , <span class="hljs-built_in">escape</span> = utils.escape;

<span class="hljs-comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="hljs-keyword">var</span> <span class="hljs-built_in">Date</span> = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="hljs-comment">/**
 * Expose `Doc`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = HTML;

<span class="hljs-comment">/**
 * Stats template.
 */</span>

<span class="hljs-keyword">var</span> statsTemplate = <span class="hljs-string">'&lt;ul id="stats"&gt;'</span>
  + <span class="hljs-string">'&lt;li class="progress"&gt;&lt;canvas width="40" height="40"&gt;&lt;/canvas&gt;&lt;/li&gt;'</span>
  + <span class="hljs-string">'&lt;li class="passes"&gt;&lt;a href="#"&gt;passes:&lt;/a&gt; &lt;em&gt;0&lt;/em&gt;&lt;/li&gt;'</span>
  + <span class="hljs-string">'&lt;li class="failures"&gt;&lt;a href="#"&gt;failures:&lt;/a&gt; &lt;em&gt;0&lt;/em&gt;&lt;/li&gt;'</span>
  + <span class="hljs-string">'&lt;li class="duration"&gt;duration: &lt;em&gt;0&lt;/em&gt;s&lt;/li&gt;'</span>
  + <span class="hljs-string">'&lt;/ul&gt;'</span>;

<span class="hljs-comment">/**
 * Initialize a new `Doc` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">HTML</span><span class="hljs-params">(runner, root)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , total = runner.total
    , stat = fragment(statsTemplate)
    , items = stat.getElementsByTagName(<span class="hljs-string">'li'</span>)
    , passes = items[<span class="hljs-number">1</span>].getElementsByTagName(<span class="hljs-string">'em'</span>)[<span class="hljs-number">0</span>]
    , passesLink = items[<span class="hljs-number">1</span>].getElementsByTagName(<span class="hljs-string">'a'</span>)[<span class="hljs-number">0</span>]
    , failures = items[<span class="hljs-number">2</span>].getElementsByTagName(<span class="hljs-string">'em'</span>)[<span class="hljs-number">0</span>]
    , failuresLink = items[<span class="hljs-number">2</span>].getElementsByTagName(<span class="hljs-string">'a'</span>)[<span class="hljs-number">0</span>]
    , duration = items[<span class="hljs-number">3</span>].getElementsByTagName(<span class="hljs-string">'em'</span>)[<span class="hljs-number">0</span>]
    , canvas = stat.getElementsByTagName(<span class="hljs-string">'canvas'</span>)[<span class="hljs-number">0</span>]
    , report = fragment(<span class="hljs-string">'&lt;ul id="report"&gt;&lt;/ul&gt;'</span>)
    , stack = [report]
    , progress
    , ctx

  root = root || <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'mocha'</span>);

  <span class="hljs-keyword">if</span> (canvas.getContext) {
    <span class="hljs-keyword">var</span> ratio = <span class="hljs-built_in">window</span>.devicePixelRatio || <span class="hljs-number">1</span>;
    canvas.style.width = canvas.width;
    canvas.style.height = canvas.height;
    canvas.width *= ratio;
    canvas.height *= ratio;
    ctx = canvas.getContext(<span class="hljs-string">'2d'</span>);
    ctx.scale(ratio, ratio);
    progress = <span class="hljs-keyword">new</span> Progress;
  }

  <span class="hljs-keyword">if</span> (!root) <span class="hljs-keyword">return</span> error(<span class="hljs-string">'#mocha div missing, add it to your document'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>pass toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  on(passesLink, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> className = <span class="hljs-regexp">/pass/</span>.test(report.className) ? <span class="hljs-string">''</span> : <span class="hljs-string">' pass'</span>;
    report.className = report.className.replace(<span class="hljs-regexp">/fail|pass/g</span>, <span class="hljs-string">''</span>) + className;
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>failure toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  on(failuresLink, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> className = <span class="hljs-regexp">/fail/</span>.test(report.className) ? <span class="hljs-string">''</span> : <span class="hljs-string">' fail'</span>;
    report.className = report.className.replace(<span class="hljs-regexp">/fail|pass/g</span>, <span class="hljs-string">''</span>) + className;
  });

  root.appendChild(stat);
  root.appendChild(report);

  <span class="hljs-keyword">if</span> (progress) progress.size(<span class="hljs-number">40</span>);

  runner.on(<span class="hljs-string">'suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    <span class="hljs-keyword">if</span> (suite.root) <span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>suite</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> url = <span class="hljs-string">'?grep='</span> + <span class="hljs-built_in">encodeURIComponent</span>(suite.fullTitle());
    <span class="hljs-keyword">var</span> el = fragment(<span class="hljs-string">'&lt;li class="suite"&gt;&lt;h1&gt;&lt;a href="%s"&gt;%s&lt;/a&gt;&lt;/h1&gt;&lt;/li&gt;'</span>, url, <span class="hljs-built_in">escape</span>(suite.title));</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stack[<span class="hljs-number">0</span>].appendChild(el);
    stack.unshift(<span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'ul'</span>));
    el.appendChild(stack[<span class="hljs-number">0</span>]);
  });

  runner.on(<span class="hljs-string">'suite end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    <span class="hljs-keyword">if</span> (suite.root) <span class="hljs-keyword">return</span>;
    stack.shift();
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'hook'</span> == test.type || err.uncaught) runner.emit(<span class="hljs-string">'test end'</span>, test);
  });

  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-built_in">window</span>.scrollTo(<span class="hljs-number">0</span>, <span class="hljs-built_in">document</span>.body.scrollHeight);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>TODO: add to stats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> percent = stats.tests / total * <span class="hljs-number">100</span> | <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (progress) progress.update(percent).draw(ctx);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>update stats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> ms = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span> - stats.start;
    text(passes, stats.passes);
    text(failures, stats.failures);
    text(duration, (ms / <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">2</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-string">'passed'</span> == test.state) {
      <span class="hljs-keyword">var</span> el = fragment(<span class="hljs-string">'&lt;li class="test pass %e"&gt;&lt;h2&gt;%e&lt;span class="duration"&gt;%ems&lt;/span&gt;&lt;/h2&gt;&lt;/li&gt;'</span>, test.speed, test.title, test.duration);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (test.pending) {
      <span class="hljs-keyword">var</span> el = fragment(<span class="hljs-string">'&lt;li class="test pass pending"&gt;&lt;h2&gt;%e&lt;/h2&gt;&lt;/li&gt;'</span>, test.title);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> el = fragment(<span class="hljs-string">'&lt;li class="test fail"&gt;&lt;h2&gt;%e&lt;/h2&gt;&lt;/li&gt;'</span>, test.title);
      <span class="hljs-keyword">var</span> str = test.err.stack || test.err.toString();</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>FF / Opera do not add the message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!~str.indexOf(test.err.message)) {
        str = test.err.message + <span class="hljs-string">'\n'</span> + str;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>&lt;=IE7 stringifies to [Object Error]. Since it can be overloaded, we
check for the result of the stringifying.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-string">'[object Error]'</span> == str) str = test.err.message;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Safari doesnt give you a stack. Lets at least provide a source line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!test.err.stack &amp;&amp; test.err.sourceURL &amp;&amp; test.err.line !== <span class="hljs-literal">undefined</span>) {
        str += <span class="hljs-string">"\n("</span> + test.err.sourceURL + <span class="hljs-string">":"</span> + test.err.line + <span class="hljs-string">")"</span>;
      }

      el.appendChild(fragment(<span class="hljs-string">'&lt;pre class="error"&gt;%e&lt;/pre&gt;'</span>, str));
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>toggle code
TODO: defer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!test.pending) {
      <span class="hljs-keyword">var</span> h2 = el.getElementsByTagName(<span class="hljs-string">'h2'</span>)[<span class="hljs-number">0</span>];

      on(h2, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        pre.style.display = <span class="hljs-string">'none'</span> == pre.style.display
          ? <span class="hljs-string">'inline-block'</span>
          : <span class="hljs-string">'none'</span>;
      });

      <span class="hljs-keyword">var</span> pre = fragment(<span class="hljs-string">'&lt;pre&gt;&lt;code&gt;%e&lt;/code&gt;&lt;/pre&gt;'</span>, utils.clean(test.fn.toString()));
      el.appendChild(pre);
      pre.style.display = <span class="hljs-string">'none'</span>;
    }

    stack[<span class="hljs-number">0</span>].appendChild(el);
  });
}

<span class="hljs-comment">/**
 * Display error `msg`.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span><span class="hljs-params">(msg)</span> </span>{
  <span class="hljs-built_in">document</span>.body.appendChild(fragment(<span class="hljs-string">'&lt;div id="error"&gt;%s&lt;/div&gt;'</span>, msg));
}

<span class="hljs-comment">/**
 * Return a DOM fragment from `html`.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fragment</span><span class="hljs-params">(html)</span> </span>{
  <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">arguments</span>
    , div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>)
    , i = <span class="hljs-number">1</span>;

  div.innerHTML = html.replace(<span class="hljs-regexp">/%([se])/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_, type)</span></span>{
    <span class="hljs-keyword">switch</span> (type) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>: <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>(args[i++]);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'e'</span>: <span class="hljs-keyword">return</span> <span class="hljs-built_in">escape</span>(args[i++]);
    }
  });

  <span class="hljs-keyword">return</span> div.firstChild;
}

<span class="hljs-comment">/**
 * Set `el` text to `str`.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">text</span><span class="hljs-params">(el, str)</span> </span>{
  <span class="hljs-keyword">if</span> (el.textContent) {
    el.textContent = str;
  } <span class="hljs-keyword">else</span> {
    el.innerText = str;
  }
}

<span class="hljs-comment">/**
 * Listen on `event` with callback `fn`.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span><span class="hljs-params">(el, event, fn)</span> </span>{
  <span class="hljs-keyword">if</span> (el.addEventListener) {
    el.addEventListener(event, fn, <span class="hljs-literal">false</span>);
  } <span class="hljs-keyword">else</span> {
    el.attachEvent(<span class="hljs-string">'on'</span> + event, fn);
  }
}

}); <span class="hljs-comment">// module: reporters/html.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/index.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

exports.Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>);
exports.Dot = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dot'</span>);
exports.Doc = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./doc'</span>);
exports.TAP = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./tap'</span>);
exports.JSON = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./json'</span>);
exports.HTML = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./html'</span>);
exports.List = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./list'</span>);
exports.Min = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./min'</span>);
exports.Spec = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./spec'</span>);
exports.Nyan = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./nyan'</span>);
exports.XUnit = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./xunit'</span>);
exports.Markdown = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./markdown'</span>);
exports.Progress = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./progress'</span>);
exports.Landing = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./landing'</span>);
exports.JSONCov = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./json-cov'</span>);
exports.HTMLCov = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./html-cov'</span>);
exports.JSONStream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./json-stream'</span>);
exports.Teamcity = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./teamcity'</span>);

}); <span class="hljs-comment">// module: reporters/index.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/json-cov.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>);

<span class="hljs-comment">/**
 * Expose `JSONCov`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = JSONCov;

<span class="hljs-comment">/**
 * Initialize a new `JsCoverage` reporter.
 *
 * @param {Runner} runner
 * @param {Boolean} output
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">JSONCov</span><span class="hljs-params">(runner, output)</span> </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , output = <span class="hljs-number">1</span> == <span class="hljs-built_in">arguments</span>.length ? <span class="hljs-literal">true</span> : output;

  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> tests = []
    , failures = []
    , passes = [];

  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    tests.push(test);
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    passes.push(test);
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    failures.push(test);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> cov = global._$jscoverage || {};
    <span class="hljs-keyword">var</span> result = self.cov = map(cov);
    result.stats = self.stats;
    result.tests = tests.map(clean);
    result.failures = failures.map(clean);
    result.passes = passes.map(clean);
    <span class="hljs-keyword">if</span> (!output) <span class="hljs-keyword">return</span>;
    process.stdout.write(<span class="hljs-built_in">JSON</span>.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span> ));
  });
}

<span class="hljs-comment">/**
 * Map jscoverage data to a JSON structure
 * suitable for reporting.
 *
 * @param {Object} cov
 * @return {Object}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span><span class="hljs-params">(cov)</span> </span>{
  <span class="hljs-keyword">var</span> ret = {
      instrumentation: <span class="hljs-string">'node-jscoverage'</span>
    , sloc: <span class="hljs-number">0</span>
    , hits: <span class="hljs-number">0</span>
    , misses: <span class="hljs-number">0</span>
    , coverage: <span class="hljs-number">0</span>
    , files: []
  };

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> filename <span class="hljs-keyword">in</span> cov) {
    <span class="hljs-keyword">var</span> data = coverage(filename, cov[filename]);
    ret.files.push(data);
    ret.hits += data.hits;
    ret.misses += data.misses;
    ret.sloc += data.sloc;
  }

  <span class="hljs-keyword">if</span> (ret.sloc &gt; <span class="hljs-number">0</span>) {
    ret.coverage = (ret.hits / ret.sloc) * <span class="hljs-number">100</span>;
  }

  <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-comment">/**
 * Map jscoverage data for a single source file
 * to a JSON structure suitable for reporting.
 *
 * @param {String} filename name of the source file
 * @param {Object} data jscoverage coverage data
 * @return {Object}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">coverage</span><span class="hljs-params">(filename, data)</span> </span>{
  <span class="hljs-keyword">var</span> ret = {
    filename: filename,
    coverage: <span class="hljs-number">0</span>,
    hits: <span class="hljs-number">0</span>,
    misses: <span class="hljs-number">0</span>,
    sloc: <span class="hljs-number">0</span>,
    source: {}
  };

  data.source.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(line, num)</span></span>{
    num++;

    <span class="hljs-keyword">if</span> (data[num] === <span class="hljs-number">0</span>) {
      ret.misses++;
      ret.sloc++;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data[num] !== <span class="hljs-literal">undefined</span>) {
      ret.hits++;
      ret.sloc++;
    }

    ret.source[num] = {
        source: line
      , coverage: data[num] === <span class="hljs-literal">undefined</span>
        ? <span class="hljs-string">''</span>
        : data[num]
    };
  });

  ret.coverage = ret.hits / ret.sloc * <span class="hljs-number">100</span>;

  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-comment">/**
 * Return a plain-object representation of `test`
 * free of cyclic properties etc.
 *
 * @param {Object} test
 * @return {Object}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clean</span><span class="hljs-params">(test)</span> </span>{
  <span class="hljs-keyword">return</span> {
      title: test.title
    , fullTitle: test.fullTitle()
    , duration: test.duration
  }
}

}); <span class="hljs-comment">// module: reporters/json-cov.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/json-stream.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `List`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = List;

<span class="hljs-comment">/**
 * Initialize a new `List` test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">List</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , total = runner.total;

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify([<span class="hljs-string">'start'</span>, { total: total }]));
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify([<span class="hljs-string">'pass'</span>, clean(test)]));
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify([<span class="hljs-string">'fail'</span>, clean(test)]));
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(<span class="hljs-built_in">JSON</span>.stringify([<span class="hljs-string">'end'</span>, self.stats]));
  });
}

<span class="hljs-comment">/**
 * Return a plain-object representation of `test`
 * free of cyclic properties etc.
 *
 * @param {Object} test
 * @return {Object}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clean</span><span class="hljs-params">(test)</span> </span>{
  <span class="hljs-keyword">return</span> {
      title: test.title
    , fullTitle: test.fullTitle()
    , duration: test.duration
  }
}
}); <span class="hljs-comment">// module: reporters/json-stream.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/json.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `JSON`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = JSONReporter;

<span class="hljs-comment">/**
 * Initialize a new `JSON` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">JSONReporter</span><span class="hljs-params">(runner)</span> </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> tests = []
    , failures = []
    , passes = [];

  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    tests.push(test);
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    passes.push(test);
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    failures.push(test);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> obj = {
        stats: self.stats
      , tests: tests.map(clean)
      , failures: failures.map(clean)
      , passes: passes.map(clean)
    };

    process.stdout.write(<span class="hljs-built_in">JSON</span>.stringify(obj, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
  });
}

<span class="hljs-comment">/**
 * Return a plain-object representation of `test`
 * free of cyclic properties etc.
 *
 * @param {Object} test
 * @return {Object}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clean</span><span class="hljs-params">(test)</span> </span>{
  <span class="hljs-keyword">return</span> {
      title: test.title
    , fullTitle: test.fullTitle()
    , duration: test.duration
  }
}
}); <span class="hljs-comment">// module: reporters/json.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/landing.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `Landing`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Landing;

<span class="hljs-comment">/**
 * Airplane color.
 */</span>

Base.colors.plane = <span class="hljs-number">0</span>;

<span class="hljs-comment">/**
 * Airplane crash color.
 */</span>

Base.colors[<span class="hljs-string">'plane crash'</span>] = <span class="hljs-number">31</span>;

<span class="hljs-comment">/**
 * Runway color.
 */</span>

Base.colors.runway = <span class="hljs-number">90</span>;

<span class="hljs-comment">/**
 * Initialize a new `Landing` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Landing</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , width = Base.window.width * <span class="hljs-number">.75</span> | <span class="hljs-number">0</span>
    , total = runner.total
    , stream = process.stdout
    , plane = color(<span class="hljs-string">'plane'</span>, <span class="hljs-string">''</span>)
    , crashed = -<span class="hljs-number">1</span>
    , n = <span class="hljs-number">0</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runway</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> buf = <span class="hljs-built_in">Array</span>(width).join(<span class="hljs-string">'-'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">'  '</span> + color(<span class="hljs-string">'runway'</span>, buf);
  }

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    stream.write(<span class="hljs-string">'\n  '</span>);
    cursor.hide();
  });

  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>check if the plane crashed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> col = -<span class="hljs-number">1</span> == crashed
      ? width * ++n / total | <span class="hljs-number">0</span>
      : crashed;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>show the crash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-string">'failed'</span> == test.state) {
      plane = color(<span class="hljs-string">'plane crash'</span>, <span class="hljs-string">''</span>);
      crashed = col;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>render landing strip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stream.write(<span class="hljs-string">'\u001b[4F\n\n'</span>);
    stream.write(runway());
    stream.write(<span class="hljs-string">'\n  '</span>);
    stream.write(color(<span class="hljs-string">'runway'</span>, <span class="hljs-built_in">Array</span>(col).join(<span class="hljs-string">''</span>)));
    stream.write(plane)
    stream.write(color(<span class="hljs-string">'runway'</span>, <span class="hljs-built_in">Array</span>(width - col).join(<span class="hljs-string">''</span>) + <span class="hljs-string">'\n'</span>));
    stream.write(runway());
    stream.write(<span class="hljs-string">'\u001b[0m'</span>);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    cursor.show();
    <span class="hljs-built_in">console</span>.log();
    self.epilogue();
  });
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

Landing.prototype = <span class="hljs-keyword">new</span> Base;
Landing.prototype.constructor = Landing;

}); <span class="hljs-comment">// module: reporters/landing.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/list.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `List`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = List;

<span class="hljs-comment">/**
 * Initialize a new `List` test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">List</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , n = <span class="hljs-number">0</span>;

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-built_in">console</span>.log();
  });

  runner.on(<span class="hljs-string">'test'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    process.stdout.write(color(<span class="hljs-string">'pass'</span>, <span class="hljs-string">'    '</span> + test.fullTitle() + <span class="hljs-string">': '</span>));
  });

  runner.on(<span class="hljs-string">'pending'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-keyword">var</span> fmt = color(<span class="hljs-string">'checkmark'</span>, <span class="hljs-string">'  -'</span>)
      + color(<span class="hljs-string">'pending'</span>, <span class="hljs-string">' %s'</span>);
    <span class="hljs-built_in">console</span>.log(fmt, test.fullTitle());
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-keyword">var</span> fmt = color(<span class="hljs-string">'checkmark'</span>, <span class="hljs-string">'  '</span>)
      + color(<span class="hljs-string">'pass'</span>, <span class="hljs-string">' %s: '</span>)
      + color(test.speed, <span class="hljs-string">'%dms'</span>);
    cursor.CR();
    <span class="hljs-built_in">console</span>.log(fmt, test.fullTitle(), test.duration);
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    cursor.CR();
    <span class="hljs-built_in">console</span>.log(color(<span class="hljs-string">'fail'</span>, <span class="hljs-string">'  %d) %s'</span>), ++n, test.fullTitle());
  });

  runner.on(<span class="hljs-string">'end'</span>, self.epilogue.bind(self));
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

List.prototype = <span class="hljs-keyword">new</span> Base;
List.prototype.constructor = List;


}); <span class="hljs-comment">// module: reporters/list.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/markdown.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{
<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>);

<span class="hljs-comment">/**
 * Expose `Markdown`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Markdown;

<span class="hljs-comment">/**
 * Initialize a new `Markdown` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Markdown</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , total = runner.total
    , level = <span class="hljs-number">0</span>
    , buf = <span class="hljs-string">''</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">title</span><span class="hljs-params">(str)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(level).join(<span class="hljs-string">'#'</span>) + <span class="hljs-string">' '</span> + str;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indent</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(level).join(<span class="hljs-string">'  '</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mapTOC</span><span class="hljs-params">(suite, obj)</span> </span>{
    <span class="hljs-keyword">var</span> ret = obj;
    obj = obj[suite.title] = obj[suite.title] || { suite: suite };
    suite.suites.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
      mapTOC(suite, obj);
    });
    <span class="hljs-keyword">return</span> ret;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringifyTOC</span><span class="hljs-params">(obj, level)</span> </span>{
    ++level;
    <span class="hljs-keyword">var</span> buf = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> link;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> obj) {
      <span class="hljs-keyword">if</span> (<span class="hljs-string">'suite'</span> == key) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span> (key) link = <span class="hljs-string">' - ['</span> + key + <span class="hljs-string">'](#'</span> + utils.slug(obj[key].suite.fullTitle()) + <span class="hljs-string">')\n'</span>;
      <span class="hljs-keyword">if</span> (key) buf += <span class="hljs-built_in">Array</span>(level).join(<span class="hljs-string">'  '</span>) + link;
      buf += stringifyTOC(obj[key], level);
    }
    --level;
    <span class="hljs-keyword">return</span> buf;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateTOC</span><span class="hljs-params">(suite)</span> </span>{
    <span class="hljs-keyword">var</span> obj = mapTOC(suite, {});
    <span class="hljs-keyword">return</span> stringifyTOC(obj, <span class="hljs-number">0</span>);
  }

  generateTOC(runner.suite);

  runner.on(<span class="hljs-string">'suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    ++level;
    <span class="hljs-keyword">var</span> slug = utils.slug(suite.fullTitle());
    buf += <span class="hljs-string">'&lt;a name="'</span> + slug + <span class="hljs-string">'" /&gt;'</span> + <span class="hljs-string">'\n'</span>;
    buf += title(suite.title) + <span class="hljs-string">'\n'</span>;
  });

  runner.on(<span class="hljs-string">'suite end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    --level;
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-keyword">var</span> code = utils.clean(test.fn.toString());
    buf += test.title + <span class="hljs-string">'.\n'</span>;
    buf += <span class="hljs-string">'\n```js\n'</span>;
    buf += code + <span class="hljs-string">'\n'</span>;
    buf += <span class="hljs-string">'```\n\n'</span>;
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    process.stdout.write(<span class="hljs-string">'# TOC\n'</span>);
    process.stdout.write(generateTOC(runner.suite));
    process.stdout.write(buf);
  });
}
}); <span class="hljs-comment">// module: reporters/markdown.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/min.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>);

<span class="hljs-comment">/**
 * Expose `Min`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Min;

<span class="hljs-comment">/**
 * Initialize a new `Min` minimal test reporter (best used with --watch).
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Min</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);
  
  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>clear screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    process.stdout.write(<span class="hljs-string">'\u001b[2J'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>set cursor position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    process.stdout.write(<span class="hljs-string">'\u001b[1;3H'</span>);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-keyword">this</span>.epilogue.bind(<span class="hljs-keyword">this</span>));
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

Min.prototype = <span class="hljs-keyword">new</span> Base;
Min.prototype.constructor = Min;

}); <span class="hljs-comment">// module: reporters/min.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/nyan.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `Dot`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = NyanCat;

<span class="hljs-comment">/**
 * Initialize a new `Dot` matrix test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NyanCat</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , width = Base.window.width * <span class="hljs-number">.75</span> | <span class="hljs-number">0</span>
    , rainbowColors = <span class="hljs-keyword">this</span>.rainbowColors = self.generateColors()
    , colorIndex = <span class="hljs-keyword">this</span>.colorIndex = <span class="hljs-number">0</span>
    , numerOfLines = <span class="hljs-keyword">this</span>.numberOfLines = <span class="hljs-number">4</span>
    , trajectories = <span class="hljs-keyword">this</span>.trajectories = [[], [], [], []]
    , nyanCatWidth = <span class="hljs-keyword">this</span>.nyanCatWidth = <span class="hljs-number">11</span>
    , trajectoryWidthMax = <span class="hljs-keyword">this</span>.trajectoryWidthMax = (width - nyanCatWidth)
    , scoreboardWidth = <span class="hljs-keyword">this</span>.scoreboardWidth = <span class="hljs-number">5</span>
    , tick = <span class="hljs-keyword">this</span>.tick = <span class="hljs-number">0</span>
    , n = <span class="hljs-number">0</span>;

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    Base.cursor.hide();
    self.draw(<span class="hljs-string">'start'</span>);
  });

  runner.on(<span class="hljs-string">'pending'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    self.draw(<span class="hljs-string">'pending'</span>);
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    self.draw(<span class="hljs-string">'pass'</span>);
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    self.draw(<span class="hljs-string">'fail'</span>);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    Base.cursor.show();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; self.numberOfLines; i++) write(<span class="hljs-string">'\n'</span>);
    self.epilogue();
  });
}

<span class="hljs-comment">/**
 * Draw the nyan cat with runner `status`.
 *
 * @param {String} status
 * @api private
 */</span>

NyanCat.prototype.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(status)</span></span>{
  <span class="hljs-keyword">this</span>.appendRainbow();
  <span class="hljs-keyword">this</span>.drawScoreboard();
  <span class="hljs-keyword">this</span>.drawRainbow();
  <span class="hljs-keyword">this</span>.drawNyanCat(status);
  <span class="hljs-keyword">this</span>.tick = !<span class="hljs-keyword">this</span>.tick;
};

<span class="hljs-comment">/**
 * Draw the "scoreboard" showing the number
 * of passes, failures and pending tests.
 *
 * @api private
 */</span>

NyanCat.prototype.drawScoreboard = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">this</span>.stats;
  <span class="hljs-keyword">var</span> colors = Base.colors;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span><span class="hljs-params">(color, n)</span> </span>{
    write(<span class="hljs-string">' '</span>);
    write(<span class="hljs-string">'\u001b['</span> + color + <span class="hljs-string">'m'</span> + n + <span class="hljs-string">'\u001b[0m'</span>);
    write(<span class="hljs-string">'\n'</span>);
  }

  draw(colors.green, stats.passes);
  draw(colors.fail, stats.failures);
  draw(colors.pending, stats.pending);
  write(<span class="hljs-string">'\n'</span>);

  <span class="hljs-keyword">this</span>.cursorUp(<span class="hljs-keyword">this</span>.numberOfLines);
};

<span class="hljs-comment">/**
 * Append the rainbow.
 *
 * @api private
 */</span>

NyanCat.prototype.appendRainbow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> segment = <span class="hljs-keyword">this</span>.tick ? <span class="hljs-string">'_'</span> : <span class="hljs-string">'-'</span>;
  <span class="hljs-keyword">var</span> rainbowified = <span class="hljs-keyword">this</span>.rainbowify(segment);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-keyword">this</span>.numberOfLines; index++) {
    <span class="hljs-keyword">var</span> trajectory = <span class="hljs-keyword">this</span>.trajectories[index];
    <span class="hljs-keyword">if</span> (trajectory.length &gt;= <span class="hljs-keyword">this</span>.trajectoryWidthMax) trajectory.shift();
    trajectory.push(rainbowified);
  }
};

<span class="hljs-comment">/**
 * Draw the rainbow.
 *
 * @api private
 */</span>

NyanCat.prototype.drawRainbow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

  <span class="hljs-keyword">this</span>.trajectories.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(line, index)</span> </span>{
    write(<span class="hljs-string">'\u001b['</span> + self.scoreboardWidth + <span class="hljs-string">'C'</span>);
    write(line.join(<span class="hljs-string">''</span>));
    write(<span class="hljs-string">'\n'</span>);
  });

  <span class="hljs-keyword">this</span>.cursorUp(<span class="hljs-keyword">this</span>.numberOfLines);
};

<span class="hljs-comment">/**
 * Draw the nyan cat with `status`.
 *
 * @param {String} status
 * @api private
 */</span>

NyanCat.prototype.drawNyanCat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(status)</span> </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> startWidth = <span class="hljs-keyword">this</span>.scoreboardWidth + <span class="hljs-keyword">this</span>.trajectories[<span class="hljs-number">0</span>].length;

  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index)</span> </span>{
    write(<span class="hljs-string">'\u001b['</span> + startWidth + <span class="hljs-string">'C'</span>);

    <span class="hljs-keyword">switch</span> (index) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        write(<span class="hljs-string">'_,------,'</span>);
        write(<span class="hljs-string">'\n'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        <span class="hljs-keyword">var</span> padding = self.tick ? <span class="hljs-string">'  '</span> : <span class="hljs-string">'   '</span>;
        write(<span class="hljs-string">'_|'</span> + padding + <span class="hljs-string">'/\\_/\\ '</span>);
        write(<span class="hljs-string">'\n'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        <span class="hljs-keyword">var</span> padding = self.tick ? <span class="hljs-string">'_'</span> : <span class="hljs-string">'__'</span>;
        <span class="hljs-keyword">var</span> tail = self.tick ? <span class="hljs-string">'~'</span> : <span class="hljs-string">'^'</span>;
        <span class="hljs-keyword">var</span> face;
        <span class="hljs-keyword">switch</span> (status) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">'pass'</span>:
            face = <span class="hljs-string">'( ^ .^)'</span>;
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'fail'</span>:
            face = <span class="hljs-string">'( o .o)'</span>;
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">default</span>:
            face = <span class="hljs-string">'( - .-)'</span>;
        }
        write(tail + <span class="hljs-string">'|'</span> + padding + face + <span class="hljs-string">' '</span>);
        write(<span class="hljs-string">'\n'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        <span class="hljs-keyword">var</span> padding = self.tick ? <span class="hljs-string">' '</span> : <span class="hljs-string">'  '</span>;
        write(padding + <span class="hljs-string">'""  "" '</span>);
        write(<span class="hljs-string">'\n'</span>);
        <span class="hljs-keyword">break</span>;
    }
  });

  <span class="hljs-keyword">this</span>.cursorUp(<span class="hljs-keyword">this</span>.numberOfLines);
};

<span class="hljs-comment">/**
 * Move cursor up `n`.
 *
 * @param {Number} n
 * @api private
 */</span>

NyanCat.prototype.cursorUp = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> </span>{
  write(<span class="hljs-string">'\u001b['</span> + n + <span class="hljs-string">'A'</span>);
};

<span class="hljs-comment">/**
 * Move cursor down `n`.
 *
 * @param {Number} n
 * @api private
 */</span>

NyanCat.prototype.cursorDown = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> </span>{
  write(<span class="hljs-string">'\u001b['</span> + n + <span class="hljs-string">'B'</span>);
};

<span class="hljs-comment">/**
 * Generate rainbow colors.
 *
 * @return {Array}
 * @api private
 */</span>

NyanCat.prototype.generateColors = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> colors = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-number">6</span> * <span class="hljs-number">7</span>); i++) {
    <span class="hljs-keyword">var</span> pi3 = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">3</span>);
    <span class="hljs-keyword">var</span> n = (i * (<span class="hljs-number">1.0</span> / <span class="hljs-number">6</span>));
    <span class="hljs-keyword">var</span> r = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">3</span> * <span class="hljs-built_in">Math</span>.sin(n) + <span class="hljs-number">3</span>);
    <span class="hljs-keyword">var</span> g = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">3</span> * <span class="hljs-built_in">Math</span>.sin(n + <span class="hljs-number">2</span> * pi3) + <span class="hljs-number">3</span>);
    <span class="hljs-keyword">var</span> b = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">3</span> * <span class="hljs-built_in">Math</span>.sin(n + <span class="hljs-number">4</span> * pi3) + <span class="hljs-number">3</span>);
    colors.push(<span class="hljs-number">36</span> * r + <span class="hljs-number">6</span> * g + b + <span class="hljs-number">16</span>);
  }

  <span class="hljs-keyword">return</span> colors;
};

<span class="hljs-comment">/**
 * Apply rainbow to the given `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

NyanCat.prototype.rainbowify = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">var</span> color = <span class="hljs-keyword">this</span>.rainbowColors[<span class="hljs-keyword">this</span>.colorIndex % <span class="hljs-keyword">this</span>.rainbowColors.length];
  <span class="hljs-keyword">this</span>.colorIndex += <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'\u001b[38;5;'</span> + color + <span class="hljs-string">'m'</span> + str + <span class="hljs-string">'\u001b[0m'</span>;
};

<span class="hljs-comment">/**
 * Stdout helper.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span><span class="hljs-params">(string)</span> </span>{
  process.stdout.write(string);
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

NyanCat.prototype = <span class="hljs-keyword">new</span> Base;
NyanCat.prototype.constructor = NyanCat;


}); <span class="hljs-comment">// module: reporters/nyan.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/progress.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `Progress`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Progress;

<span class="hljs-comment">/**
 * General progress bar color.
 */</span>

Base.colors.progress = <span class="hljs-number">90</span>;

<span class="hljs-comment">/**
 * Initialize a new `Progress` bar test reporter.
 *
 * @param {Runner} runner
 * @param {Object} options
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Progress</span><span class="hljs-params">(runner, options)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , options = options || {}
    , stats = <span class="hljs-keyword">this</span>.stats
    , width = Base.window.width * <span class="hljs-number">.50</span> | <span class="hljs-number">0</span>
    , total = runner.total
    , complete = <span class="hljs-number">0</span>
    , max = <span class="hljs-built_in">Math</span>.max;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>default chars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.open = options.open || <span class="hljs-string">'['</span>;
  options.complete = options.complete || <span class="hljs-string">''</span>;
  options.incomplete = options.incomplete || <span class="hljs-string">''</span>;
  options.close = options.close || <span class="hljs-string">']'</span>;
  options.verbose = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>tests started</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-built_in">console</span>.log();
    cursor.hide();
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>tests complete</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    complete++;
    <span class="hljs-keyword">var</span> incomplete = total - complete
      , percent = complete / total
      , n = width * percent | <span class="hljs-number">0</span>
      , i = width - n;

    cursor.CR();
    process.stdout.write(<span class="hljs-string">'\u001b[J'</span>);
    process.stdout.write(color(<span class="hljs-string">'progress'</span>, <span class="hljs-string">'  '</span> + options.open));
    process.stdout.write(<span class="hljs-built_in">Array</span>(n).join(options.complete));
    process.stdout.write(<span class="hljs-built_in">Array</span>(i).join(options.incomplete));
    process.stdout.write(color(<span class="hljs-string">'progress'</span>, options.close));
    <span class="hljs-keyword">if</span> (options.verbose) {
      process.stdout.write(color(<span class="hljs-string">'progress'</span>, <span class="hljs-string">' '</span> + complete + <span class="hljs-string">' of '</span> + total));
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>tests are complete, output some stats
and the failures if any</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    cursor.show();
    <span class="hljs-built_in">console</span>.log();
    self.epilogue();
  });
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

Progress.prototype = <span class="hljs-keyword">new</span> Base;
Progress.prototype.constructor = Progress;


}); <span class="hljs-comment">// module: reporters/progress.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/spec.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `Spec`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Spec;

<span class="hljs-comment">/**
 * Initialize a new `Spec` test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Spec</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , indents = <span class="hljs-number">0</span>
    , n = <span class="hljs-number">0</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indent</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(indents).join(<span class="hljs-string">'  '</span>)
  }

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-built_in">console</span>.log();
  });

  runner.on(<span class="hljs-string">'suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    ++indents;
    <span class="hljs-built_in">console</span>.log(color(<span class="hljs-string">'suite'</span>, <span class="hljs-string">'%s%s'</span>), indent(), suite.title);
  });

  runner.on(<span class="hljs-string">'suite end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    --indents;
    <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == indents) <span class="hljs-built_in">console</span>.log();
  });

  runner.on(<span class="hljs-string">'test'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    process.stdout.write(indent() + color(<span class="hljs-string">'pass'</span>, <span class="hljs-string">'   '</span> + test.title + <span class="hljs-string">': '</span>));
  });

  runner.on(<span class="hljs-string">'pending'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-keyword">var</span> fmt = indent() + color(<span class="hljs-string">'pending'</span>, <span class="hljs-string">'  - %s'</span>);
    <span class="hljs-built_in">console</span>.log(fmt, test.title);
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'fast'</span> == test.speed) {
      <span class="hljs-keyword">var</span> fmt = indent()
        + color(<span class="hljs-string">'checkmark'</span>, <span class="hljs-string">'  '</span>)
        + color(<span class="hljs-string">'pass'</span>, <span class="hljs-string">' %s '</span>);
      cursor.CR();
      <span class="hljs-built_in">console</span>.log(fmt, test.title);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> fmt = indent()
        + color(<span class="hljs-string">'checkmark'</span>, <span class="hljs-string">'  '</span>)
        + color(<span class="hljs-string">'pass'</span>, <span class="hljs-string">' %s '</span>)
        + color(test.speed, <span class="hljs-string">'(%dms)'</span>);
      cursor.CR();
      <span class="hljs-built_in">console</span>.log(fmt, test.title, test.duration);
    }
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    cursor.CR();
    <span class="hljs-built_in">console</span>.log(indent() + color(<span class="hljs-string">'fail'</span>, <span class="hljs-string">'  %d) %s'</span>), ++n, test.title);
  });

  runner.on(<span class="hljs-string">'end'</span>, self.epilogue.bind(self));
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

Spec.prototype = <span class="hljs-keyword">new</span> Base;
Spec.prototype.constructor = Spec;


}); <span class="hljs-comment">// module: reporters/spec.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/tap.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="hljs-comment">/**
 * Expose `TAP`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = TAP;

<span class="hljs-comment">/**
 * Initialize a new `TAP` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TAP</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);

  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , stats = <span class="hljs-keyword">this</span>.stats
    , n = <span class="hljs-number">1</span>;

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> total = runner.grepTotal(runner.suite);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%d..%d'</span>, <span class="hljs-number">1</span>, total);
  });

  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    ++n;
  });

  runner.on(<span class="hljs-string">'pending'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ok %d %s # SKIP -'</span>, n, title(test));
  });

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ok %d %s'</span>, n, title(test));
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'not ok %d %s'</span>, n, title(test));
    <span class="hljs-built_in">console</span>.log(err.stack.replace(<span class="hljs-regexp">/^/gm</span>, <span class="hljs-string">'  '</span>));
  });
}

<span class="hljs-comment">/**
 * Return a TAP-safe title of `test`
 *
 * @param {Object} test
 * @return {String}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">title</span><span class="hljs-params">(test)</span> </span>{
  <span class="hljs-keyword">return</span> test.fullTitle().replace(<span class="hljs-regexp">/#/g</span>, <span class="hljs-string">''</span>);
}

}); <span class="hljs-comment">// module: reporters/tap.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/teamcity.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>);

<span class="hljs-comment">/**
 * Expose `Teamcity`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Teamcity;

<span class="hljs-comment">/**
 * Initialize a new `Teamcity` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Teamcity</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);
  <span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">this</span>.stats;

  runner.on(<span class="hljs-string">'start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"##teamcity[testSuiteStarted name='mocha.suite']"</span>);
  });

  runner.on(<span class="hljs-string">'test'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"##teamcity[testStarted name='"</span> + <span class="hljs-built_in">escape</span>(test.fullTitle()) + <span class="hljs-string">"']"</span>);
  });

  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"##teamcity[testFailed name='"</span> + <span class="hljs-built_in">escape</span>(test.fullTitle()) + <span class="hljs-string">"' message='"</span> + <span class="hljs-built_in">escape</span>(err.message) + <span class="hljs-string">"']"</span>);
  });

  runner.on(<span class="hljs-string">'pending'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"##teamcity[testIgnored name='"</span> + <span class="hljs-built_in">escape</span>(test.fullTitle()) + <span class="hljs-string">"' message='pending']"</span>);
  });

  runner.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"##teamcity[testFinished name='"</span> + <span class="hljs-built_in">escape</span>(test.fullTitle()) + <span class="hljs-string">"' duration='"</span> + test.duration + <span class="hljs-string">"']"</span>);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"##teamcity[testSuiteFinished name='mocha.suite' duration='"</span> + stats.duration + <span class="hljs-string">"']"</span>);
  });
}

<span class="hljs-comment">/**
 * Escape the given `str`.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">escape</span><span class="hljs-params">(str)</span> </span>{
  <span class="hljs-keyword">return</span> str
    .replace(<span class="hljs-regexp">/\|/g</span>, <span class="hljs-string">"||"</span>)
    .replace(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">"|n"</span>)
    .replace(<span class="hljs-regexp">/\r/g</span>, <span class="hljs-string">"|r"</span>)
    .replace(<span class="hljs-regexp">/\[/g</span>, <span class="hljs-string">"|["</span>)
    .replace(<span class="hljs-regexp">/\]/g</span>, <span class="hljs-string">"|]"</span>)
    .replace(<span class="hljs-regexp">/\u0085/g</span>, <span class="hljs-string">"|x"</span>)
    .replace(<span class="hljs-regexp">/\u2028/g</span>, <span class="hljs-string">"|l"</span>)
    .replace(<span class="hljs-regexp">/\u2029/g</span>, <span class="hljs-string">"|p"</span>)
    .replace(<span class="hljs-regexp">/'/g</span>, <span class="hljs-string">"|'"</span>);
}

}); <span class="hljs-comment">// module: reporters/teamcity.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"reporters/xunit.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./base'</span>)
  , utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>)
  , <span class="hljs-built_in">escape</span> = utils.escape;

<span class="hljs-comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="hljs-keyword">var</span> <span class="hljs-built_in">Date</span> = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="hljs-comment">/**
 * Expose `XUnit`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = XUnit;

<span class="hljs-comment">/**
 * Initialize a new `XUnit` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">XUnit</span><span class="hljs-params">(runner)</span> </span>{
  Base.call(<span class="hljs-keyword">this</span>, runner);
  <span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">this</span>.stats
    , tests = []
    , self = <span class="hljs-keyword">this</span>;

  runner.on(<span class="hljs-string">'pass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    tests.push(test);
  });
  
  runner.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    tests.push(test);
  });

  runner.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-built_in">console</span>.log(tag(<span class="hljs-string">'testsuite'</span>, {
        name: <span class="hljs-string">'Mocha Tests'</span>
      , tests: stats.tests
      , failures: stats.failures
      , errors: stats.failures
      , skip: stats.tests - stats.failures - stats.passes
      , timestamp: (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).toUTCString()
      , time: stats.duration / <span class="hljs-number">1000</span>
    }, <span class="hljs-literal">false</span>));

    tests.forEach(test);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'&lt;/testsuite&gt;'</span>);    
  });
}

<span class="hljs-comment">/**
 * Inherit from `Base.prototype`.
 */</span>

XUnit.prototype = <span class="hljs-keyword">new</span> Base;
XUnit.prototype.constructor = XUnit;


<span class="hljs-comment">/**
 * Output tag for the given `test.`
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span><span class="hljs-params">(test)</span> </span>{
  <span class="hljs-keyword">var</span> attrs = {
      classname: test.parent.fullTitle()
    , name: test.title
    , time: test.duration / <span class="hljs-number">1000</span>
  };

  <span class="hljs-keyword">if</span> (<span class="hljs-string">'failed'</span> == test.state) {
    <span class="hljs-keyword">var</span> err = test.err;
    attrs.message = <span class="hljs-built_in">escape</span>(err.message);
    <span class="hljs-built_in">console</span>.log(tag(<span class="hljs-string">'testcase'</span>, attrs, <span class="hljs-literal">false</span>, tag(<span class="hljs-string">'failure'</span>, attrs, <span class="hljs-literal">false</span>, cdata(err.stack))));
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (test.pending) {
    <span class="hljs-built_in">console</span>.log(tag(<span class="hljs-string">'testcase'</span>, attrs, <span class="hljs-literal">false</span>, tag(<span class="hljs-string">'skipped'</span>, {}, <span class="hljs-literal">true</span>)));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">console</span>.log(tag(<span class="hljs-string">'testcase'</span>, attrs, <span class="hljs-literal">true</span>) );
  }
}

<span class="hljs-comment">/**
 * HTML tag helper.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tag</span><span class="hljs-params">(name, attrs, close, content)</span> </span>{
  <span class="hljs-keyword">var</span> end = close ? <span class="hljs-string">'/&gt;'</span> : <span class="hljs-string">'&gt;'</span>
    , pairs = []
    , tag;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> attrs) {
    pairs.push(key + <span class="hljs-string">'="'</span> + <span class="hljs-built_in">escape</span>(attrs[key]) + <span class="hljs-string">'"'</span>);
  }

  tag = <span class="hljs-string">'&lt;'</span> + name + (pairs.length ? <span class="hljs-string">' '</span> + pairs.join(<span class="hljs-string">' '</span>) : <span class="hljs-string">''</span>) + end;
  <span class="hljs-keyword">if</span> (content) tag += content + <span class="hljs-string">'&lt;/'</span> + name + end;
  <span class="hljs-keyword">return</span> tag;
}

<span class="hljs-comment">/**
 * Return cdata escaped CDATA `str`.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cdata</span><span class="hljs-params">(str)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;![CDATA['</span> + <span class="hljs-built_in">escape</span>(str) + <span class="hljs-string">']]&gt;'</span>;
}

}); <span class="hljs-comment">// module: reporters/xunit.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"runnable.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/events'</span>).EventEmitter
  , debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/debug'</span>)(<span class="hljs-string">'mocha:runnable'</span>);

<span class="hljs-comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="hljs-keyword">var</span> <span class="hljs-built_in">Date</span> = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="hljs-comment">/**
 * Expose `Runnable`.
 */</span>

<span class="hljs-built_in">module</span>.exports = Runnable;

<span class="hljs-comment">/**
 * Initialize a new `Runnable` with the given `title` and callback `fn`.
 *
 * @param {String} title
 * @param {Function} fn
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Runnable</span><span class="hljs-params">(title, fn)</span> </span>{
  <span class="hljs-keyword">this</span>.title = title;
  <span class="hljs-keyword">this</span>.fn = fn;
  <span class="hljs-keyword">this</span>.async = fn &amp;&amp; fn.length;
  <span class="hljs-keyword">this</span>.sync = ! <span class="hljs-keyword">this</span>.async;
  <span class="hljs-keyword">this</span>._timeout = <span class="hljs-number">2000</span>;
  <span class="hljs-keyword">this</span>._slow = <span class="hljs-number">75</span>;
  <span class="hljs-keyword">this</span>.timedOut = <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">/**
 * Inherit from `EventEmitter.prototype`.
 */</span>

Runnable.prototype = <span class="hljs-keyword">new</span> EventEmitter;
Runnable.prototype.constructor = Runnable;


<span class="hljs-comment">/**
 * Set &amp; get timeout `ms`.
 *
 * @param {Number} ms
 * @return {Runnable|Number} ms or self
 * @api private
 */</span>

Runnable.prototype.timeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ms)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == <span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._timeout;
  debug(<span class="hljs-string">'timeout %d'</span>, ms);
  <span class="hljs-keyword">this</span>._timeout = ms;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.timer) <span class="hljs-keyword">this</span>.resetTimeout();
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set &amp; get slow `ms`.
 *
 * @param {Number} ms
 * @return {Runnable|Number} ms or self
 * @api private
 */</span>

Runnable.prototype.slow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ms)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> === <span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._slow;
  debug(<span class="hljs-string">'timeout %d'</span>, ms);
  <span class="hljs-keyword">this</span>._slow = ms;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Return the full title generated by recursively
 * concatenating the parent's full title.
 *
 * @return {String}
 * @api public
 */</span>

Runnable.prototype.fullTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.parent.fullTitle() + <span class="hljs-string">' '</span> + <span class="hljs-keyword">this</span>.title;
};

<span class="hljs-comment">/**
 * Clear the timeout.
 *
 * @api private
 */</span>

Runnable.prototype.clearTimeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  clearTimeout(<span class="hljs-keyword">this</span>.timer);
};

<span class="hljs-comment">/**
 * Inspect the runnable void of private properties.
 *
 * @return {String}
 * @api private
 */</span>

Runnable.prototype.inspect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, val)</span></span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'_'</span> == key[<span class="hljs-number">0</span>]) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'parent'</span> == key) <span class="hljs-keyword">return</span> <span class="hljs-string">'#&lt;Suite&gt;'</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'ctx'</span> == key) <span class="hljs-keyword">return</span> <span class="hljs-string">'#&lt;Context&gt;'</span>;
    <span class="hljs-keyword">return</span> val;
  }, <span class="hljs-number">2</span>);
};

<span class="hljs-comment">/**
 * Reset the timeout.
 *
 * @api private
 */</span>

Runnable.prototype.resetTimeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , ms = <span class="hljs-keyword">this</span>.timeout();

  <span class="hljs-keyword">this</span>.clearTimeout();
  <span class="hljs-keyword">if</span> (ms) {
    <span class="hljs-keyword">this</span>.timer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      self.callback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'timeout of '</span> + ms + <span class="hljs-string">'ms exceeded'</span>));
      self.timedOut = <span class="hljs-literal">true</span>;
    }, ms);
  }
};

<span class="hljs-comment">/**
 * Run the test and invoke `fn(err)`.
 *
 * @param {Function} fn
 * @api private
 */</span>

Runnable.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , ms = <span class="hljs-keyword">this</span>.timeout()
    , start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>
    , ctx = <span class="hljs-keyword">this</span>.ctx
    , finished
    , emitted;

  <span class="hljs-keyword">if</span> (ctx) ctx.runnable(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>timeout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.async) {
    <span class="hljs-keyword">if</span> (ms) {
      <span class="hljs-keyword">this</span>.timer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        done(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'timeout of '</span> + ms + <span class="hljs-string">'ms exceeded'</span>));
        self.timedOut = <span class="hljs-literal">true</span>;
      }, ms);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>called multiple times</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiple</span><span class="hljs-params">(err)</span> </span>{
    <span class="hljs-keyword">if</span> (emitted) <span class="hljs-keyword">return</span>;
    emitted = <span class="hljs-literal">true</span>;
    self.emit(<span class="hljs-string">'error'</span>, err || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'done() called multiple times'</span>));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>finished</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span><span class="hljs-params">(err)</span> </span>{
    <span class="hljs-keyword">if</span> (self.timedOut) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (finished) <span class="hljs-keyword">return</span> multiple(err);
    self.clearTimeout();
    self.duration = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span> - start;
    finished = <span class="hljs-literal">true</span>;
    fn(err);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>for .resetTimeout()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.callback = done;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>async</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.async) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">this</span>.fn.call(ctx, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
        <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) <span class="hljs-keyword">return</span> done(err);
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != err) <span class="hljs-keyword">return</span> done(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'done() invoked with non-Error: '</span> + err));
        done();
      });
    } <span class="hljs-keyword">catch</span> (err) {
      done(err);
    }
    <span class="hljs-keyword">return</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>sync</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.pending) <span class="hljs-keyword">this</span>.fn.call(ctx);
    <span class="hljs-keyword">this</span>.duration = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span> - start;
    fn();
  } <span class="hljs-keyword">catch</span> (err) {
    fn(err);
  }
};

}); <span class="hljs-comment">// module: runnable.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"runner.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/events'</span>).EventEmitter
  , debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/debug'</span>)(<span class="hljs-string">'mocha:runner'</span>)
  , Test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./test'</span>)
  , utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>)
  , filter = utils.filter
  , keys = utils.keys
  , noop = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{};

<span class="hljs-comment">/**
 * Expose `Runner`.
 */</span>

<span class="hljs-built_in">module</span>.exports = Runner;

<span class="hljs-comment">/**
 * Initialize a `Runner` for the given `suite`.
 *
 * Events:
 *
 *   - `start`  execution started
 *   - `end`  execution complete
 *   - `suite`  (suite) test suite execution started
 *   - `suite end`  (suite) all tests (and sub-suites) have finished
 *   - `test`  (test) test execution started
 *   - `test end`  (test) test completed
 *   - `hook`  (hook) hook execution started
 *   - `hook end`  (hook) hook complete
 *   - `pass`  (test) test passed
 *   - `fail`  (test, err) test failed
 *
 * @api public
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Runner</span><span class="hljs-params">(suite)</span> </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">this</span>._globals = [];
  <span class="hljs-keyword">this</span>.suite = suite;
  <span class="hljs-keyword">this</span>.total = suite.total();
  <span class="hljs-keyword">this</span>.failures = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'test end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{ self.checkGlobals(test); });
  <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'hook end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(hook)</span></span>{ self.checkGlobals(hook); });
  <span class="hljs-keyword">this</span>.grep(<span class="hljs-regexp">/.*/</span>);
  <span class="hljs-keyword">this</span>.globals(utils.keys(global).concat([<span class="hljs-string">'errno'</span>]));
}

<span class="hljs-comment">/**
 * Inherit from `EventEmitter.prototype`.
 */</span>

Runner.prototype = <span class="hljs-keyword">new</span> EventEmitter;
Runner.prototype.constructor = Runner;


<span class="hljs-comment">/**
 * Run tests with full titles matching `re`. Updates runner.total
 * with number of tests matched.
 *
 * @param {RegExp} re
 * @param {Boolean} invert
 * @return {Runner} for chaining
 * @api public
 */</span>

Runner.prototype.grep = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(re, invert)</span></span>{
  debug(<span class="hljs-string">'grep %s'</span>, re);
  <span class="hljs-keyword">this</span>._grep = re;
  <span class="hljs-keyword">this</span>._invert = invert;
  <span class="hljs-keyword">this</span>.total = <span class="hljs-keyword">this</span>.grepTotal(<span class="hljs-keyword">this</span>.suite);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Returns the number of tests matching the grep search for the
 * given suite.
 *
 * @param {Suite} suite
 * @return {Number}
 * @api public
 */</span>

Runner.prototype.grepTotal = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span> </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> total = <span class="hljs-number">0</span>;

  suite.eachTest(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
    <span class="hljs-keyword">var</span> match = self._grep.test(test.fullTitle());
    <span class="hljs-keyword">if</span> (self._invert) match = !match;
    <span class="hljs-keyword">if</span> (match) total++;
  });

  <span class="hljs-keyword">return</span> total;
};

<span class="hljs-comment">/**
 * Allow the given `arr` of globals.
 *
 * @param {Array} arr
 * @return {Runner} for chaining
 * @api public
 */</span>

Runner.prototype.globals = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == <span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._globals;
  debug(<span class="hljs-string">'globals %j'</span>, arr);
  utils.forEach(arr, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr)</span></span>{
    <span class="hljs-keyword">this</span>._globals.push(arr);
  }, <span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Check for global variable leaks.
 *
 * @api private
 */</span>

Runner.prototype.checkGlobals = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.ignoreLeaks) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">var</span> leaks = filterLeaks(<span class="hljs-keyword">this</span>._globals);

  <span class="hljs-keyword">this</span>._globals = <span class="hljs-keyword">this</span>._globals.concat(leaks);

  <span class="hljs-keyword">if</span> (leaks.length &gt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">this</span>.fail(test, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'global leaks detected: '</span> + leaks.join(<span class="hljs-string">', '</span>) + <span class="hljs-string">''</span>));
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (leaks.length) {
    <span class="hljs-keyword">this</span>.fail(test, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'global leak detected: '</span> + leaks[<span class="hljs-number">0</span>]));
  }
};

<span class="hljs-comment">/**
 * Fail the given `test`.
 *
 * @param {Test} test
 * @param {Error} err
 * @api private
 */</span>

Runner.prototype.fail = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test, err)</span></span>{
  ++<span class="hljs-keyword">this</span>.failures;
  test.state = <span class="hljs-string">'failed'</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> err) {
    err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'the string "'</span> + err + <span class="hljs-string">'" was thrown, throw an Error :)'</span>);
  }
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'fail'</span>, test, err);
};

<span class="hljs-comment">/**
 * Fail the given `hook` with `err`.
 *
 * Hook failures (currently) hard-end due
 * to that fact that a failing hook will
 * surely cause subsequent tests to fail,
 * causing jumbled reporting.
 *
 * @param {Hook} hook
 * @param {Error} err
 * @api private
 */</span>

Runner.prototype.failHook = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(hook, err)</span></span>{
  <span class="hljs-keyword">this</span>.fail(hook, err);
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'end'</span>);
};

<span class="hljs-comment">/**
 * Run hook `name` callbacks and then invoke `fn()`.
 *
 * @param {String} name
 * @param {Function} function
 * @api private
 */</span>

Runner.prototype.hook = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, fn)</span></span>{
  <span class="hljs-keyword">var</span> suite = <span class="hljs-keyword">this</span>.suite
    , hooks = suite[<span class="hljs-string">'_'</span> + name]
    , self = <span class="hljs-keyword">this</span>
    , timer;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span><span class="hljs-params">(i)</span> </span>{
    <span class="hljs-keyword">var</span> hook = hooks[i];
    <span class="hljs-keyword">if</span> (!hook) <span class="hljs-keyword">return</span> fn();
    self.currentRunnable = hook;

    self.emit(<span class="hljs-string">'hook'</span>, hook);

    hook.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
      self.failHook(hook, err);
    });

    hook.run(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
      hook.removeAllListeners(<span class="hljs-string">'error'</span>);
      <span class="hljs-keyword">var</span> testError = hook.error();
      <span class="hljs-keyword">if</span> (testError) self.fail(self.test, testError);
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> self.failHook(hook, err);
      self.emit(<span class="hljs-string">'hook end'</span>, hook);
      next(++i);
    });
  }

  process.nextTick(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    next(<span class="hljs-number">0</span>);
  });
};

<span class="hljs-comment">/**
 * Run hook `name` for the given array of `suites`
 * in order, and callback `fn(err)`.
 *
 * @param {String} name
 * @param {Array} suites
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.hooks = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, suites, fn)</span></span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , orig = <span class="hljs-keyword">this</span>.suite;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span><span class="hljs-params">(suite)</span> </span>{
    self.suite = suite;

    <span class="hljs-keyword">if</span> (!suite) {
      self.suite = orig;
      <span class="hljs-keyword">return</span> fn();
    }

    self.hook(name, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
      <span class="hljs-keyword">if</span> (err) {
        self.suite = orig;
        <span class="hljs-keyword">return</span> fn(err);
      }

      next(suites.pop());
    });
  }

  next(suites.pop());
};

<span class="hljs-comment">/**
 * Run hooks from the top level down.
 *
 * @param {String} name
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.hookUp = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, fn)</span></span>{
  <span class="hljs-keyword">var</span> suites = [<span class="hljs-keyword">this</span>.suite].concat(<span class="hljs-keyword">this</span>.parents()).reverse();
  <span class="hljs-keyword">this</span>.hooks(name, suites, fn);
};

<span class="hljs-comment">/**
 * Run hooks from the bottom up.
 *
 * @param {String} name
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.hookDown = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, fn)</span></span>{
  <span class="hljs-keyword">var</span> suites = [<span class="hljs-keyword">this</span>.suite].concat(<span class="hljs-keyword">this</span>.parents());
  <span class="hljs-keyword">this</span>.hooks(name, suites, fn);
};

<span class="hljs-comment">/**
 * Return an array of parent Suites from
 * closest to furthest.
 *
 * @return {Array}
 * @api private
 */</span>

Runner.prototype.parents = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> suite = <span class="hljs-keyword">this</span>.suite
    , suites = [];
  <span class="hljs-keyword">while</span> (suite = suite.parent) suites.push(suite);
  <span class="hljs-keyword">return</span> suites;
};

<span class="hljs-comment">/**
 * Run the current test and callback `fn(err)`.
 *
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.runTest = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">var</span> test = <span class="hljs-keyword">this</span>.test
    , self = <span class="hljs-keyword">this</span>;

  <span class="hljs-keyword">try</span> {
    test.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
      self.fail(test, err);
    });
    test.run(fn);
  } <span class="hljs-keyword">catch</span> (err) {
    fn(err);
  }
};

<span class="hljs-comment">/**
 * Run tests in the given `suite` and invoke
 * the callback `fn()` when complete.
 *
 * @param {Suite} suite
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.runTests = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite, fn)</span></span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , tests = suite.tests
    , test;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span><span class="hljs-params">(err)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>if we bail after first err</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (self.failures &amp;&amp; suite._bail) <span class="hljs-keyword">return</span> fn();</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>next test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    test = tests.shift();</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>all done</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!test) <span class="hljs-keyword">return</span> fn();</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>grep</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> match = self._grep.test(test.fullTitle());
    <span class="hljs-keyword">if</span> (self._invert) match = !match;
    <span class="hljs-keyword">if</span> (!match) <span class="hljs-keyword">return</span> next();</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>pending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (test.pending) {
      self.emit(<span class="hljs-string">'pending'</span>, test);
      self.emit(<span class="hljs-string">'test end'</span>, test);
      <span class="hljs-keyword">return</span> next();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>execute test and hook(s)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.emit(<span class="hljs-string">'test'</span>, self.test = test);
    self.hookDown(<span class="hljs-string">'beforeEach'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      self.currentRunnable = self.test;
      self.runTest(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
        test = self.test;

        <span class="hljs-keyword">if</span> (err) {
          self.fail(test, err);
          self.emit(<span class="hljs-string">'test end'</span>, test);
          <span class="hljs-keyword">return</span> self.hookUp(<span class="hljs-string">'afterEach'</span>, next);
        }

        test.state = <span class="hljs-string">'passed'</span>;
        self.emit(<span class="hljs-string">'pass'</span>, test);
        self.emit(<span class="hljs-string">'test end'</span>, test);
        self.hookUp(<span class="hljs-string">'afterEach'</span>, next);
      });
    });
  }

  <span class="hljs-keyword">this</span>.next = next;
  next();
};

<span class="hljs-comment">/**
 * Run the given `suite` and invoke the
 * callback `fn()` when complete.
 *
 * @param {Suite} suite
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.runSuite = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite, fn)</span></span>{
  <span class="hljs-keyword">var</span> total = <span class="hljs-keyword">this</span>.grepTotal(suite)
    , self = <span class="hljs-keyword">this</span>
    , i = <span class="hljs-number">0</span>;

  debug(<span class="hljs-string">'run suite %s'</span>, suite.fullTitle());

  <span class="hljs-keyword">if</span> (!total) <span class="hljs-keyword">return</span> fn();

  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'suite'</span>, <span class="hljs-keyword">this</span>.suite = suite);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> curr = suite.suites[i++];
    <span class="hljs-keyword">if</span> (!curr) <span class="hljs-keyword">return</span> done();
    self.runSuite(curr, next);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span><span class="hljs-params">()</span> </span>{
    self.suite = suite;
    self.hook(<span class="hljs-string">'afterAll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      self.emit(<span class="hljs-string">'suite end'</span>, suite);
      fn();
    });
  }

  <span class="hljs-keyword">this</span>.hook(<span class="hljs-string">'beforeAll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    self.runTests(suite, next);
  });
};

<span class="hljs-comment">/**
 * Handle uncaught exceptions.
 *
 * @param {Error} err
 * @api private
 */</span>

Runner.prototype.uncaught = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
  debug(<span class="hljs-string">'uncaught exception %s'</span>, err.message);
  <span class="hljs-keyword">var</span> runnable = <span class="hljs-keyword">this</span>.currentRunnable;
  <span class="hljs-keyword">if</span> (!runnable || <span class="hljs-string">'failed'</span> == runnable.state) <span class="hljs-keyword">return</span>;
  runnable.clearTimeout();
  err.uncaught = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">this</span>.fail(runnable, err);</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>recover from test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-string">'test'</span> == runnable.type) {
    <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'test end'</span>, runnable);
    <span class="hljs-keyword">this</span>.hookUp(<span class="hljs-string">'afterEach'</span>, <span class="hljs-keyword">this</span>.next);
    <span class="hljs-keyword">return</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>bail on hooks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'end'</span>);
};

<span class="hljs-comment">/**
 * Run the root suite and invoke `fn(failures)`
 * on completion.
 *
 * @param {Function} fn
 * @return {Runner} for chaining
 * @api public
 */</span>

Runner.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
    , fn = fn || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{};

  debug(<span class="hljs-string">'start'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>uncaught callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uncaught</span><span class="hljs-params">(err)</span> </span>{
    self.uncaught(err);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    debug(<span class="hljs-string">'end'</span>);
    process.removeListener(<span class="hljs-string">'uncaughtException'</span>, uncaught);
    fn(self.failures);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>run suites</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'start'</span>);
  <span class="hljs-keyword">this</span>.runSuite(<span class="hljs-keyword">this</span>.suite, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    debug(<span class="hljs-string">'finished running'</span>);
    self.emit(<span class="hljs-string">'end'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>uncaught exception</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  process.on(<span class="hljs-string">'uncaughtException'</span>, uncaught);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Filter leaks with the given globals flagged as `ok`.
 *
 * @param {Array} ok
 * @return {Array}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterLeaks</span><span class="hljs-params">(ok)</span> </span>{
  <span class="hljs-keyword">return</span> filter(keys(global), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span></span>{
    <span class="hljs-keyword">var</span> matched = filter(ok, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ok)</span></span>{
      <span class="hljs-keyword">if</span> (~ok.indexOf(<span class="hljs-string">'*'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> == key.indexOf(ok.split(<span class="hljs-string">'*'</span>)[<span class="hljs-number">0</span>]);
      <span class="hljs-keyword">return</span> key == ok;
    });
    <span class="hljs-keyword">return</span> matched.length == <span class="hljs-number">0</span> &amp;&amp; (!global.navigator || <span class="hljs-string">'onerror'</span> !== key);
  });
}

}); <span class="hljs-comment">// module: runner.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"suite.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/events'</span>).EventEmitter
  , debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/debug'</span>)(<span class="hljs-string">'mocha:suite'</span>)
  , milliseconds = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./ms'</span>)
  , utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>)
  , Hook = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./hook'</span>);

<span class="hljs-comment">/**
 * Expose `Suite`.
 */</span>

exports = <span class="hljs-built_in">module</span>.exports = Suite;

<span class="hljs-comment">/**
 * Create a new `Suite` with the given `title`
 * and parent `Suite`. When a suite with the
 * same title is already present, that suite
 * is returned to provide nicer reporter
 * and more flexible meta-testing.
 *
 * @param {Suite} parent
 * @param {String} title
 * @return {Suite}
 * @api public
 */</span>

exports.create = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parent, title)</span></span>{
  <span class="hljs-keyword">var</span> suite = <span class="hljs-keyword">new</span> Suite(title, parent.ctx);
  suite.parent = parent;
  <span class="hljs-keyword">if</span> (parent.pending) suite.pending = <span class="hljs-literal">true</span>;
  title = suite.fullTitle();
  parent.addSuite(suite);
  <span class="hljs-keyword">return</span> suite;
};

<span class="hljs-comment">/**
 * Initialize a new `Suite` with the given
 * `title` and `ctx`.
 *
 * @param {String} title
 * @param {Context} ctx
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Suite</span><span class="hljs-params">(title, ctx)</span> </span>{
  <span class="hljs-keyword">this</span>.title = title;
  <span class="hljs-keyword">this</span>.ctx = ctx;
  <span class="hljs-keyword">this</span>.suites = [];
  <span class="hljs-keyword">this</span>.tests = [];
  <span class="hljs-keyword">this</span>.pending = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">this</span>._beforeEach = [];
  <span class="hljs-keyword">this</span>._beforeAll = [];
  <span class="hljs-keyword">this</span>._afterEach = [];
  <span class="hljs-keyword">this</span>._afterAll = [];
  <span class="hljs-keyword">this</span>.root = !title;
  <span class="hljs-keyword">this</span>._timeout = <span class="hljs-number">2000</span>;
  <span class="hljs-keyword">this</span>._slow = <span class="hljs-number">75</span>;
  <span class="hljs-keyword">this</span>._bail = <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">/**
 * Inherit from `EventEmitter.prototype`.
 */</span>

Suite.prototype = <span class="hljs-keyword">new</span> EventEmitter;
Suite.prototype.constructor = Suite;


<span class="hljs-comment">/**
 * Return a clone of this `Suite`.
 *
 * @return {Suite}
 * @api private
 */</span>

Suite.prototype.clone = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> suite = <span class="hljs-keyword">new</span> Suite(<span class="hljs-keyword">this</span>.title);
  debug(<span class="hljs-string">'clone'</span>);
  suite.ctx = <span class="hljs-keyword">this</span>.ctx;
  suite.timeout(<span class="hljs-keyword">this</span>.timeout());
  suite.slow(<span class="hljs-keyword">this</span>.slow());
  suite.bail(<span class="hljs-keyword">this</span>.bail());
  <span class="hljs-keyword">return</span> suite;
};

<span class="hljs-comment">/**
 * Set timeout `ms` or short-hand such as "2s".
 *
 * @param {Number|String} ms
 * @return {Suite|Number} for chaining
 * @api private
 */</span>

Suite.prototype.timeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ms)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == <span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._timeout;
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> ms) ms = milliseconds(ms);
  debug(<span class="hljs-string">'timeout %d'</span>, ms);
  <span class="hljs-keyword">this</span>._timeout = <span class="hljs-built_in">parseInt</span>(ms, <span class="hljs-number">10</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Set slow `ms` or short-hand such as "2s".
 *
 * @param {Number|String} ms
 * @return {Suite|Number} for chaining
 * @api private
 */</span>

Suite.prototype.slow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ms)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> === <span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._slow;
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> ms) ms = milliseconds(ms);
  debug(<span class="hljs-string">'slow %d'</span>, ms);
  <span class="hljs-keyword">this</span>._slow = ms;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Sets whether to bail after first error.
 *
 * @parma {Boolean} bail
 * @return {Suite|Number} for chaining
 * @api private
 */</span>

Suite.prototype.bail = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bail)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == <span class="hljs-built_in">arguments</span>.length) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._bail;
  debug(<span class="hljs-string">'bail %s'</span>, bail);
  <span class="hljs-keyword">this</span>._bail = bail;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Run `fn(test[, done])` before running tests.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.beforeAll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pending) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> hook = <span class="hljs-keyword">new</span> Hook(<span class="hljs-string">'"before all" hook'</span>, fn);
  hook.parent = <span class="hljs-keyword">this</span>;
  hook.timeout(<span class="hljs-keyword">this</span>.timeout());
  hook.slow(<span class="hljs-keyword">this</span>.slow());
  hook.ctx = <span class="hljs-keyword">this</span>.ctx;
  <span class="hljs-keyword">this</span>._beforeAll.push(hook);
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'beforeAll'</span>, hook);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Run `fn(test[, done])` after running tests.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.afterAll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pending) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> hook = <span class="hljs-keyword">new</span> Hook(<span class="hljs-string">'"after all" hook'</span>, fn);
  hook.parent = <span class="hljs-keyword">this</span>;
  hook.timeout(<span class="hljs-keyword">this</span>.timeout());
  hook.slow(<span class="hljs-keyword">this</span>.slow());
  hook.ctx = <span class="hljs-keyword">this</span>.ctx;
  <span class="hljs-keyword">this</span>._afterAll.push(hook);
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'afterAll'</span>, hook);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Run `fn(test[, done])` before each test case.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.beforeEach = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pending) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> hook = <span class="hljs-keyword">new</span> Hook(<span class="hljs-string">'"before each" hook'</span>, fn);
  hook.parent = <span class="hljs-keyword">this</span>;
  hook.timeout(<span class="hljs-keyword">this</span>.timeout());
  hook.slow(<span class="hljs-keyword">this</span>.slow());
  hook.ctx = <span class="hljs-keyword">this</span>.ctx;
  <span class="hljs-keyword">this</span>._beforeEach.push(hook);
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'beforeEach'</span>, hook);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Run `fn(test[, done])` after each test case.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.afterEach = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pending) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> hook = <span class="hljs-keyword">new</span> Hook(<span class="hljs-string">'"after each" hook'</span>, fn);
  hook.parent = <span class="hljs-keyword">this</span>;
  hook.timeout(<span class="hljs-keyword">this</span>.timeout());
  hook.slow(<span class="hljs-keyword">this</span>.slow());
  hook.ctx = <span class="hljs-keyword">this</span>.ctx;
  <span class="hljs-keyword">this</span>._afterEach.push(hook);
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'afterEach'</span>, hook);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Add a test `suite`.
 *
 * @param {Suite} suite
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.addSuite = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
  suite.parent = <span class="hljs-keyword">this</span>;
  suite.timeout(<span class="hljs-keyword">this</span>.timeout());
  suite.slow(<span class="hljs-keyword">this</span>.slow());
  suite.bail(<span class="hljs-keyword">this</span>.bail());
  <span class="hljs-keyword">this</span>.suites.push(suite);
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'suite'</span>, suite);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Add a `test` to this suite.
 *
 * @param {Test} test
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.addTest = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  test.parent = <span class="hljs-keyword">this</span>;
  test.timeout(<span class="hljs-keyword">this</span>.timeout());
  test.slow(<span class="hljs-keyword">this</span>.slow());
  test.ctx = <span class="hljs-keyword">this</span>.ctx;
  <span class="hljs-keyword">this</span>.tests.push(test);
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'test'</span>, test);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-comment">/**
 * Return the full title generated by recursively
 * concatenating the parent's full title.
 *
 * @return {String}
 * @api public
 */</span>

Suite.prototype.fullTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.parent) {
    <span class="hljs-keyword">var</span> full = <span class="hljs-keyword">this</span>.parent.fullTitle();
    <span class="hljs-keyword">if</span> (full) <span class="hljs-keyword">return</span> full + <span class="hljs-string">' '</span> + <span class="hljs-keyword">this</span>.title;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.title;
};

<span class="hljs-comment">/**
 * Return the total number of tests.
 *
 * @return {Number}
 * @api public
 */</span>

Suite.prototype.total = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">return</span> utils.reduce(<span class="hljs-keyword">this</span>.suites, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sum, suite)</span></span>{
    <span class="hljs-keyword">return</span> sum + suite.total();
  }, <span class="hljs-number">0</span>) + <span class="hljs-keyword">this</span>.tests.length;
};

<span class="hljs-comment">/**
 * Iterates through each suite recursively to find
 * all tests. Applies a function in the format
 * `fn(test)`.
 *
 * @param {Function} fn
 * @return {Suite}
 * @api private
 */</span>

Suite.prototype.eachTest = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
  utils.forEach(<span class="hljs-keyword">this</span>.tests, fn);
  utils.forEach(<span class="hljs-keyword">this</span>.suites, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(suite)</span></span>{
    suite.eachTest(fn);
  });
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

}); <span class="hljs-comment">// module: suite.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"test.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> Runnable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./runnable'</span>);

<span class="hljs-comment">/**
 * Expose `Test`.
 */</span>

<span class="hljs-built_in">module</span>.exports = Test;

<span class="hljs-comment">/**
 * Initialize a new `Test` with the given `title` and callback `fn`.
 *
 * @param {String} title
 * @param {Function} fn
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Test</span><span class="hljs-params">(title, fn)</span> </span>{
  Runnable.call(<span class="hljs-keyword">this</span>, title, fn);
  <span class="hljs-keyword">this</span>.pending = !fn;
  <span class="hljs-keyword">this</span>.type = <span class="hljs-string">'test'</span>;
}

<span class="hljs-comment">/**
 * Inherit from `Runnable.prototype`.
 */</span>

Test.prototype = <span class="hljs-keyword">new</span> Runnable;
Test.prototype.constructor = Test;


}); <span class="hljs-comment">// module: test.js</span>

<span class="hljs-built_in">require</span>.register(<span class="hljs-string">"utils.js"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(module, exports, require)</span></span>{

<span class="hljs-comment">/**
 * Module dependencies.
 */</span>

<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/fs'</span>)
  , path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/path'</span>)
  , join = path.join
  , debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browser/debug'</span>)(<span class="hljs-string">'mocha:watch'</span>);

<span class="hljs-comment">/**
 * Ignored directories.
 */</span>

<span class="hljs-keyword">var</span> ignore = [<span class="hljs-string">'node_modules'</span>, <span class="hljs-string">'.git'</span>];

<span class="hljs-comment">/**
 * Escape special characters in the given string of html.
 *
 * @param  {String} html
 * @return {String}
 * @api private
 */</span>

exports.escape = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(html)</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>(html)
    .replace(<span class="hljs-regexp">/&amp;/g</span>, <span class="hljs-string">'&amp;amp;'</span>)
    .replace(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">'&amp;quot;'</span>)
    .replace(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">'&amp;lt;'</span>)
    .replace(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">'&amp;gt;'</span>);
};

<span class="hljs-comment">/**
 * Array#forEach (&lt;=IE8)
 *
 * @param {Array} array
 * @param {Function} fn
 * @param {Object} scope
 * @api private
 */</span>

exports.forEach = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr, fn, scope)</span></span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = arr.length; i &lt; l; i++)
    fn.call(scope, arr[i], i);
};

<span class="hljs-comment">/**
 * Array#indexOf (&lt;=IE8)
 *
 * @parma {Array} arr
 * @param {Object} obj to find index of
 * @param {Number} start
 * @api private
 */</span>

exports.indexOf = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr, obj, start)</span></span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = start || <span class="hljs-number">0</span>, l = arr.length; i &lt; l; i++) {
    <span class="hljs-keyword">if</span> (arr[i] === obj)
      <span class="hljs-keyword">return</span> i;
  }
  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
};

<span class="hljs-comment">/**
 * Array#reduce (&lt;=IE8)
 * 
 * @param {Array} array
 * @param {Function} fn
 * @param {Object} initial value
 * @api private
 */</span>

exports.reduce = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr, fn, val)</span></span>{
  <span class="hljs-keyword">var</span> rval = val;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = arr.length; i &lt; l; i++) {
    rval = fn(rval, arr[i], i, arr);
  }

  <span class="hljs-keyword">return</span> rval;
};

<span class="hljs-comment">/**
 * Array#filter (&lt;=IE8)
 *
 * @param {Array} array
 * @param {Function} fn
 * @api private
 */</span>

exports.filter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr, fn)</span></span>{
  <span class="hljs-keyword">var</span> ret = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = arr.length; i &lt; l; i++) {
    <span class="hljs-keyword">var</span> val = arr[i];
    <span class="hljs-keyword">if</span> (fn(val, i, arr)) ret.push(val);
  }

  <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-comment">/**
 * Object.keys (&lt;=IE8)
 *
 * @param {Object} obj
 * @return {Array} keys
 * @api private
 */</span>

exports.keys = <span class="hljs-built_in">Object</span>.keys || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
  <span class="hljs-keyword">var</span> keys = []
    , has = <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty <span class="hljs-comment">// for `window` on &lt;=IE8</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">if</span> (has.call(obj, key)) {
      keys.push(key);
    }
  }

  <span class="hljs-keyword">return</span> keys;
};

<span class="hljs-comment">/**
 * Watch the given `files` for changes
 * and invoke `fn(file)` on modification.
 *
 * @param {Array} files
 * @param {Function} fn
 * @api private
 */</span>

exports.watch = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(files, fn)</span></span>{
  <span class="hljs-keyword">var</span> options = { interval: <span class="hljs-number">100</span> };
  files.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file)</span></span>{
    debug(<span class="hljs-string">'file %s'</span>, file);
    fs.watchFile(file, options, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(curr, prev)</span></span>{
      <span class="hljs-keyword">if</span> (prev.mtime &lt; curr.mtime) fn(file);
    });
  });
};

<span class="hljs-comment">/**
 * Ignored files.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ignored</span><span class="hljs-params">(path)</span></span>{
  <span class="hljs-keyword">return</span> !~ignore.indexOf(path);
}

<span class="hljs-comment">/**
 * Lookup files in the given `dir`.
 *
 * @return {Array}
 * @api private
 */</span>

exports.files = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dir, ret)</span></span>{
  ret = ret || [];

  fs.readdirSync(dir)
  .filter(ignored)
  .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(path)</span></span>{
    path = join(dir, path);
    <span class="hljs-keyword">if</span> (fs.statSync(path).isDirectory()) {
      exports.files(path, ret);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path.match(<span class="hljs-regexp">/\.(js|coffee)$/</span>)) {
      ret.push(path);
    }
  });

  <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-comment">/**
 * Compute a slug from the given `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

exports.slug = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> str
    .toLowerCase()
    .replace(<span class="hljs-regexp">/ +/g</span>, <span class="hljs-string">'-'</span>)
    .replace(<span class="hljs-regexp">/[^-\w]/g</span>, <span class="hljs-string">''</span>);
};

<span class="hljs-comment">/**
 * Strip the function definition from `str`,
 * and re-indent for pre whitespace.
 */</span>

exports.clean = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span> </span>{
  str = str
    .replace(<span class="hljs-regexp">/^function *\(.*\) *{/</span>, <span class="hljs-string">''</span>)
    .replace(<span class="hljs-regexp">/\s+\}$/</span>, <span class="hljs-string">''</span>);

  <span class="hljs-keyword">var</span> spaces = str.match(<span class="hljs-regexp">/^\n?( *)/</span>)[<span class="hljs-number">1</span>].length
    , re = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'^ {'</span> + spaces + <span class="hljs-string">'}'</span>, <span class="hljs-string">'gm'</span>);

  str = str.replace(re, <span class="hljs-string">''</span>);

  <span class="hljs-keyword">return</span> exports.trim(str);
};

<span class="hljs-comment">/**
 * Escape regular expression characters in `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

exports.escapeRegexp = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/[-\\^$*+?.()|[\]{}]/g</span>, <span class="hljs-string">"\\$&amp;"</span>);
};

<span class="hljs-comment">/**
 * Trim the given `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

exports.trim = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/^\s+|\s+$/g</span>, <span class="hljs-string">''</span>);
};

<span class="hljs-comment">/**
 * Parse the given `qs`.
 *
 * @param {String} qs
 * @return {Object}
 * @api private
 */</span>

exports.parseQuery = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(qs)</span></span>{
  <span class="hljs-keyword">return</span> exports.reduce(qs.replace(<span class="hljs-string">'?'</span>, <span class="hljs-string">''</span>).split(<span class="hljs-string">'&amp;'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj, pair)</span></span>{
    <span class="hljs-keyword">var</span> i = pair.indexOf(<span class="hljs-string">'='</span>)
      , key = pair.slice(<span class="hljs-number">0</span>, i)
      , val = pair.slice(++i);

    obj[key] = <span class="hljs-built_in">decodeURIComponent</span>(val);
    <span class="hljs-keyword">return</span> obj;
  }, {});
};

<span class="hljs-comment">/**
 * Highlight the given string of `js`.
 *
 * @param {String} js
 * @return {String}
 * @api private
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlight</span><span class="hljs-params">(js)</span> </span>{
  <span class="hljs-keyword">return</span> js
    .replace(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">'&amp;lt;'</span>)
    .replace(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">'&amp;gt;'</span>)
    .replace(<span class="hljs-regexp">/\/\/(.*)/gm</span>, <span class="hljs-string">'&lt;span class="comment"&gt;//$1&lt;/span&gt;'</span>)
    .replace(<span class="hljs-regexp">/('.*?')/gm</span>, <span class="hljs-string">'&lt;span class="string"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="hljs-regexp">/(\d+\.\d+)/gm</span>, <span class="hljs-string">'&lt;span class="number"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="hljs-regexp">/(\d+)/gm</span>, <span class="hljs-string">'&lt;span class="number"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="hljs-regexp">/\bnew *(\w+)/gm</span>, <span class="hljs-string">'&lt;span class="keyword"&gt;new&lt;/span&gt; &lt;span class="init"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="hljs-regexp">/\b(function|new|throw|return|var|if|else)\b/gm</span>, <span class="hljs-string">'&lt;span class="keyword"&gt;$1&lt;/span&gt;'</span>)
}

<span class="hljs-comment">/**
 * Highlight the contents of tag `name`.
 *
 * @param {String} name
 * @api private
 */</span>

exports.highlightTags = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> </span>{
  <span class="hljs-keyword">var</span> code = <span class="hljs-built_in">document</span>.getElementsByTagName(name);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = code.length; i &lt; len; ++i) {
    code[i].innerHTML = highlight(code[i].innerHTML);
  }
};

}); <span class="hljs-comment">// module: utils.js</span>
<span class="hljs-comment">/**
 * Node shims.
 *
 * These are meant only to allow
 * mocha.js to run untouched, not
 * to allow running node code in
 * the browser.
 */</span>

process = {};
process.exit = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(status)</span></span>{};
process.stdout = {};
global = <span class="hljs-built_in">window</span>;

<span class="hljs-comment">/**
 * next tick implementation.
 */</span>

process.nextTick = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>postMessage behaves badly on IE8</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.ActiveXObject || !<span class="hljs-built_in">window</span>.postMessage) {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{ fn() };
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>based on setZeroTimeout by David Baron</p>
<ul>
<li><a href="http://dbaron.org/log/20100309-faster-timeouts">http://dbaron.org/log/20100309-faster-timeouts</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> timeouts = []
    , name = <span class="hljs-string">'mocha-zero-timeout'</span>

  <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
    <span class="hljs-keyword">if</span> (e.source == <span class="hljs-built_in">window</span> &amp;&amp; e.data == name) {
      <span class="hljs-keyword">if</span> (e.stopPropagation) e.stopPropagation();
      <span class="hljs-keyword">if</span> (timeouts.length) timeouts.shift()();
    }
  }, <span class="hljs-literal">true</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
    timeouts.push(fn);
    <span class="hljs-built_in">window</span>.postMessage(name, <span class="hljs-string">'*'</span>);
  }
})();

<span class="hljs-comment">/**
 * Remove uncaughtException listener.
 */</span>

process.removeListener = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'uncaughtException'</span> == e) {
    <span class="hljs-built_in">window</span>.onerror = <span class="hljs-literal">null</span>;
  }
};

<span class="hljs-comment">/**
 * Implements uncaughtException listener.
 */</span>

process.on = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, fn)</span></span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'uncaughtException'</span> == e) {
    <span class="hljs-built_in">window</span>.onerror = fn;
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>boot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{

  <span class="hljs-comment">/**
   * Expose mocha.
   */</span>

  <span class="hljs-keyword">var</span> Mocha = <span class="hljs-built_in">window</span>.Mocha = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mocha'</span>),
      mocha = <span class="hljs-built_in">window</span>.mocha = <span class="hljs-keyword">new</span> Mocha({ reporter: <span class="hljs-string">'html'</span> });

  <span class="hljs-comment">/**
   * Override ui to ensure that the ui functions are initialized.
   * Normally this would happen in Mocha.prototype.loadFiles.
   */</span>

  mocha.ui = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ui)</span></span>{
    Mocha.prototype.ui.call(<span class="hljs-keyword">this</span>, ui);
    <span class="hljs-keyword">this</span>.suite.emit(<span class="hljs-string">'pre-require'</span>, <span class="hljs-built_in">window</span>, <span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

  <span class="hljs-comment">/**
   * Setup mocha with the given setting options.
   */</span>

  mocha.setup = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(opts)</span></span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'string'</span> == <span class="hljs-keyword">typeof</span> opts) opts = { ui: opts };
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> opt <span class="hljs-keyword">in</span> opts) <span class="hljs-keyword">this</span>[opt](opts[opt]);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

  <span class="hljs-comment">/**
   * Run mocha, returning the Runner.
   */</span>

  mocha.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span></span>{
    <span class="hljs-keyword">var</span> options = mocha.options;
    mocha.globals(<span class="hljs-string">'location'</span>);

    <span class="hljs-keyword">var</span> query = Mocha.utils.parseQuery(<span class="hljs-built_in">window</span>.location.search || <span class="hljs-string">''</span>);
    <span class="hljs-keyword">if</span> (query.grep) mocha.grep(query.grep);

    <span class="hljs-keyword">return</span> Mocha.prototype.run.call(mocha, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      Mocha.utils.highlightTags(<span class="hljs-string">'code'</span>);
      <span class="hljs-keyword">if</span> (fn) fn();
    });
  };
})();
})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
