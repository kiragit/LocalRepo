<!DOCTYPE html>

<html>
<head>
  <title>avltree.test.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>avltree.test.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> should = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).should()
  , assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).assert
  , AVLTree = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../index'</span>).AVLTree
  , _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>)
  , customUtils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/customUtils'</span>)
  ;


describe(<span class="hljs-string">'AVL tree'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

  describe(<span class="hljs-string">'Sanity checks'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Checking that all nodes heights are correct'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> _AVLTree = AVLTree._AVLTree
        , avlt = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">10</span> })
        , l = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">5</span> })
        , r = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">15</span> })
        , ll = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">3</span> })
        , lr = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">8</span> })
        , rl = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">13</span> })
        , rr = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">18</span> })
        , lrl = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">7</span> })
        , lrll = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">6</span> })
        ;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>With a balanced tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt.left = l;
      avlt.right = r;
      l.left = ll;
      l.right = lr;
      r.left = rl;
      r.right = rr;

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      avlt.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      l.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      r.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      ll.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      lr.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      rl.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      rr.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      avlt.height = <span class="hljs-number">2</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      l.height = <span class="hljs-number">2</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      r.height = <span class="hljs-number">2</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      avlt.height = <span class="hljs-number">3</span>;
      avlt.checkHeightCorrect();   <span class="hljs-comment">// Correct</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>With an unbalanced tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      lr.left = lrl;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      lrl.left = lrll;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      lrl.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      lrll.height = <span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      lrl.height = <span class="hljs-number">2</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      lr.height = <span class="hljs-number">3</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      l.height = <span class="hljs-number">4</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkHeightCorrect() }).should.throw();
      avlt.height = <span class="hljs-number">5</span>;
      avlt.checkHeightCorrect();   <span class="hljs-comment">// Correct</span>
    });

    it(<span class="hljs-string">'Calculate the balance factor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> _AVLTree = AVLTree._AVLTree
        , avlt = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">10</span> })
        , l = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">5</span> })
        , r = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">15</span> })
        , ll = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">3</span> })
        , lr = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">8</span> })
        , rl = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">13</span> })
        , rr = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">18</span> })
        , lrl = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">7</span> })
        , lrll = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">6</span> })
        ;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>With a balanced tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt.left = l;
      avlt.right = r;
      l.left = ll;
      l.right = lr;
      r.left = rl;
      r.right = rr;

      ll.height = <span class="hljs-number">1</span>;
      rl.height = <span class="hljs-number">1</span>;
      rr.height = <span class="hljs-number">1</span>;
      avlt.height = <span class="hljs-number">2</span>;
      r.height = <span class="hljs-number">2</span>;
      lr.left = lrl;
      lrl.left = lrll;
      lrl.height = <span class="hljs-number">1</span>;
      lrll.height = <span class="hljs-number">1</span>;
      lrl.height = <span class="hljs-number">2</span>;
      lr.height = <span class="hljs-number">3</span>;
      l.height = <span class="hljs-number">4</span>;
      avlt.height = <span class="hljs-number">5</span>;
      avlt.checkHeightCorrect();   <span class="hljs-comment">// Correct</span>

      lrll.balanceFactor().should.equal(<span class="hljs-number">0</span>);
      lrl.balanceFactor().should.equal(<span class="hljs-number">1</span>);
      ll.balanceFactor().should.equal(<span class="hljs-number">0</span>);
      lr.balanceFactor().should.equal(<span class="hljs-number">2</span>);
      rl.balanceFactor().should.equal(<span class="hljs-number">0</span>);
      rr.balanceFactor().should.equal(<span class="hljs-number">0</span>);
      l.balanceFactor().should.equal(-<span class="hljs-number">2</span>);
      r.balanceFactor().should.equal(<span class="hljs-number">0</span>);
      avlt.balanceFactor().should.equal(<span class="hljs-number">2</span>);
    });

    it(<span class="hljs-string">'Can check that a tree is balanced'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> _AVLTree = AVLTree._AVLTree
        , avlt = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">10</span> })
        , l = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">5</span> })
        , r = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">15</span> })
        , ll = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">3</span> })
        , lr = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">8</span> })
        , rl = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">13</span> })
        , rr = <span class="hljs-keyword">new</span> _AVLTree({ key: <span class="hljs-number">18</span> })

      avlt.left = l;
      avlt.right = r;
      l.left = ll;
      l.right = lr;
      r.left = rl;
      r.right = rr;

      ll.height = <span class="hljs-number">1</span>;
      lr.height = <span class="hljs-number">1</span>;
      rl.height = <span class="hljs-number">1</span>;
      rr.height = <span class="hljs-number">1</span>;
      l.height = <span class="hljs-number">2</span>;
      r.height = <span class="hljs-number">2</span>;
      avlt.height = <span class="hljs-number">3</span>;
      avlt.checkBalanceFactors();

      r.height = <span class="hljs-number">0</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkBalanceFactors(); }).should.throw();
      r.height = <span class="hljs-number">4</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkBalanceFactors(); }).should.throw();
      r.height = <span class="hljs-number">2</span>;
      avlt.checkBalanceFactors();

      ll.height = -<span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkBalanceFactors(); }).should.throw();
      ll.height = <span class="hljs-number">3</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkBalanceFactors(); }).should.throw();
      ll.height = <span class="hljs-number">1</span>;
      avlt.checkBalanceFactors();

      rl.height = -<span class="hljs-number">1</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkBalanceFactors(); }).should.throw();
      rl.height = <span class="hljs-number">3</span>;
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ avlt.checkBalanceFactors(); }).should.throw();
      rl.height = <span class="hljs-number">1</span>;
      avlt.checkBalanceFactors();
    });

  });   <span class="hljs-comment">// ==== End of 'Sanity checks' ==== //</span>


  describe(<span class="hljs-string">'Insertion'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'The root has a height of 1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'root'</span>);
      avlt.tree.height.should.equal(<span class="hljs-number">1</span>);
    });


    it(<span class="hljs-string">'Insert at the root if its the first insertion'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'some data'</span>);

      avlt.checkIsAVLT();
      avlt.tree.key.should.equal(<span class="hljs-number">10</span>);
      _.isEqual(avlt.tree.data, [<span class="hljs-string">'some data'</span>]).should.equal(<span class="hljs-literal">true</span>);
      assert.isNull(avlt.tree.left);
      assert.isNull(avlt.tree.right);
    });

    it(<span class="hljs-string">'If uniqueness constraint not enforced, we can insert different data for same key'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'some data'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'hello'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'world'</span>);

      avlt.checkIsAVLT();
      _.isEqual(avlt.search(<span class="hljs-number">3</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]).should.equal(<span class="hljs-literal">true</span>);

      avlt.insert(<span class="hljs-number">12</span>, <span class="hljs-string">'a'</span>);
      avlt.insert(<span class="hljs-number">12</span>, <span class="hljs-string">'b'</span>);

      avlt.checkIsAVLT();
      _.isEqual(avlt.search(<span class="hljs-number">12</span>), [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>]).should.equal(<span class="hljs-literal">true</span>);
    });

    it(<span class="hljs-string">'If uniqueness constraint is enforced, we cannot insert different data for same key'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree({ unique: <span class="hljs-literal">true</span> });

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'some data'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'hello'</span>);
      <span class="hljs-keyword">try</span> {
        avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'world'</span>);
      } <span class="hljs-keyword">catch</span> (e) {
        e.errorType.should.equal(<span class="hljs-string">'uniqueViolated'</span>);
        e.key.should.equal(<span class="hljs-number">3</span>);
      }

      avlt.checkIsAVLT();
      _.isEqual(avlt.search(<span class="hljs-number">3</span>), [<span class="hljs-string">'hello'</span>]).should.equal(<span class="hljs-literal">true</span>);

      avlt.insert(<span class="hljs-number">12</span>, <span class="hljs-string">'a'</span>);
      <span class="hljs-keyword">try</span> {
        avlt.insert(<span class="hljs-number">12</span>, <span class="hljs-string">'world'</span>);
      } <span class="hljs-keyword">catch</span> (e) {
        e.errorType.should.equal(<span class="hljs-string">'uniqueViolated'</span>);
        e.key.should.equal(<span class="hljs-number">12</span>);
      }

      avlt.checkIsAVLT();
      _.isEqual(avlt.search(<span class="hljs-number">12</span>), [<span class="hljs-string">'a'</span>]).should.equal(<span class="hljs-literal">true</span>);
    });

    it(<span class="hljs-string">'Can insert 0 or the empty string'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">0</span>, <span class="hljs-string">'some data'</span>);

      avlt.checkIsAVLT();
      avlt.tree.key.should.equal(<span class="hljs-number">0</span>);
      _.isEqual(avlt.tree.data, [<span class="hljs-string">'some data'</span>]).should.equal(<span class="hljs-literal">true</span>);

      avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-string">''</span>, <span class="hljs-string">'some other data'</span>);

      avlt.checkIsAVLT();
      avlt.tree.key.should.equal(<span class="hljs-string">''</span>);
      _.isEqual(avlt.tree.data, [<span class="hljs-string">'some other data'</span>]).should.equal(<span class="hljs-literal">true</span>);
    });

    it(<span class="hljs-string">'Auto-balancing insertions'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree()
        , avlt2 = <span class="hljs-keyword">new</span> AVLTree()
        , avlt3 = <span class="hljs-keyword">new</span> AVLTree()
        ;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Balancing insertions on the left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
      avlt.insert(<span class="hljs-number">18</span>);
      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
      avlt.tree.checkIsAVLT();
      avlt.insert(<span class="hljs-number">15</span>);
      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
      avlt.tree.checkIsAVLT();
      avlt.insert(<span class="hljs-number">13</span>);
      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
      avlt.tree.checkIsAVLT();
      avlt.insert(<span class="hljs-number">10</span>);
      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);
      avlt.tree.checkIsAVLT();
      avlt.insert(<span class="hljs-number">8</span>);
      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">5</span>);
      avlt.tree.checkIsAVLT();
      avlt.insert(<span class="hljs-number">5</span>);
      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">6</span>);
      avlt.tree.checkIsAVLT();
      avlt.insert(<span class="hljs-number">3</span>);
      avlt.tree.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.tree.checkIsAVLT();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Balancing insertions on the right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
      avlt2.insert(<span class="hljs-number">3</span>);
      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
      avlt2.tree.checkIsAVLT();
      avlt2.insert(<span class="hljs-number">5</span>);
      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
      avlt2.tree.checkIsAVLT();
      avlt2.insert(<span class="hljs-number">8</span>);
      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
      avlt2.tree.checkIsAVLT();
      avlt2.insert(<span class="hljs-number">10</span>);
      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);
      avlt2.tree.checkIsAVLT();
      avlt2.insert(<span class="hljs-number">13</span>);
      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">5</span>);
      avlt2.tree.checkIsAVLT();
      avlt2.insert(<span class="hljs-number">15</span>);
      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">6</span>);
      avlt2.tree.checkIsAVLT();
      avlt2.insert(<span class="hljs-number">18</span>);
      avlt2.tree.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt2.tree.checkIsAVLT();</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Balancing already-balanced insertions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
      avlt3.insert(<span class="hljs-number">10</span>);
      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
      avlt3.tree.checkIsAVLT();
      avlt3.insert(<span class="hljs-number">5</span>);
      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
      avlt3.tree.checkIsAVLT();
      avlt3.insert(<span class="hljs-number">15</span>);
      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
      avlt3.tree.checkIsAVLT();
      avlt3.insert(<span class="hljs-number">3</span>);
      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);
      avlt3.tree.checkIsAVLT();
      avlt3.insert(<span class="hljs-number">8</span>);
      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">5</span>);
      avlt3.tree.checkIsAVLT();
      avlt3.insert(<span class="hljs-number">13</span>);
      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">6</span>);
      avlt3.tree.checkIsAVLT();
      avlt3.insert(<span class="hljs-number">18</span>);
      avlt3.tree.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt3.tree.checkIsAVLT();
    });

    it(<span class="hljs-string">'Can insert a lot of keys and still get an AVLT (sanity check)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree({ unique: <span class="hljs-literal">true</span> });

      customUtils.getRandomArray(<span class="hljs-number">1000</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n)</span> </span>{
        avlt.insert(n, <span class="hljs-string">'some data'</span>);
        avlt.checkIsAVLT();
      });

    });

  });   <span class="hljs-comment">// ==== End of 'Insertion' ==== //</span>


  describe(<span class="hljs-string">'Search'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Can find data in an AVLT'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree()
        , i;

      customUtils.getRandomArray(<span class="hljs-number">100</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n)</span> </span>{
        avlt.insert(n, <span class="hljs-string">'some data for '</span> + n);
      });

      avlt.checkIsAVLT();

      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i += <span class="hljs-number">1</span>) {
        _.isEqual(avlt.search(i), [<span class="hljs-string">'some data for '</span> + i]).should.equal(<span class="hljs-literal">true</span>);
      }
    });

    it(<span class="hljs-string">'If no data can be found, return an empty array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      customUtils.getRandomArray(<span class="hljs-number">100</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n)</span> </span>{
        <span class="hljs-keyword">if</span> (n !== <span class="hljs-number">63</span>) {
          avlt.insert(n, <span class="hljs-string">'some data for '</span> + n);
        }
      });

      avlt.checkIsAVLT();

      avlt.search(-<span class="hljs-number">2</span>).length.should.equal(<span class="hljs-number">0</span>);
      avlt.search(<span class="hljs-number">100</span>).length.should.equal(<span class="hljs-number">0</span>);
      avlt.search(<span class="hljs-number">101</span>).length.should.equal(<span class="hljs-number">0</span>);
      avlt.search(<span class="hljs-number">63</span>).length.should.equal(<span class="hljs-number">0</span>);
    });

    it(<span class="hljs-string">'Can search for data between two bounds'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">18</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'data '</span> + k);
      });

      assert.deepEqual(avlt.betweenBounds({ $gte: <span class="hljs-number">8</span>, $lte: <span class="hljs-number">15</span> }), [<span class="hljs-string">'data 8'</span>, <span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>, <span class="hljs-string">'data 15'</span>]);
      assert.deepEqual(avlt.betweenBounds({ $gt: <span class="hljs-number">8</span>, $lt: <span class="hljs-number">15</span> }), [<span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>]);
    });

    it(<span class="hljs-string">'Bounded search can handle cases where query contains both $lt and $lte, or both $gt and $gte'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">18</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'data '</span> + k);
      });

      assert.deepEqual(avlt.betweenBounds({ $gt:<span class="hljs-number">8</span>, $gte: <span class="hljs-number">8</span>, $lte: <span class="hljs-number">15</span> }), [<span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>, <span class="hljs-string">'data 15'</span>]);
      assert.deepEqual(avlt.betweenBounds({ $gt:<span class="hljs-number">5</span>, $gte: <span class="hljs-number">8</span>, $lte: <span class="hljs-number">15</span> }), [<span class="hljs-string">'data 8'</span>, <span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>, <span class="hljs-string">'data 15'</span>]);
      assert.deepEqual(avlt.betweenBounds({ $gt:<span class="hljs-number">8</span>, $gte: <span class="hljs-number">5</span>, $lte: <span class="hljs-number">15</span> }), [<span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>, <span class="hljs-string">'data 15'</span>]);

      assert.deepEqual(avlt.betweenBounds({ $gte: <span class="hljs-number">8</span>, $lte: <span class="hljs-number">15</span>, $lt: <span class="hljs-number">15</span> }), [<span class="hljs-string">'data 8'</span>, <span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>]);
      assert.deepEqual(avlt.betweenBounds({ $gte: <span class="hljs-number">8</span>, $lte: <span class="hljs-number">18</span>, $lt: <span class="hljs-number">15</span> }), [<span class="hljs-string">'data 8'</span>, <span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>]);
      assert.deepEqual(avlt.betweenBounds({ $gte: <span class="hljs-number">8</span>, $lte: <span class="hljs-number">15</span>, $lt: <span class="hljs-number">18</span> }), [<span class="hljs-string">'data 8'</span>, <span class="hljs-string">'data 10'</span>, <span class="hljs-string">'data 13'</span>, <span class="hljs-string">'data 15'</span>]);
    });

    it(<span class="hljs-string">'Bounded search can work when one or both boundaries are missing'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">18</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'data '</span> + k);
      });

      assert.deepEqual(avlt.betweenBounds({ $gte: <span class="hljs-number">11</span> }), [<span class="hljs-string">'data 13'</span>, <span class="hljs-string">'data 15'</span>, <span class="hljs-string">'data 18'</span>]);
      assert.deepEqual(avlt.betweenBounds({ $lte: <span class="hljs-number">9</span> }), [<span class="hljs-string">'data 3'</span>, <span class="hljs-string">'data 5'</span>, <span class="hljs-string">'data 8'</span>]);
    });

  });   <span class="hljs-comment">/// ==== End of 'Search' ==== //</span>


  describe(<span class="hljs-string">'Deletion'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Deletion does nothing on an empty tree'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree()
        , avltu = <span class="hljs-keyword">new</span> AVLTree({ unique: <span class="hljs-literal">true</span> });

      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
      avltu.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);

      avlt.delete(<span class="hljs-number">5</span>);
      avltu.delete(<span class="hljs-number">5</span>);

      avlt.tree.hasOwnProperty(<span class="hljs-string">'key'</span>).should.equal(<span class="hljs-literal">false</span>);
      avltu.tree.hasOwnProperty(<span class="hljs-string">'key'</span>).should.equal(<span class="hljs-literal">false</span>);

      avlt.tree.data.length.should.equal(<span class="hljs-number">0</span>);
      avltu.tree.data.length.should.equal(<span class="hljs-number">0</span>);

      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
      avltu.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
    });

    it(<span class="hljs-string">'Deleting a non-existent key doesnt have any effect'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkavlt</span> <span class="hljs-params">()</span> </span>{
        [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
          _.isEqual(avlt.search(k), [<span class="hljs-string">'some '</span> + k]).should.equal(<span class="hljs-literal">true</span>);
        });
      }

      checkavlt();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);

      avlt.delete(<span class="hljs-number">2</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">4</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">9</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">6</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">11</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">14</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">20</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">200</span>);
      checkavlt(); avlt.checkIsAVLT(); avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
    });

    it(<span class="hljs-string">'Able to delete the root if it is also a leaf'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'hello'</span>);
      avlt.tree.key.should.equal(<span class="hljs-number">10</span>);
      _.isEqual(avlt.tree.data, [<span class="hljs-string">'hello'</span>]).should.equal(<span class="hljs-literal">true</span>);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);

      avlt.delete(<span class="hljs-number">10</span>);
      avlt.tree.hasOwnProperty(<span class="hljs-string">'key'</span>).should.equal(<span class="hljs-literal">false</span>);
      avlt.tree.data.length.should.equal(<span class="hljs-number">0</span>);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
    });

    it(<span class="hljs-string">'Able to delete leaf nodes that are non-root'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>This will create an AVL tree with leaves 3, 8, 12, 37
(do a pretty print to see this)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">recreateavlt</span> <span class="hljs-params">()</span> </span>{
        avlt = <span class="hljs-keyword">new</span> AVLTree();

        [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
          avlt.insert(k, <span class="hljs-string">'some '</span> + k);
        });

        avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Check that only keys in array theRemoved were removed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkRemoved</span> <span class="hljs-params">(theRemoved)</span> </span>{
        [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
          <span class="hljs-keyword">if</span> (theRemoved.indexOf(k) !== -<span class="hljs-number">1</span>) {
            avlt.search(k).length.should.equal(<span class="hljs-number">0</span>);
          } <span class="hljs-keyword">else</span> {
            _.isEqual(avlt.search(k), [<span class="hljs-string">'some '</span> + k]).should.equal(<span class="hljs-literal">true</span>);
          }
        });

        avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span> - theRemoved.length);
      }

      recreateavlt();
      avlt.delete(<span class="hljs-number">3</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">3</span>]);

      recreateavlt();
      avlt.delete(<span class="hljs-number">8</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">8</span>]);

      recreateavlt();
      avlt.delete(<span class="hljs-number">12</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">12</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Delete all leaves in a way that makes the tree unbalanced</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      recreateavlt();
      avlt.delete(<span class="hljs-number">37</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">37</span>]);

      avlt.delete(<span class="hljs-number">12</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">12</span>, <span class="hljs-number">37</span>]);

      avlt.delete(<span class="hljs-number">15</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">37</span>]);

      avlt.delete(<span class="hljs-number">3</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">3</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">37</span>]);

      avlt.delete(<span class="hljs-number">5</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">37</span>]);

      avlt.delete(<span class="hljs-number">10</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">37</span>]);

      avlt.delete(<span class="hljs-number">8</span>);
      avlt.checkIsAVLT();
      checkRemoved([<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">37</span>]);
    });

    it(<span class="hljs-string">'Able to delete the root if it has only one child'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Root has only one child, on the left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt = <span class="hljs-keyword">new</span> AVLTree();
      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
      avlt.delete(<span class="hljs-number">10</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
      _.isEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'some 5'</span>]).should.equal(<span class="hljs-literal">true</span>);
      avlt.search(<span class="hljs-number">10</span>).length.should.equal(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Root has only one child, on the right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt = <span class="hljs-keyword">new</span> AVLTree();
      [<span class="hljs-number">10</span>, <span class="hljs-number">15</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
      avlt.delete(<span class="hljs-number">10</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
      _.isEqual(avlt.search(<span class="hljs-number">15</span>), [<span class="hljs-string">'some 15'</span>]).should.equal(<span class="hljs-literal">true</span>);
      avlt.search(<span class="hljs-number">10</span>).length.should.equal(<span class="hljs-number">0</span>);
    });

    it(<span class="hljs-string">'Able to delete non root nodes that have only one child'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree()
        , firstSet = [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">20</span>]
        , secondSet = [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">20</span>, <span class="hljs-number">17</span>, <span class="hljs-number">25</span>]
        ;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Check that only keys in array theRemoved were removed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkRemoved</span> <span class="hljs-params">(set, theRemoved)</span> </span>{
        set.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
          <span class="hljs-keyword">if</span> (theRemoved.indexOf(k) !== -<span class="hljs-number">1</span>) {
            avlt.search(k).length.should.equal(<span class="hljs-number">0</span>);
          } <span class="hljs-keyword">else</span> {
            _.isEqual(avlt.search(k), [<span class="hljs-string">'some '</span> + k]).should.equal(<span class="hljs-literal">true</span>);
          }
        });

        avlt.getNumberOfKeys().should.equal(set.length - theRemoved.length);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>First set: no rebalancing necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      firstSet.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });

      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.checkIsAVLT();

      avlt.delete(<span class="hljs-number">4</span>);   <span class="hljs-comment">// Leaf</span>
      avlt.checkIsAVLT();
      checkRemoved(firstSet, [<span class="hljs-number">4</span>]);

      avlt.delete(<span class="hljs-number">3</span>);   <span class="hljs-comment">// Node with only one child (on the left)</span>
      avlt.checkIsAVLT();
      checkRemoved(firstSet, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);

      avlt.delete(<span class="hljs-number">10</span>);   <span class="hljs-comment">// Leaf</span>
      avlt.checkIsAVLT();
      checkRemoved(firstSet, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>]);

      avlt.delete(<span class="hljs-number">15</span>);   <span class="hljs-comment">// Node with only one child (on the right)</span>
      avlt.checkIsAVLT();
      checkRemoved(firstSet, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Second set: some rebalancing necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt = <span class="hljs-keyword">new</span> AVLTree();
      secondSet.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });

      avlt.delete(<span class="hljs-number">4</span>);   <span class="hljs-comment">// Leaf</span>
      avlt.checkIsAVLT();
      checkRemoved(secondSet, [<span class="hljs-number">4</span>]);

      avlt.delete(<span class="hljs-number">3</span>);   <span class="hljs-comment">// Node with only one child (on the left), causes rebalancing</span>
      avlt.checkIsAVLT();
      checkRemoved(secondSet, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);
    });

    it(<span class="hljs-string">'Can delete the root if it has 2 children'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>No rebalancing needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">10</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">6</span>);
      [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        _.isEqual(avlt.search(k), [<span class="hljs-string">'some '</span> + k]).should.equal(<span class="hljs-literal">true</span>);
      });
      avlt.search(<span class="hljs-number">10</span>).length.should.equal(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Rebalancing needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt = <span class="hljs-keyword">new</span> AVLTree();
      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>, <span class="hljs-number">42</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">7</span>);
      avlt.delete(<span class="hljs-number">10</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">6</span>);
      [<span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">37</span>, <span class="hljs-number">42</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        _.isEqual(avlt.search(k), [<span class="hljs-string">'some '</span> + k]).should.equal(<span class="hljs-literal">true</span>);
      });
      avlt.search(<span class="hljs-number">10</span>).length.should.equal(<span class="hljs-number">0</span>);
    });

    it(<span class="hljs-string">'Can delete a non-root node that has two children'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>On the left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt = <span class="hljs-keyword">new</span> AVLTree();
      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">20</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>, <span class="hljs-number">19</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3.5</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">16</span>);
      avlt.delete(<span class="hljs-number">5</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">15</span>);
      [<span class="hljs-number">10</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>, <span class="hljs-number">20</span>, <span class="hljs-number">19</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3.5</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        _.isEqual(avlt.search(k), [<span class="hljs-string">'some '</span> + k]).should.equal(<span class="hljs-literal">true</span>);
      });
      avlt.search(<span class="hljs-number">5</span>).length.should.equal(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>On the right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt = <span class="hljs-keyword">new</span> AVLTree();
      [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">20</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>, <span class="hljs-number">19</span>, <span class="hljs-number">42</span>, <span class="hljs-number">12.5</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        avlt.insert(k, <span class="hljs-string">'some '</span> + k);
      });
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">16</span>);
      avlt.delete(<span class="hljs-number">15</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">15</span>);
      [<span class="hljs-number">10</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">5</span>, <span class="hljs-number">12</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>, <span class="hljs-number">20</span>, <span class="hljs-number">19</span>, <span class="hljs-number">42</span>, <span class="hljs-number">12.5</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(k)</span> </span>{
        _.isEqual(avlt.search(k), [<span class="hljs-string">'some '</span> + k]).should.equal(<span class="hljs-literal">true</span>);
      });
      avlt.search(<span class="hljs-number">15</span>).length.should.equal(<span class="hljs-number">0</span>);
    });

    it(<span class="hljs-string">'If no value is provided, it will delete the entire node even if there are multiple pieces of data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'world'</span>);
      avlt.insert(<span class="hljs-number">8</span>, <span class="hljs-string">'yes'</span>);

      assert.deepEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);

      avlt.delete(<span class="hljs-number">5</span>);
      avlt.checkIsAVLT();
      avlt.search(<span class="hljs-number">5</span>).length.should.equal(<span class="hljs-number">0</span>);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
    });

    it(<span class="hljs-string">'Can remove only one value from an array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'world'</span>);
      avlt.insert(<span class="hljs-number">8</span>, <span class="hljs-string">'yes'</span>);

      assert.deepEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);

      avlt.delete(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>);
      avlt.checkIsAVLT();
      assert.deepEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'world'</span>]);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);
    });

    it(<span class="hljs-string">'Removes nothing if value doesnt match'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'world'</span>);
      avlt.insert(<span class="hljs-number">8</span>, <span class="hljs-string">'yes'</span>);

      assert.deepEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);

      avlt.delete(<span class="hljs-number">5</span>, <span class="hljs-string">'nope'</span>);
      avlt.checkIsAVLT();
      assert.deepEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);
    });

    it(<span class="hljs-string">'If value provided but node contains only one value, remove entire node'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'yes2'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'world'</span>);
      avlt.insert(<span class="hljs-number">8</span>, <span class="hljs-string">'yes3'</span>);

      assert.deepEqual(avlt.search(<span class="hljs-number">3</span>), [<span class="hljs-string">'yes2'</span>]);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);

      avlt.delete(<span class="hljs-number">3</span>, <span class="hljs-string">'yes2'</span>);
      avlt.checkIsAVLT();
      avlt.search(<span class="hljs-number">3</span>).length.should.equal(<span class="hljs-number">0</span>);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
    });

    it(<span class="hljs-string">'Can remove the root from a tree with height 2 when the root has two children (special case)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'maybe'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'no'</span>);
      avlt.insert(<span class="hljs-number">15</span>, <span class="hljs-string">'yes'</span>);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);

      avlt.delete(<span class="hljs-number">10</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
      assert.deepEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'no'</span>]);
      assert.deepEqual(avlt.search(<span class="hljs-number">15</span>), [<span class="hljs-string">'yes'</span>]);
    });

    it(<span class="hljs-string">'Can remove the root from a tree with height 3 when the root has two children (special case where the two children themselves have children)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree();

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'maybe'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'no'</span>);
      avlt.insert(<span class="hljs-number">15</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">2</span>, <span class="hljs-string">'no'</span>);
      avlt.insert(<span class="hljs-number">35</span>, <span class="hljs-string">'yes'</span>);
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">5</span>);

      avlt.delete(<span class="hljs-number">10</span>);
      avlt.checkIsAVLT();
      avlt.getNumberOfKeys().should.equal(<span class="hljs-number">4</span>);
      assert.deepEqual(avlt.search(<span class="hljs-number">5</span>), [<span class="hljs-string">'no'</span>]);
      assert.deepEqual(avlt.search(<span class="hljs-number">15</span>), [<span class="hljs-string">'yes'</span>]);
    });

  });   <span class="hljs-comment">// ==== End of 'Deletion' ==== //</span>


  it(<span class="hljs-string">'Can use undefined as key and value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compareKeys</span> <span class="hljs-params">(a, b)</span> </span>{
      <span class="hljs-keyword">if</span> (a === <span class="hljs-literal">undefined</span> &amp;&amp; b === <span class="hljs-literal">undefined</span>) { <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }
      <span class="hljs-keyword">if</span> (a === <span class="hljs-literal">undefined</span>) { <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; }
      <span class="hljs-keyword">if</span> (b === <span class="hljs-literal">undefined</span>) { <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; }

      <span class="hljs-keyword">if</span> (a &lt; b) { <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; }
      <span class="hljs-keyword">if</span> (a &gt; b) { <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; }
      <span class="hljs-keyword">if</span> (a === b) { <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }
    }

    <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree({ compareKeys: compareKeys });

    avlt.insert(<span class="hljs-number">2</span>, <span class="hljs-literal">undefined</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), []);

    avlt.insert(<span class="hljs-literal">undefined</span>, <span class="hljs-string">'hello'</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), [<span class="hljs-string">'hello'</span>]);

    avlt.insert(<span class="hljs-literal">undefined</span>, <span class="hljs-string">'world'</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);

    avlt.insert(<span class="hljs-number">4</span>, <span class="hljs-literal">undefined</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);

    avlt.delete(<span class="hljs-literal">undefined</span>, <span class="hljs-string">'hello'</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), [<span class="hljs-string">'world'</span>]);

    avlt.delete(<span class="hljs-literal">undefined</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), []);

    avlt.delete(<span class="hljs-number">2</span>, <span class="hljs-literal">undefined</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), []);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">undefined</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), []);

    avlt.delete(<span class="hljs-number">4</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), []);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), []);
    assert.deepEqual(avlt.search(<span class="hljs-literal">undefined</span>), []);
  });


  it(<span class="hljs-string">'Can use null as key and value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compareKeys</span> <span class="hljs-params">(a, b)</span> </span>{
      <span class="hljs-keyword">if</span> (a === <span class="hljs-literal">null</span> &amp;&amp; b === <span class="hljs-literal">null</span>) { <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }
      <span class="hljs-keyword">if</span> (a === <span class="hljs-literal">null</span>) { <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; }
      <span class="hljs-keyword">if</span> (b === <span class="hljs-literal">null</span>) { <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; }

      <span class="hljs-keyword">if</span> (a &lt; b) { <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; }
      <span class="hljs-keyword">if</span> (a &gt; b) { <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; }
      <span class="hljs-keyword">if</span> (a === b) { <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }
    }

    <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree({ compareKeys: compareKeys });

    avlt.insert(<span class="hljs-number">2</span>, <span class="hljs-literal">null</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), []);

    avlt.insert(<span class="hljs-literal">null</span>, <span class="hljs-string">'hello'</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), [<span class="hljs-string">'hello'</span>]);

    avlt.insert(<span class="hljs-literal">null</span>, <span class="hljs-string">'world'</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);

    avlt.insert(<span class="hljs-number">4</span>, <span class="hljs-literal">null</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]);

    avlt.delete(<span class="hljs-literal">null</span>, <span class="hljs-string">'hello'</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">3</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), [<span class="hljs-string">'world'</span>]);

    avlt.delete(<span class="hljs-literal">null</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">2</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), []);

    avlt.delete(<span class="hljs-number">2</span>, <span class="hljs-literal">null</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">1</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), []);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), [<span class="hljs-literal">null</span>]);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), []);

    avlt.delete(<span class="hljs-number">4</span>);
    avlt.checkIsAVLT();
    avlt.getNumberOfKeys().should.equal(<span class="hljs-number">0</span>);
    assert.deepEqual(avlt.search(<span class="hljs-number">2</span>), []);
    assert.deepEqual(avlt.search(<span class="hljs-number">4</span>), []);
    assert.deepEqual(avlt.search(<span class="hljs-literal">null</span>), []);
  });


  describe(<span class="hljs-string">'Execute on every node (=tree traversal)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Can execute a function on every node'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree()
        , keys = []
        , executed = <span class="hljs-number">0</span>
        ;

      avlt.insert(<span class="hljs-number">10</span>, <span class="hljs-string">'yes'</span>);
      avlt.insert(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>);
      avlt.insert(<span class="hljs-number">3</span>, <span class="hljs-string">'yes2'</span>);
      avlt.insert(<span class="hljs-number">8</span>, <span class="hljs-string">'yes3'</span>);
      avlt.insert(<span class="hljs-number">15</span>, <span class="hljs-string">'yes3'</span>);
      avlt.insert(<span class="hljs-number">159</span>, <span class="hljs-string">'yes3'</span>);
      avlt.insert(<span class="hljs-number">11</span>, <span class="hljs-string">'yes3'</span>);

      avlt.executeOnEveryNode(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node)</span> </span>{
        keys.push(node.key);
        executed += <span class="hljs-number">1</span>;
      });

      assert.deepEqual(keys, [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>, <span class="hljs-number">159</span>]);
      executed.should.equal(<span class="hljs-number">7</span>);
    });

  });   <span class="hljs-comment">// ==== End of 'Execute on every node' ==== //</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>This test performs several inserts and deletes at random, always checking the content
of the tree are as expected and the binary search tree constraint is respected
This test is important because it can catch bugs other tests cant
By their nature, BSTs can be hard to test (many possible cases, bug at one operation whose
effect begins to be felt only after several operations etc.)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'Randomized test (takes much longer than the rest of the test suite)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> avlt = <span class="hljs-keyword">new</span> AVLTree()
      , data = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Check a avlt against a simple key =&gt; [data] object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkDataIsTheSame</span> <span class="hljs-params">(avlt, data)</span> </span>{
      <span class="hljs-keyword">var</span> avltDataElems = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>avltDataElems is a simple array containing every piece of data in the tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt.executeOnEveryNode(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node)</span> </span>{
        <span class="hljs-keyword">var</span> i;
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; node.data.length; i += <span class="hljs-number">1</span>) {
          avltDataElems.push(node.data[i]);
        }
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Number of key and number of pieces of data match</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      avlt.getNumberOfKeys().should.equal(<span class="hljs-built_in">Object</span>.keys(data).length);
      _.reduce(_.map(data, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.length; }), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(memo, n)</span> </span>{ <span class="hljs-keyword">return</span> memo + n; }, <span class="hljs-number">0</span>).should.equal(avltDataElems.length);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Compare data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-built_in">Object</span>.keys(data).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> </span>{
        checkDataEquality(avlt.search(key), data[key]);
      });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Check two pieces of data coming from the avlt and data are the same</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkDataEquality</span> <span class="hljs-params">(fromavlt, fromData)</span> </span>{
      <span class="hljs-keyword">if</span> (fromavlt.length === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (fromData) { fromData.length.should.equal(<span class="hljs-number">0</span>); }
      }

      assert.deepEqual(fromavlt, fromData);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Tests the tree structure (deletions concern the whole tree, deletion of some data in a node is well tested above)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'Inserting and deleting entire nodes'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>You can skew to be more insertive or deletive, to test all cases</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">launchRandomTest</span> <span class="hljs-params">(nTests, proba)</span> </span>{
        <span class="hljs-keyword">var</span> i, key, dataPiece, possibleKeys;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; nTests; i += <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.random() &gt; proba) {   <span class="hljs-comment">// Deletion</span>
            possibleKeys = <span class="hljs-built_in">Object</span>.keys(data);

            <span class="hljs-keyword">if</span> (possibleKeys.length &gt; <span class="hljs-number">0</span>) {
              key = possibleKeys[<span class="hljs-built_in">Math</span>.floor(possibleKeys.length * <span class="hljs-built_in">Math</span>.random()).toString()];
            } <span class="hljs-keyword">else</span> {
              key = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">70</span> * <span class="hljs-built_in">Math</span>.random()).toString();
            }

            <span class="hljs-keyword">delete</span> data[key];
            avlt.delete(key);
          } <span class="hljs-keyword">else</span> {   <span class="hljs-comment">// Insertion</span>
            key = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">70</span> * <span class="hljs-built_in">Math</span>.random()).toString();
            dataPiece = <span class="hljs-built_in">Math</span>.random().toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>);

            avlt.insert(key, dataPiece);
            <span class="hljs-keyword">if</span> (data[key]) {
              data[key].push(dataPiece);
            } <span class="hljs-keyword">else</span> {
              data[key] = [dataPiece];
            }
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Check the avlt constraint are still met and the data is correct</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          avlt.checkIsAVLT();
          checkDataIsTheSame(avlt, data);
        }
      }

      launchRandomTest(<span class="hljs-number">1000</span>, <span class="hljs-number">0.65</span>);
      launchRandomTest(<span class="hljs-number">2000</span>, <span class="hljs-number">0.35</span>);
    });

  });   <span class="hljs-comment">// ==== End of 'Randomized test' ==== //</span>

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
