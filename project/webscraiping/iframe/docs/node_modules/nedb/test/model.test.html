<!DOCTYPE html>

<html>
<head>
  <title>model.test.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>model.test.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> model = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/model'</span>)
  , should = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).should()
  , assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).assert
  , _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>)
  , async = <span class="hljs-built_in">require</span>(<span class="hljs-string">'async'</span>)
  , util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>)
  , Datastore = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/datastore'</span>)
  , fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
  ;


describe(<span class="hljs-string">'Model'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

  describe(<span class="hljs-string">'Serialization, deserialization'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Can serialize and deserialize strings'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a, b, c;

      a = { test: <span class="hljs-string">"Some string"</span> };
      b = model.serialize(a);
      c = model.deserialize(b);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      c.test.should.equal(<span class="hljs-string">"Some string"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Even if a property is a string containing a new line, the serialized
version doesn’t. The new line must still be there upon deserialization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      a = { test: <span class="hljs-string">"With a new\nline"</span> };
      b = model.serialize(a);
      c = model.deserialize(b);
      c.test.should.equal(<span class="hljs-string">"With a new\nline"</span>);
      a.test.indexOf(<span class="hljs-string">'\n'</span>).should.not.equal(-<span class="hljs-number">1</span>);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      c.test.indexOf(<span class="hljs-string">'\n'</span>).should.not.equal(-<span class="hljs-number">1</span>);
    });

    it(<span class="hljs-string">'Can serialize and deserialize booleans'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a, b, c;

      a = { test: <span class="hljs-literal">true</span> };
      b = model.serialize(a);
      c = model.deserialize(b);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      c.test.should.equal(<span class="hljs-literal">true</span>);
    });

    it(<span class="hljs-string">'Can serialize and deserialize numbers'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a, b, c;

      a = { test: <span class="hljs-number">5</span> };
      b = model.serialize(a);
      c = model.deserialize(b);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      c.test.should.equal(<span class="hljs-number">5</span>);
    });

    it(<span class="hljs-string">'Can serialize and deserialize null'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a, b, c;

      a = { test: <span class="hljs-literal">null</span> };
      b = model.serialize(a);
      c = model.deserialize(b);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      assert.isNull(a.test);
    });

    it(<span class="hljs-string">'undefined fields are removed when serialized'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a = { bloup: <span class="hljs-literal">undefined</span>, hello: <span class="hljs-string">'world'</span> }
        , b = model.serialize(a)
        , c = model.deserialize(b)
        ;

      <span class="hljs-built_in">Object</span>.keys(c).length.should.equal(<span class="hljs-number">1</span>);
      c.hello.should.equal(<span class="hljs-string">'world'</span>);
      assert.isUndefined(c.bloup);
    });

    it(<span class="hljs-string">'Can serialize and deserialize a date'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a, b, c
        , d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();

      a = { test: d };
      b = model.serialize(a);
      c = model.deserialize(b);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      util.isDate(c.test).should.equal(<span class="hljs-literal">true</span>);
      c.test.getTime().should.equal(d.getTime());
    });

    it(<span class="hljs-string">'Can serialize and deserialize sub objects'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a, b, c
        , d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();

      a = { test: { something: <span class="hljs-number">39</span>, also: d, yes: { again: <span class="hljs-string">'yes'</span> } } };
      b = model.serialize(a);
      c = model.deserialize(b);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      c.test.something.should.equal(<span class="hljs-number">39</span>);
      c.test.also.getTime().should.equal(d.getTime());
      c.test.yes.again.should.equal(<span class="hljs-string">'yes'</span>);
    });

    it(<span class="hljs-string">'Can serialize and deserialize sub arrays'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a, b, c
        , d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();

      a = { test: [ <span class="hljs-number">39</span>, d, { again: <span class="hljs-string">'yes'</span> } ] };
      b = model.serialize(a);
      c = model.deserialize(b);
      b.indexOf(<span class="hljs-string">'\n'</span>).should.equal(-<span class="hljs-number">1</span>);
      c.test[<span class="hljs-number">0</span>].should.equal(<span class="hljs-number">39</span>);
      c.test[<span class="hljs-number">1</span>].getTime().should.equal(d.getTime());
      c.test[<span class="hljs-number">2</span>].again.should.equal(<span class="hljs-string">'yes'</span>);
    });

    it(<span class="hljs-string">'Reject field names beginning with a $ sign or containing a dot, except the four edge cases'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> a1 = { $something: <span class="hljs-string">'totest'</span> }
        , a2 = { <span class="hljs-string">"with.dot"</span>: <span class="hljs-string">'totest'</span> }
        , e1 = { $$date: <span class="hljs-number">4321</span> }
        , e2 = { $$deleted: <span class="hljs-literal">true</span> }
        , e3 = { $$indexCreated: <span class="hljs-string">"indexName"</span> }
        , e4 = { $$indexRemoved: <span class="hljs-string">"indexName"</span> }
        , b;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Normal cases</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ b = model.serialize(a1); }).should.throw();
      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ b = model.serialize(a2); }).should.throw();</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Edge cases</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      b = model.serialize(e1);
      b = model.serialize(e2);
      b = model.serialize(e3);
      b = model.serialize(e4);
    });
    
    it(<span class="hljs-string">'Can serialize string fields with a new line without breaking the DB'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(done)</span> </span>{
      <span class="hljs-keyword">var</span> db1, db2
        , badString = <span class="hljs-string">"world\r\nearth\nother\rline"</span>
        ;
      
      <span class="hljs-keyword">if</span> (fs.existsSync(<span class="hljs-string">'workspace/test1.db'</span>)) { fs.unlinkSync(<span class="hljs-string">'workspace/test1.db'</span>); }
      fs.existsSync(<span class="hljs-string">'workspace/test1.db'</span>).should.equal(<span class="hljs-literal">false</span>);
      db1 = <span class="hljs-keyword">new</span> Datastore({ filename: <span class="hljs-string">'workspace/test1.db'</span> });
      
      db1.loadDatabase(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err)</span> </span>{
        assert.isNull(err);
        db1.insert({ hello: badString }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err)</span> </span>{
          assert.isNull(err);
        
          db2 = <span class="hljs-keyword">new</span> Datastore({ filename: <span class="hljs-string">'workspace/test1.db'</span> });
          db2.loadDatabase(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err)</span> </span>{
            assert.isNull(err);
            db2.find({}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err, docs)</span> </span>{
              assert.isNull(err);
              docs.length.should.equal(<span class="hljs-number">1</span>);
              docs[<span class="hljs-number">0</span>].hello.should.equal(badString);

              done();
            });
          });
        });
      });
    });

  });   <span class="hljs-comment">// ==== End of 'Serialization, deserialization' ==== //</span>


  describe(<span class="hljs-string">'Object checking'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Field names beginning with a $ sign are forbidden'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      assert.isDefined(model.checkObject);

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.checkObject({ $bad: <span class="hljs-literal">true</span> });
      }).should.throw();

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.checkObject({ some: <span class="hljs-number">42</span>, nested: { again: <span class="hljs-string">"no"</span>, $worse: <span class="hljs-literal">true</span> } });
      }).should.throw();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>This shouldn’t throw since “$actuallyok” is not a field name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      model.checkObject({ some: <span class="hljs-number">42</span>, nested: [ <span class="hljs-number">5</span>, <span class="hljs-string">"no"</span>, <span class="hljs-string">"$actuallyok"</span>, <span class="hljs-literal">true</span> ] });

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.checkObject({ some: <span class="hljs-number">42</span>, nested: [ <span class="hljs-number">5</span>, <span class="hljs-string">"no"</span>, <span class="hljs-string">"$actuallyok"</span>, <span class="hljs-literal">true</span>, { $hidden: <span class="hljs-string">"useless"</span> } ] });
      }).should.throw();
    });

    it(<span class="hljs-string">'Field names cannot contain a .'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      assert.isDefined(model.checkObject);

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.checkObject({ <span class="hljs-string">"so.bad"</span>: <span class="hljs-literal">true</span> });
      }).should.throw();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Recursive behaviour testing done in the above test on $ signs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    });

    it(<span class="hljs-string">'Properties with a null value dont trigger an error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> obj = { prop: <span class="hljs-literal">null</span> };

      model.checkObject(obj);
    });
    
    it(<span class="hljs-string">'Can check if an object is a primitive or not'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      model.isPrimitiveType(<span class="hljs-number">5</span>).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType(<span class="hljs-string">'sdsfdfs'</span>).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType(<span class="hljs-number">0</span>).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType(<span class="hljs-literal">true</span>).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType(<span class="hljs-literal">false</span>).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType([]).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType([<span class="hljs-number">3</span>, <span class="hljs-string">'try'</span>]).should.equal(<span class="hljs-literal">true</span>);
      model.isPrimitiveType(<span class="hljs-literal">null</span>).should.equal(<span class="hljs-literal">true</span>);

      model.isPrimitiveType({}).should.equal(<span class="hljs-literal">false</span>);
      model.isPrimitiveType({ a: <span class="hljs-number">42</span> }).should.equal(<span class="hljs-literal">false</span>);
    });

  });   <span class="hljs-comment">// ==== End of 'Object checking' ==== //</span>


  describe(<span class="hljs-string">'Deep copying'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Should be able to deep copy any serializable model'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
        , obj = { a: [<span class="hljs-string">'ee'</span>, <span class="hljs-string">'ff'</span>, <span class="hljs-number">42</span>], date: d, subobj: { a: <span class="hljs-string">'b'</span>, b: <span class="hljs-string">'c'</span> } }
        , res = model.deepCopy(obj);
        ;

      res.a.length.should.equal(<span class="hljs-number">3</span>);
      res.a[<span class="hljs-number">0</span>].should.equal(<span class="hljs-string">'ee'</span>);
      res.a[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">'ff'</span>);
      res.a[<span class="hljs-number">2</span>].should.equal(<span class="hljs-number">42</span>);
      res.date.getTime().should.equal(d.getTime());
      res.subobj.a.should.equal(<span class="hljs-string">'b'</span>);
      res.subobj.b.should.equal(<span class="hljs-string">'c'</span>);

      obj.a.push(<span class="hljs-string">'ggg'</span>);
      obj.date = <span class="hljs-string">'notadate'</span>;
      obj.subobj = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Even if the original object is modified, the copied one isn’t</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.a.length.should.equal(<span class="hljs-number">3</span>);
      res.a[<span class="hljs-number">0</span>].should.equal(<span class="hljs-string">'ee'</span>);
      res.a[<span class="hljs-number">1</span>].should.equal(<span class="hljs-string">'ff'</span>);
      res.a[<span class="hljs-number">2</span>].should.equal(<span class="hljs-number">42</span>);
      res.date.getTime().should.equal(d.getTime());
      res.subobj.a.should.equal(<span class="hljs-string">'b'</span>);
      res.subobj.b.should.equal(<span class="hljs-string">'c'</span>);
    });

  });   <span class="hljs-comment">// ==== End of 'Deep copying' ==== //</span>
  

  describe(<span class="hljs-string">'Modifying documents'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'Queries not containing any modifier just replace the document by the contents of the query but keep its _id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span>, _id: <span class="hljs-string">'keepit'</span> }
        , updateQuery = { replace: <span class="hljs-string">'done'</span>, bloup: [ <span class="hljs-number">1</span>, <span class="hljs-number">8</span>] }
        , t
        ;

      t = model.modify(obj, updateQuery);
      t.replace.should.equal(<span class="hljs-string">'done'</span>);
      t.bloup.length.should.equal(<span class="hljs-number">2</span>);
      t.bloup[<span class="hljs-number">0</span>].should.equal(<span class="hljs-number">1</span>);
      t.bloup[<span class="hljs-number">1</span>].should.equal(<span class="hljs-number">8</span>);

      assert.isUndefined(t.some);
      t._id.should.equal(<span class="hljs-string">'keepit'</span>);
    });

    it(<span class="hljs-string">'Throw an error if trying to change the _id field in a copy-type modification'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span>, _id: <span class="hljs-string">'keepit'</span> }
        , updateQuery = { replace: <span class="hljs-string">'done'</span>, bloup: [ <span class="hljs-number">1</span>, <span class="hljs-number">8</span>], _id: <span class="hljs-string">'donttryit'</span> }
        ;

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.modify(obj, updateQuery);
      }).should.throw();

      updateQuery._id = <span class="hljs-string">'keepit'</span>;
      model.modify(obj, updateQuery);   <span class="hljs-comment">// No error thrown</span>
    });

    it(<span class="hljs-string">'Throw an error if trying to use modify in a mixed copy+modify way'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span> }
        , updateQuery = { replace: <span class="hljs-string">'me'</span>, $modify: <span class="hljs-string">'metoo'</span> };

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.modify(obj, updateQuery);
      }).should.throw();
    });

    it(<span class="hljs-string">'Throw an error if trying to use an inexistent modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span> }
        , updateQuery = { $set: <span class="hljs-string">'this exists'</span>, $modify: <span class="hljs-string">'not this one'</span> };

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.modify(obj, updateQuery);
      }).should.throw();
    });

    it(<span class="hljs-string">'Throw an error if a modifier is used with a non-object argument'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span> }
        , updateQuery = { $set: <span class="hljs-string">'this exists'</span> };

      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.modify(obj, updateQuery);
      }).should.throw();
    });

    describe(<span class="hljs-string">'$set modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      it(<span class="hljs-string">'Can change already set fields without modfifying the underlying object'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span>, yup: <span class="hljs-string">'yes'</span>, nay: <span class="hljs-string">'noes'</span> }
          , updateQuery = { $set: { some: <span class="hljs-string">'changed'</span>, nay: <span class="hljs-string">'yes indeed'</span> } }
          , modified = model.modify(obj, updateQuery);

        <span class="hljs-built_in">Object</span>.keys(modified).length.should.equal(<span class="hljs-number">3</span>);
        modified.some.should.equal(<span class="hljs-string">'changed'</span>);
        modified.yup.should.equal(<span class="hljs-string">'yes'</span>);
        modified.nay.should.equal(<span class="hljs-string">'yes indeed'</span>);

        <span class="hljs-built_in">Object</span>.keys(obj).length.should.equal(<span class="hljs-number">3</span>);
        obj.some.should.equal(<span class="hljs-string">'thing'</span>);
        obj.yup.should.equal(<span class="hljs-string">'yes'</span>);
        obj.nay.should.equal(<span class="hljs-string">'noes'</span>);
      });

      it(<span class="hljs-string">'Creates fields to set if they dont exist yet'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { yup: <span class="hljs-string">'yes'</span> }
          , updateQuery = { $set: { some: <span class="hljs-string">'changed'</span>, nay: <span class="hljs-string">'yes indeed'</span> } }
          , modified = model.modify(obj, updateQuery);

        <span class="hljs-built_in">Object</span>.keys(modified).length.should.equal(<span class="hljs-number">3</span>);
        modified.some.should.equal(<span class="hljs-string">'changed'</span>);
        modified.yup.should.equal(<span class="hljs-string">'yes'</span>);
        modified.nay.should.equal(<span class="hljs-string">'yes indeed'</span>);
      });

      it(<span class="hljs-string">'Can set sub-fields and create them if necessary'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { yup: { subfield: <span class="hljs-string">'bloup'</span> } }
          , updateQuery = { $set: { <span class="hljs-string">"yup.subfield"</span>: <span class="hljs-string">'changed'</span>, <span class="hljs-string">"yup.yop"</span>: <span class="hljs-string">'yes indeed'</span>, <span class="hljs-string">"totally.doesnt.exist"</span>: <span class="hljs-string">'now it does'</span> } }
          , modified = model.modify(obj, updateQuery);

        _.isEqual(modified, { yup: { subfield: <span class="hljs-string">'changed'</span>, yop: <span class="hljs-string">'yes indeed'</span> }, totally: { doesnt: { exist: <span class="hljs-string">'now it does'</span> } } }).should.equal(<span class="hljs-literal">true</span>);
      });
    });   <span class="hljs-comment">// End of '$set modifier'</span>
    
    describe(<span class="hljs-string">'$unset modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    
      it(<span class="hljs-string">'Can delete a field, not throwing an error if the field doesnt exist'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj, updateQuery, modified;
      
        obj = { yup: <span class="hljs-string">'yes'</span>, other: <span class="hljs-string">'also'</span> }
        updateQuery = { $unset: { yup: <span class="hljs-literal">true</span> } }
        modified = model.modify(obj, updateQuery);
        assert.deepEqual(modified, { other: <span class="hljs-string">'also'</span> });

        obj = { yup: <span class="hljs-string">'yes'</span>, other: <span class="hljs-string">'also'</span> }
        updateQuery = { $unset: { nope: <span class="hljs-literal">true</span> } }
        modified = model.modify(obj, updateQuery);
        assert.deepEqual(modified, obj);
        
        obj = { yup: <span class="hljs-string">'yes'</span>, other: <span class="hljs-string">'also'</span> }
        updateQuery = { $unset: { nope: <span class="hljs-literal">true</span>, other: <span class="hljs-literal">true</span> } }
        modified = model.modify(obj, updateQuery);
        assert.deepEqual(modified, { yup: <span class="hljs-string">'yes'</span> });
      });
      
      it(<span class="hljs-string">'Can unset sub-fields and entire nested documents'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj, updateQuery, modified;
      
        obj = { yup: <span class="hljs-string">'yes'</span>, nested: { a: <span class="hljs-string">'also'</span>, b: <span class="hljs-string">'yeah'</span> } }
        updateQuery = { $unset: { nested: <span class="hljs-literal">true</span> } }
        modified = model.modify(obj, updateQuery);
        assert.deepEqual(modified, { yup: <span class="hljs-string">'yes'</span> });
      
        obj = { yup: <span class="hljs-string">'yes'</span>, nested: { a: <span class="hljs-string">'also'</span>, b: <span class="hljs-string">'yeah'</span> } }
        updateQuery = { $unset: { <span class="hljs-string">'nested.a'</span>: <span class="hljs-literal">true</span> } }
        modified = model.modify(obj, updateQuery);
        assert.deepEqual(modified, { yup: <span class="hljs-string">'yes'</span>, nested: { b: <span class="hljs-string">'yeah'</span> } });
      
        obj = { yup: <span class="hljs-string">'yes'</span>, nested: { a: <span class="hljs-string">'also'</span>, b: <span class="hljs-string">'yeah'</span> } }
        updateQuery = { $unset: { <span class="hljs-string">'nested.a'</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">'nested.b'</span>: <span class="hljs-literal">true</span> } }
        modified = model.modify(obj, updateQuery);
        assert.deepEqual(modified, { yup: <span class="hljs-string">'yes'</span>, nested: {} });
      });
      
    });   <span class="hljs-comment">// End of '$unset modifier'</span>

    describe(<span class="hljs-string">'$inc modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      it(<span class="hljs-string">'Throw an error if you try to use it with a non-number or on a non number field'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span>, yup: <span class="hljs-string">'yes'</span>, nay: <span class="hljs-number">2</span> }
          , updateQuery = { $inc: { nay: <span class="hljs-string">'notanumber'</span> } }
          , modified = model.modify(obj, updateQuery);
        }).should.throw();

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span>, yup: <span class="hljs-string">'yes'</span>, nay: <span class="hljs-string">'nope'</span> }
          , updateQuery = { $inc: { nay: <span class="hljs-number">1</span> } }
          , modified = model.modify(obj, updateQuery);
        }).should.throw();
      });

      it(<span class="hljs-string">'Can increment number fields or create and initialize them if needed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span>, nay: <span class="hljs-number">40</span> }
          , modified;

        modified = model.modify(obj, { $inc: { nay: <span class="hljs-number">2</span> } });
        _.isEqual(modified, { some: <span class="hljs-string">'thing'</span>, nay: <span class="hljs-number">42</span> }).should.equal(<span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Incidentally, this tests that obj was not modified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        modified = model.modify(obj, { $inc: { inexistent: -<span class="hljs-number">6</span> } });
        _.isEqual(modified, { some: <span class="hljs-string">'thing'</span>, nay: <span class="hljs-number">40</span>, inexistent: -<span class="hljs-number">6</span> }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Works recursively'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { some: <span class="hljs-string">'thing'</span>, nay: { nope: <span class="hljs-number">40</span> } }
          , modified;

        modified = model.modify(obj, { $inc: { <span class="hljs-string">"nay.nope"</span>: -<span class="hljs-number">2</span>, <span class="hljs-string">"blip.blop"</span>: <span class="hljs-number">123</span> } });
        _.isEqual(modified, { some: <span class="hljs-string">'thing'</span>, nay: { nope: <span class="hljs-number">38</span> }, blip: { blop: <span class="hljs-number">123</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });
    });   <span class="hljs-comment">// End of '$inc modifier'</span>

    describe(<span class="hljs-string">'$push modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Can push an element to the end of an array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [<span class="hljs-string">'hello'</span>] }
          , modified;

        modified = model.modify(obj, { $push: { arr: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>] });
      });

      it(<span class="hljs-string">'Can push an element to a non-existent field and will create the array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = {}
          , modified;

        modified = model.modify(obj, { $push: { arr: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'world'</span>] });
      });

      it(<span class="hljs-string">'Can push on nested fields'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: { nested: [<span class="hljs-string">'hello'</span>] } }
          , modified;

        modified = model.modify(obj, { $push: { <span class="hljs-string">"arr.nested"</span>: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: { nested: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>] } });

        obj = { arr: { a: <span class="hljs-number">2</span> }};
        modified = model.modify(obj, { $push: { <span class="hljs-string">"arr.nested"</span>: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: { a: <span class="hljs-number">2</span>, nested: [<span class="hljs-string">'world'</span>] } });
      });

      it(<span class="hljs-string">'Throw if we try to push to a non-array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: <span class="hljs-string">'hello'</span> }
          , modified;

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $push: { arr: <span class="hljs-string">'world'</span> } });
        }).should.throw();

        obj = { arr: { nested: <span class="hljs-number">45</span> } };
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $push: { <span class="hljs-string">"arr.nested"</span>: <span class="hljs-string">'world'</span> } });
        }).should.throw();
      });

      it(<span class="hljs-string">'Can use the $each modifier to add multiple values to an array at once'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [<span class="hljs-string">'hello'</span>] }
          , modified;

        modified = model.modify(obj, { $push: { arr: { $each: [<span class="hljs-string">'world'</span>, <span class="hljs-string">'earth'</span>, <span class="hljs-string">'everything'</span>] } } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>, <span class="hljs-string">'earth'</span>, <span class="hljs-string">'everything'</span>] });

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $push: { arr: { $each: <span class="hljs-number">45</span> } } });
        }).should.throw();

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $push: { arr: { $each: [<span class="hljs-string">'world'</span>], unauthorized: <span class="hljs-literal">true</span> } } });
        }).should.throw();
      });

    });   <span class="hljs-comment">// End of '$push modifier'</span>

    describe(<span class="hljs-string">'$addToSet modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Can add an element to a set'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [<span class="hljs-string">'hello'</span>] }
          , modified;

        modified = model.modify(obj, { $addToSet: { arr: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>] });

        obj = { arr: [<span class="hljs-string">'hello'</span>] };
        modified = model.modify(obj, { $addToSet: { arr: <span class="hljs-string">'hello'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>] });
      });

      it(<span class="hljs-string">'Can add an element to a non-existent set and will create the array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [] }
          , modified;

        modified = model.modify(obj, { $addToSet: { arr: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'world'</span>] });
      });

      it(<span class="hljs-string">'Throw if we try to addToSet to a non-array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: <span class="hljs-string">'hello'</span> }
          , modified;

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $addToSet: { arr: <span class="hljs-string">'world'</span> } });
        }).should.throw();
      });

      it(<span class="hljs-string">'Use deep-equality to check whether we can add a value to a set'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [ { b: <span class="hljs-number">2</span> } ] }
          , modified;

        modified = model.modify(obj, { $addToSet: { arr: { b: <span class="hljs-number">3</span> } } });
        assert.deepEqual(modified, { arr: [{ b: <span class="hljs-number">2</span> }, { b: <span class="hljs-number">3</span> }] });

        obj = { arr: [ { b: <span class="hljs-number">2</span> } ] }
        modified = model.modify(obj, { $addToSet: { arr: { b: <span class="hljs-number">2</span> } } });
        assert.deepEqual(modified, { arr: [{ b: <span class="hljs-number">2</span> }] });
      });

      it(<span class="hljs-string">'Can use the $each modifier to add multiple values to a set at once'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [<span class="hljs-string">'hello'</span>] }
          , modified;

        modified = model.modify(obj, { $addToSet: { arr: { $each: [<span class="hljs-string">'world'</span>, <span class="hljs-string">'earth'</span>, <span class="hljs-string">'hello'</span>, <span class="hljs-string">'earth'</span>] } } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>, <span class="hljs-string">'earth'</span>] });

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $addToSet: { arr: { $each: <span class="hljs-number">45</span> } } });
        }).should.throw();

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $addToSet: { arr: { $each: [<span class="hljs-string">'world'</span>], unauthorized: <span class="hljs-literal">true</span> } } });
        }).should.throw();
      });

    });   <span class="hljs-comment">// End of '$addToSet modifier'</span>

    describe(<span class="hljs-string">'$pop modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Throw if called on a non array, a non defined field or a non integer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: <span class="hljs-string">'hello'</span> }
          , modified;

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $pop: { arr: <span class="hljs-number">1</span> } });
        }).should.throw();

        obj = { bloup: <span class="hljs-string">'nope'</span> };
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $pop: { arr: <span class="hljs-number">1</span> } });
        }).should.throw();

        obj = { arr: [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>] };
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $pop: { arr: <span class="hljs-literal">true</span> } });
        }).should.throw();
      });

      it(<span class="hljs-string">'Can remove the first and last element of an array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj
          , modified;

        obj = { arr: [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>] };
        modified = model.modify(obj, { $pop: { arr: <span class="hljs-number">1</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>] });

        obj = { arr: [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>] };
        modified = model.modify(obj, { $pop: { arr: -<span class="hljs-number">1</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-number">4</span>, <span class="hljs-number">8</span>] });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Empty arrays are not changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        obj = { arr: [] };
        modified = model.modify(obj, { $pop: { arr: <span class="hljs-number">1</span> } });
        assert.deepEqual(modified, { arr: [] });
        modified = model.modify(obj, { $pop: { arr: -<span class="hljs-number">1</span> } });
        assert.deepEqual(modified, { arr: [] });
      });

    });   <span class="hljs-comment">// End of '$pop modifier'</span>

    describe(<span class="hljs-string">'$pull modifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Can remove an element from a set'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>] }
          , modified;

        modified = model.modify(obj, { $pull: { arr: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>] });

        obj = { arr: [<span class="hljs-string">'hello'</span>] };
        modified = model.modify(obj, { $pull: { arr: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>] });
      });

      it(<span class="hljs-string">'Can remove multiple matching elements'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>, <span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>] }
          , modified;

        modified = model.modify(obj, { $pull: { arr: <span class="hljs-string">'world'</span> } });
        assert.deepEqual(modified, { arr: [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'hello'</span>] });
      });

      it(<span class="hljs-string">'Throw if we try to pull from a non-array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: <span class="hljs-string">'hello'</span> }
          , modified;

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          modified = model.modify(obj, { $pull: { arr: <span class="hljs-string">'world'</span> } });
        }).should.throw();
      });

      it(<span class="hljs-string">'Use deep-equality to check whether we can remove a value from a set'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [{ b: <span class="hljs-number">2</span> }, { b: <span class="hljs-number">3</span> }] }
          , modified;

        modified = model.modify(obj, { $pull: { arr: { b: <span class="hljs-number">3</span> } } });
        assert.deepEqual(modified, { arr: [ { b: <span class="hljs-number">2</span> } ] });

        obj = { arr: [ { b: <span class="hljs-number">2</span> } ] }
        modified = model.modify(obj, { $pull: { arr: { b: <span class="hljs-number">3</span> } } });
        assert.deepEqual(modified, { arr: [{ b: <span class="hljs-number">2</span> }] });
      });
      
      it(<span class="hljs-string">'Can use any kind of nedb query with $pull'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> obj = { arr: [<span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">2</span>], other: <span class="hljs-string">'yup'</span> }
          , modified
          ;
      
        modified = model.modify(obj, { $pull: { arr: { $gte: <span class="hljs-number">5</span> } } });
        assert.deepEqual(modified, { arr: [<span class="hljs-number">4</span>, <span class="hljs-number">2</span>], other: <span class="hljs-string">'yup'</span> });
        
        obj = { arr: [{ b: <span class="hljs-number">4</span> }, { b: <span class="hljs-number">7</span> }, { b: <span class="hljs-number">1</span> }], other: <span class="hljs-string">'yeah'</span> };
        modified = model.modify(obj, { $pull: { arr: { b: { $gte: <span class="hljs-number">5</span>} } } });
        assert.deepEqual(modified, { arr: [{ b: <span class="hljs-number">4</span> }, { b: <span class="hljs-number">1</span> }], other: <span class="hljs-string">'yeah'</span> });
      });

    });   <span class="hljs-comment">// End of '$pull modifier'</span>

  });   <span class="hljs-comment">// ==== End of 'Modifying documents' ==== //</span>


  describe(<span class="hljs-string">'Comparing things'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    it(<span class="hljs-string">'undefined is the smallest'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> otherStuff = [<span class="hljs-literal">null</span>, <span class="hljs-string">"string"</span>, <span class="hljs-string">""</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5.3</span>, <span class="hljs-number">12</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">12345</span>), {}, { hello: <span class="hljs-string">'world'</span> }, [], [<span class="hljs-string">'quite'</span>, <span class="hljs-number">5</span>]];

      model.compareThings(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>).should.equal(<span class="hljs-number">0</span>);

      otherStuff.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(stuff)</span> </span>{
        model.compareThings(<span class="hljs-literal">undefined</span>, stuff).should.equal(-<span class="hljs-number">1</span>);
        model.compareThings(stuff, <span class="hljs-literal">undefined</span>).should.equal(<span class="hljs-number">1</span>);
      });
    });

    it(<span class="hljs-string">'Then null'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> otherStuff = [<span class="hljs-string">"string"</span>, <span class="hljs-string">""</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5.3</span>, <span class="hljs-number">12</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">12345</span>), {}, { hello: <span class="hljs-string">'world'</span> }, [], [<span class="hljs-string">'quite'</span>, <span class="hljs-number">5</span>]];

      model.compareThings(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>).should.equal(<span class="hljs-number">0</span>);

      otherStuff.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(stuff)</span> </span>{
        model.compareThings(<span class="hljs-literal">null</span>, stuff).should.equal(-<span class="hljs-number">1</span>);
        model.compareThings(stuff, <span class="hljs-literal">null</span>).should.equal(<span class="hljs-number">1</span>);
      });
    });

    it(<span class="hljs-string">'Then numbers'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> otherStuff = [<span class="hljs-string">"string"</span>, <span class="hljs-string">""</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">4312</span>), {}, { hello: <span class="hljs-string">'world'</span> }, [], [<span class="hljs-string">'quite'</span>, <span class="hljs-number">5</span>]]
        , numbers = [-<span class="hljs-number">12</span>, <span class="hljs-number">0</span>, <span class="hljs-number">12</span>, <span class="hljs-number">5.7</span>];

      model.compareThings(-<span class="hljs-number">12</span>, <span class="hljs-number">0</span>).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-number">0</span>, -<span class="hljs-number">3</span>).should.equal(<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-number">5.7</span>, <span class="hljs-number">2</span>).should.equal(<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-number">5.7</span>, <span class="hljs-number">12.3</span>).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>).should.equal(<span class="hljs-number">0</span>);
      model.compareThings(-<span class="hljs-number">2.6</span>, -<span class="hljs-number">2.6</span>).should.equal(<span class="hljs-number">0</span>);
      model.compareThings(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>).should.equal(<span class="hljs-number">0</span>);

      otherStuff.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(stuff)</span> </span>{
        numbers.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(number)</span> </span>{
          model.compareThings(number, stuff).should.equal(-<span class="hljs-number">1</span>);
          model.compareThings(stuff, number).should.equal(<span class="hljs-number">1</span>);
        });
      });
    });

    it(<span class="hljs-string">'Then strings'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> otherStuff = [<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">4321</span>), {}, { hello: <span class="hljs-string">'world'</span> }, [], [<span class="hljs-string">'quite'</span>, <span class="hljs-number">5</span>]]
        , strings = [<span class="hljs-string">''</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'hello world'</span>];

      model.compareThings(<span class="hljs-string">''</span>, <span class="hljs-string">'hey'</span>).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-string">'hey'</span>, <span class="hljs-string">''</span>).should.equal(<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-string">'hey'</span>, <span class="hljs-string">'hew'</span>).should.equal(<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-string">'hey'</span>, <span class="hljs-string">'hey'</span>).should.equal(<span class="hljs-number">0</span>);

      otherStuff.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(stuff)</span> </span>{
        strings.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(string)</span> </span>{
          model.compareThings(string, stuff).should.equal(-<span class="hljs-number">1</span>);
          model.compareThings(stuff, string).should.equal(<span class="hljs-number">1</span>);
        });
      });
    });

    it(<span class="hljs-string">'Then booleans'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> otherStuff = [<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">4321</span>), {}, { hello: <span class="hljs-string">'world'</span> }, [], [<span class="hljs-string">'quite'</span>, <span class="hljs-number">5</span>]]
        , bools = [<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>];

      model.compareThings(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>).should.equal(<span class="hljs-number">0</span>);
      model.compareThings(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>).should.equal(<span class="hljs-number">0</span>);
      model.compareThings(<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>).should.equal(<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>).should.equal(-<span class="hljs-number">1</span>);

      otherStuff.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(stuff)</span> </span>{
        bools.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(bool)</span> </span>{
          model.compareThings(bool, stuff).should.equal(-<span class="hljs-number">1</span>);
          model.compareThings(stuff, bool).should.equal(<span class="hljs-number">1</span>);
        });
      });
    });

    it(<span class="hljs-string">'Then dates'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> otherStuff = [{}, { hello: <span class="hljs-string">'world'</span> }, [], [<span class="hljs-string">'quite'</span>, <span class="hljs-number">5</span>]]
        , dates = [<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(-<span class="hljs-number">123</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">5555</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>)]
        , now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();

      model.compareThings(now, now).should.equal(<span class="hljs-number">0</span>);
      model.compareThings(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">54341</span>), now).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings(now, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">54341</span>)).should.equal(<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(-<span class="hljs-number">54341</span>)).should.equal(<span class="hljs-number">1</span>);
      model.compareThings(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">123</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">4341</span>)).should.equal(-<span class="hljs-number">1</span>);

      otherStuff.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(stuff)</span> </span>{
        dates.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(date)</span> </span>{
          model.compareThings(date, stuff).should.equal(-<span class="hljs-number">1</span>);
          model.compareThings(stuff, date).should.equal(<span class="hljs-number">1</span>);
        });
      });
    });

    it(<span class="hljs-string">'Then arrays'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> otherStuff = [{}, { hello: <span class="hljs-string">'world'</span> }]
        , arrays = [[], [<span class="hljs-string">'yes'</span>], [<span class="hljs-string">'hello'</span>, <span class="hljs-number">5</span>]]
        ;

      model.compareThings([], []).should.equal(<span class="hljs-number">0</span>);
      model.compareThings([<span class="hljs-string">'hello'</span>], []).should.equal(<span class="hljs-number">1</span>);
      model.compareThings([], [<span class="hljs-string">'hello'</span>]).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings([<span class="hljs-string">'hello'</span>], [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings([<span class="hljs-string">'hello'</span>, <span class="hljs-string">'earth'</span>], [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings([<span class="hljs-string">'hello'</span>, <span class="hljs-string">'zzz'</span>], [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]).should.equal(<span class="hljs-number">1</span>);
      model.compareThings([<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>], [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>]).should.equal(<span class="hljs-number">0</span>);

      otherStuff.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(stuff)</span> </span>{
        arrays.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(array)</span> </span>{
          model.compareThings(array, stuff).should.equal(-<span class="hljs-number">1</span>);
          model.compareThings(stuff, array).should.equal(<span class="hljs-number">1</span>);
        });
      });
    });

    it(<span class="hljs-string">'And finally objects'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      model.compareThings({}, {}).should.equal(<span class="hljs-number">0</span>);
      model.compareThings({ a: <span class="hljs-number">42</span> }, { a: <span class="hljs-number">312</span>}).should.equal(-<span class="hljs-number">1</span>);
      model.compareThings({ a: <span class="hljs-string">'42'</span> }, { a: <span class="hljs-string">'312'</span>}).should.equal(<span class="hljs-number">1</span>);
      model.compareThings({ a: <span class="hljs-number">42</span>, b: <span class="hljs-number">312</span> }, { b: <span class="hljs-number">312</span>, a: <span class="hljs-number">42</span> }).should.equal(<span class="hljs-number">0</span>);
      model.compareThings({ a: <span class="hljs-number">42</span>, b: <span class="hljs-number">312</span>, c: <span class="hljs-number">54</span> }, { b: <span class="hljs-number">313</span>, a: <span class="hljs-number">42</span> }).should.equal(-<span class="hljs-number">1</span>);
    });

  });   <span class="hljs-comment">// ==== End of 'Comparing things' ==== //</span>


  describe(<span class="hljs-string">'Querying'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    describe(<span class="hljs-string">'Comparing things'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Two things of different types cannot be equal, two identical native things are equal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> toTest = [<span class="hljs-literal">null</span>, <span class="hljs-string">'somestring'</span>, <span class="hljs-number">42</span>, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">72998322</span>), { hello: <span class="hljs-string">'world'</span> }]
          , toTestAgainst = [<span class="hljs-literal">null</span>, <span class="hljs-string">'somestring'</span>, <span class="hljs-number">42</span>, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">72998322</span>), { hello: <span class="hljs-string">'world'</span> }]   <span class="hljs-comment">// Use another array so that we don't test pointer equality</span>
          , i, j
          ;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; toTest.length; i += <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; toTestAgainst.length; j += <span class="hljs-number">1</span>) {
            model.areThingsEqual(toTest[i], toTestAgainst[j]).should.equal(i === j);
          }
        }
      });

      it(<span class="hljs-string">'Can test native types null undefined string number boolean date equality'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> toTest = [<span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-string">'somestring'</span>, <span class="hljs-number">42</span>, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">72998322</span>), { hello: <span class="hljs-string">'world'</span> }]
          , toTestAgainst = [<span class="hljs-literal">undefined</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'someotherstring'</span>, <span class="hljs-number">5</span>, <span class="hljs-literal">false</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">111111</span>), { hello: <span class="hljs-string">'mars'</span> }]
          , i
          ;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; toTest.length; i += <span class="hljs-number">1</span>) {
          model.areThingsEqual(toTest[i], toTestAgainst[i]).should.equal(<span class="hljs-literal">false</span>);
        }
      });

      it(<span class="hljs-string">'If one side is an array or undefined, comparison fails'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> toTestAgainst = [<span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-string">'somestring'</span>, <span class="hljs-number">42</span>, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">72998322</span>), { hello: <span class="hljs-string">'world'</span> }]
          , i
          ;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; toTestAgainst.length; i += <span class="hljs-number">1</span>) {
          model.areThingsEqual([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], toTestAgainst[i]).should.equal(<span class="hljs-literal">false</span>);
          model.areThingsEqual(toTestAgainst[i], []).should.equal(<span class="hljs-literal">false</span>);

          model.areThingsEqual(<span class="hljs-literal">undefined</span>, toTestAgainst[i]).should.equal(<span class="hljs-literal">false</span>);
          model.areThingsEqual(toTestAgainst[i], <span class="hljs-literal">undefined</span>).should.equal(<span class="hljs-literal">false</span>);
        }
      });

      it(<span class="hljs-string">'Can test objects equality'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.areThingsEqual({ hello: <span class="hljs-string">'world'</span> }, {}).should.equal(<span class="hljs-literal">false</span>);
        model.areThingsEqual({ hello: <span class="hljs-string">'world'</span> }, { hello: <span class="hljs-string">'mars'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.areThingsEqual({ hello: <span class="hljs-string">'world'</span> }, { hello: <span class="hljs-string">'world'</span>, temperature: <span class="hljs-number">42</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.areThingsEqual({ hello: <span class="hljs-string">'world'</span>, other: { temperature: <span class="hljs-number">42</span> }}, { hello: <span class="hljs-string">'world'</span>, other: { temperature: <span class="hljs-number">42</span> }}).should.equal(<span class="hljs-literal">true</span>);
      });

    });


    describe(<span class="hljs-string">'Getting a fields value in dot notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Return first-level and nested values'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.getDotValue({ hello: <span class="hljs-string">'world'</span> }, <span class="hljs-string">'hello'</span>).should.equal(<span class="hljs-string">'world'</span>);
        model.getDotValue({ hello: <span class="hljs-string">'world'</span>, type: { planet: <span class="hljs-literal">true</span>, blue: <span class="hljs-literal">true</span> } }, <span class="hljs-string">'type.planet'</span>).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Return undefined if the field cannot be found in the object'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        assert.isUndefined(model.getDotValue({ hello: <span class="hljs-string">'world'</span> }, <span class="hljs-string">'helloo'</span>));
        assert.isUndefined(model.getDotValue({ hello: <span class="hljs-string">'world'</span>, type: { planet: <span class="hljs-literal">true</span> } }, <span class="hljs-string">'type.plane'</span>));
      });
      
      it(<span class="hljs-string">"Can navigate inside arrays with dot notation, and return the array of values in that case"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> dv;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Simple array of subdocuments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dv = model.getDotValue({ planets: [ { name: <span class="hljs-string">'Earth'</span>, number: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">'Mars'</span>, number: <span class="hljs-number">2</span> }, { name: <span class="hljs-string">'Pluton'</span>, number: <span class="hljs-number">9</span> } ] }, <span class="hljs-string">'planets.name'</span>);
        assert.deepEqual(dv, [<span class="hljs-string">'Earth'</span>, <span class="hljs-string">'Mars'</span>, <span class="hljs-string">'Pluton'</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Nested array of subdocuments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dv = model.getDotValue({ nedb: <span class="hljs-literal">true</span>, data: { planets: [ { name: <span class="hljs-string">'Earth'</span>, number: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">'Mars'</span>, number: <span class="hljs-number">2</span> }, { name: <span class="hljs-string">'Pluton'</span>, number: <span class="hljs-number">9</span> } ] } }, <span class="hljs-string">'data.planets.number'</span>);
        assert.deepEqual(dv, [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Nested array in a subdocument of an array (yay, inception!)
TODO: make sure MongoDB doesn’t flatten the array (it wouldn’t make sense)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dv = model.getDotValue({ nedb: <span class="hljs-literal">true</span>, data: { planets: [ { name: <span class="hljs-string">'Earth'</span>, numbers: [ <span class="hljs-number">1</span>, <span class="hljs-number">3</span> ] }, { name: <span class="hljs-string">'Mars'</span>, numbers: [ <span class="hljs-number">7</span> ] }, { name: <span class="hljs-string">'Pluton'</span>, numbers: [ <span class="hljs-number">9</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span> ] } ] } }, <span class="hljs-string">'data.planets.numbers'</span>);
        assert.deepEqual(dv, [[ <span class="hljs-number">1</span>, <span class="hljs-number">3</span> ], [ <span class="hljs-number">7</span> ], [ <span class="hljs-number">9</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span> ]]);
      });
      
      it(<span class="hljs-string">"Can get a single value out of an array using its index"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> dv;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Simple index in dot notation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dv = model.getDotValue({ planets: [ { name: <span class="hljs-string">'Earth'</span>, number: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">'Mars'</span>, number: <span class="hljs-number">2</span> }, { name: <span class="hljs-string">'Pluton'</span>, number: <span class="hljs-number">9</span> } ] }, <span class="hljs-string">'planets.1'</span>);
        assert.deepEqual(dv, { name: <span class="hljs-string">'Mars'</span>, number: <span class="hljs-number">2</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Out of bounds index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dv = model.getDotValue({ planets: [ { name: <span class="hljs-string">'Earth'</span>, number: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">'Mars'</span>, number: <span class="hljs-number">2</span> }, { name: <span class="hljs-string">'Pluton'</span>, number: <span class="hljs-number">9</span> } ] }, <span class="hljs-string">'planets.3'</span>);
        assert.isUndefined(dv);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Index in nested array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dv = model.getDotValue({ nedb: <span class="hljs-literal">true</span>, data: { planets: [ { name: <span class="hljs-string">'Earth'</span>, number: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">'Mars'</span>, number: <span class="hljs-number">2</span> }, { name: <span class="hljs-string">'Pluton'</span>, number: <span class="hljs-number">9</span> } ] } }, <span class="hljs-string">'data.planets.2'</span>);
        assert.deepEqual(dv, { name: <span class="hljs-string">'Pluton'</span>, number: <span class="hljs-number">9</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Dot notation with index in the middle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dv = model.getDotValue({ nedb: <span class="hljs-literal">true</span>, data: { planets: [ { name: <span class="hljs-string">'Earth'</span>, number: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">'Mars'</span>, number: <span class="hljs-number">2</span> }, { name: <span class="hljs-string">'Pluton'</span>, number: <span class="hljs-number">9</span> } ] } }, <span class="hljs-string">'data.planets.0.name'</span>);
        dv.should.equal(<span class="hljs-string">'Earth'</span>);
      });

    });


    describe(<span class="hljs-string">'Field equality'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Can find documents with simple fields'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ test: <span class="hljs-string">'yeah'</span> }, { test: <span class="hljs-string">'yea'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: <span class="hljs-string">'yeah'</span> }, { test: <span class="hljs-string">'yeahh'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: <span class="hljs-string">'yeah'</span> }, { test: <span class="hljs-string">'yeah'</span> }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Can find documents with the dot-notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ test: { ooo: <span class="hljs-string">'yeah'</span> } }, { <span class="hljs-string">"test.ooo"</span>: <span class="hljs-string">'yea'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: { ooo: <span class="hljs-string">'yeah'</span> } }, { <span class="hljs-string">"test.oo"</span>: <span class="hljs-string">'yeah'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: { ooo: <span class="hljs-string">'yeah'</span> } }, { <span class="hljs-string">"tst.ooo"</span>: <span class="hljs-string">'yeah'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: { ooo: <span class="hljs-string">'yeah'</span> } }, { <span class="hljs-string">"test.ooo"</span>: <span class="hljs-string">'yeah'</span> }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Cannot find undefined'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ test: <span class="hljs-literal">undefined</span> }, { test: <span class="hljs-literal">undefined</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: { pp: <span class="hljs-literal">undefined</span> } }, { <span class="hljs-string">"test.pp"</span>: <span class="hljs-literal">undefined</span> }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Nested objects are deep-equality matched and not treated as sub-queries'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: { b: <span class="hljs-number">5</span> } }, { a: { b: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: { b: <span class="hljs-number">5</span>, c: <span class="hljs-number">3</span> } }, { a: { b: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">false</span>);

        model.match({ a: { b: <span class="hljs-number">5</span> } }, { a: { b: { $lt: <span class="hljs-number">10</span> } } }).should.equal(<span class="hljs-literal">false</span>);
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: { b: <span class="hljs-number">5</span> } }, { a: { $or: [ { b: <span class="hljs-number">10</span> }, { b: <span class="hljs-number">5</span> } ] } }) }).should.throw();
      });
      
      it(<span class="hljs-string">"Can match for field equality inside an array with the dot notation"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-literal">true</span>, b: [ <span class="hljs-string">'node'</span>, <span class="hljs-string">'embedded'</span>, <span class="hljs-string">'database'</span> ] }, { <span class="hljs-string">'b.1'</span>: <span class="hljs-string">'node'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-literal">true</span>, b: [ <span class="hljs-string">'node'</span>, <span class="hljs-string">'embedded'</span>, <span class="hljs-string">'database'</span> ] }, { <span class="hljs-string">'b.1'</span>: <span class="hljs-string">'embedded'</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-literal">true</span>, b: [ <span class="hljs-string">'node'</span>, <span class="hljs-string">'embedded'</span>, <span class="hljs-string">'database'</span> ] }, { <span class="hljs-string">'b.1'</span>: <span class="hljs-string">'database'</span> }).should.equal(<span class="hljs-literal">false</span>);
      })

    });


    describe(<span class="hljs-string">'Regular expression matching'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Matching a non-string to a regular expression always yields false'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
          , r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(d.getTime());

        model.match({ test: <span class="hljs-literal">true</span> }, { test: <span class="hljs-regexp">/true/</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: <span class="hljs-literal">null</span> }, { test: <span class="hljs-regexp">/null/</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: <span class="hljs-number">42</span> }, { test: <span class="hljs-regexp">/42/</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: d }, { test: r }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Can match strings using basic querying'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ test: <span class="hljs-string">'true'</span> }, { test: <span class="hljs-regexp">/true/</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ test: <span class="hljs-string">'babaaaar'</span> }, { test: <span class="hljs-regexp">/aba+r/</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ test: <span class="hljs-string">'babaaaar'</span> }, { test: <span class="hljs-regexp">/^aba+r/</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: <span class="hljs-string">'true'</span> }, { test: <span class="hljs-regexp">/t[ru]e/</span> }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Can match strings using the $regex operator'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ test: <span class="hljs-string">'true'</span> }, { test: { $regex: <span class="hljs-regexp">/true/</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ test: <span class="hljs-string">'babaaaar'</span> }, { test: { $regex: <span class="hljs-regexp">/aba+r/</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ test: <span class="hljs-string">'babaaaar'</span> }, { test: { $regex: <span class="hljs-regexp">/^aba+r/</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ test: <span class="hljs-string">'true'</span> }, { test: { $regex: <span class="hljs-regexp">/t[ru]e/</span> } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Will throw if $regex operator is used with a non regex value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          model.match({ test: <span class="hljs-string">'true'</span> }, { test: { $regex: <span class="hljs-number">42</span> } })
        }).should.throw();

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          model.match({ test: <span class="hljs-string">'true'</span> }, { test: { $regex: <span class="hljs-string">'true'</span> } })
        }).should.throw();
      });

      it(<span class="hljs-string">'Can use the $regex operator in cunjunction with other operators'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ test: <span class="hljs-string">'helLo'</span> }, { test: { $regex: <span class="hljs-regexp">/ll/i</span>, $nin: [<span class="hljs-string">'helL'</span>, <span class="hljs-string">'helLop'</span>] } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ test: <span class="hljs-string">'helLo'</span> }, { test: { $regex: <span class="hljs-regexp">/ll/i</span>, $nin: [<span class="hljs-string">'helLo'</span>, <span class="hljs-string">'helLop'</span>] } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Can use dot-notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ test: { nested: <span class="hljs-string">'true'</span> } }, { <span class="hljs-string">'test.nested'</span>: <span class="hljs-regexp">/true/</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ test: { nested: <span class="hljs-string">'babaaaar'</span> } }, { <span class="hljs-string">'test.nested'</span>: <span class="hljs-regexp">/^aba+r/</span> }).should.equal(<span class="hljs-literal">false</span>);

        model.match({ test: { nested: <span class="hljs-string">'true'</span> } }, { <span class="hljs-string">'test.nested'</span>: { $regex: <span class="hljs-regexp">/true/</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ test: { nested: <span class="hljs-string">'babaaaar'</span> } }, { <span class="hljs-string">'test.nested'</span>: { $regex: <span class="hljs-regexp">/^aba+r/</span> } }).should.equal(<span class="hljs-literal">false</span>);
      });

    });


    describe(<span class="hljs-string">'$lt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Cannot compare a field to an object, an array, null or a boolean, it will return false'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lt: { a: <span class="hljs-number">6</span> } } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lt: [<span class="hljs-number">6</span>, <span class="hljs-number">7</span>] } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lt: <span class="hljs-literal">null</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lt: <span class="hljs-literal">true</span> } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Can compare numbers, with or without dot notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lt: <span class="hljs-number">6</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lt: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lt: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">false</span>);

        model.match({ a: { b: <span class="hljs-number">5</span> } }, { <span class="hljs-string">"a.b"</span>: { $lt: <span class="hljs-number">6</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: { b: <span class="hljs-number">5</span> } }, { <span class="hljs-string">"a.b"</span>: { $lt: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Can compare strings, with or without dot notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-string">"nedb"</span> }, { a: { $lt: <span class="hljs-string">"nedc"</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-string">"nedb"</span> }, { a: { $lt: <span class="hljs-string">"neda"</span> } }).should.equal(<span class="hljs-literal">false</span>);

        model.match({ a: { b: <span class="hljs-string">"nedb"</span> } }, { <span class="hljs-string">"a.b"</span>: { $lt: <span class="hljs-string">"nedc"</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: { b: <span class="hljs-string">"nedb"</span> } }, { <span class="hljs-string">"a.b"</span>: { $lt: <span class="hljs-string">"neda"</span> } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'If field is an array field, a match means a match on at least one element'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: [<span class="hljs-number">5</span>, <span class="hljs-number">10</span>] }, { a: { $lt: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: [<span class="hljs-number">5</span>, <span class="hljs-number">10</span>] }, { a: { $lt: <span class="hljs-number">6</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: [<span class="hljs-number">5</span>, <span class="hljs-number">10</span>] }, { a: { $lt: <span class="hljs-number">11</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Works with dates too'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1000</span>) }, { a: { $gte: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1001</span>) } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1000</span>) }, { a: { $lt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1001</span>) } }).should.equal(<span class="hljs-literal">true</span>);
      });

    });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>General behaviour is tested in the block about $lt. Here we just test operators work</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'Other comparison operators: $lte, $gt, $gte, $ne, $in, $exists'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'$lte'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lte: <span class="hljs-number">6</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lte: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $lte: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'$gt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $gt: <span class="hljs-number">6</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $gt: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $gt: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'$gte'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $gte: <span class="hljs-number">6</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $gte: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $gte: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'$ne'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $ne: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $ne: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { b: { $ne: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'$in'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $<span class="hljs-keyword">in</span>: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">6</span> }, { a: { $<span class="hljs-keyword">in</span>: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">7</span> }, { a: { $<span class="hljs-keyword">in</span>: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">8</span> }, { a: { $<span class="hljs-keyword">in</span>: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">9</span> }, { a: { $<span class="hljs-keyword">in</span>: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">true</span>);

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: <span class="hljs-number">5</span> }, { a: { $<span class="hljs-keyword">in</span>: <span class="hljs-number">5</span> } }); }).should.throw();
      });

      it(<span class="hljs-string">'$nin'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $nin: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">6</span> }, { a: { $nin: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">7</span> }, { a: { $nin: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">8</span> }, { a: { $nin: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">9</span> }, { a: { $nin: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Matches if field doesn’t exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        model.match({ a: <span class="hljs-number">9</span> }, { b: { $nin: [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] } }).should.equal(<span class="hljs-literal">true</span>);

        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: <span class="hljs-number">5</span> }, { a: { $<span class="hljs-keyword">in</span>: <span class="hljs-number">5</span> } }); }).should.throw();
      });

      it(<span class="hljs-string">'$exists'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-number">1</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-literal">true</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-string">''</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: [] } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: {} } }).should.equal(<span class="hljs-literal">true</span>);

        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-number">0</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-literal">false</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-literal">null</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ a: <span class="hljs-number">5</span> }, { a: { $exists: <span class="hljs-literal">undefined</span> } }).should.equal(<span class="hljs-literal">false</span>);

        model.match({ a: <span class="hljs-number">5</span> }, { b: { $exists: <span class="hljs-literal">true</span> } }).should.equal(<span class="hljs-literal">false</span>);

        model.match({ a: <span class="hljs-number">5</span> }, { b: { $exists: <span class="hljs-literal">false</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });

    });

    
    describe(<span class="hljs-string">'Query operator array $size'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

        it(<span class="hljs-string">'Can query on the size of an array field'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Non nested documents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">0</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">1</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">2</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Nested documents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          model.match({ hello: <span class="hljs-string">'world'</span>, description: { satellites: [<span class="hljs-string">'Moon'</span>, <span class="hljs-string">'Hubble'</span>], diameter: <span class="hljs-number">6300</span> } }, { <span class="hljs-string">"description.satellites"</span>: { $size: <span class="hljs-number">0</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ hello: <span class="hljs-string">'world'</span>, description: { satellites: [<span class="hljs-string">'Moon'</span>, <span class="hljs-string">'Hubble'</span>], diameter: <span class="hljs-number">6300</span> } }, { <span class="hljs-string">"description.satellites"</span>: { $size: <span class="hljs-number">1</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ hello: <span class="hljs-string">'world'</span>, description: { satellites: [<span class="hljs-string">'Moon'</span>, <span class="hljs-string">'Hubble'</span>], diameter: <span class="hljs-number">6300</span> } }, { <span class="hljs-string">"description.satellites"</span>: { $size: <span class="hljs-number">2</span> } }).should.equal(<span class="hljs-literal">true</span>);
          model.match({ hello: <span class="hljs-string">'world'</span>, description: { satellites: [<span class="hljs-string">'Moon'</span>, <span class="hljs-string">'Hubble'</span>], diameter: <span class="hljs-number">6300</span> } }, { <span class="hljs-string">"description.satellites"</span>: { $size: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Using a projected array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.names"</span>: { $size: <span class="hljs-number">0</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.names"</span>: { $size: <span class="hljs-number">1</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.names"</span>: { $size: <span class="hljs-number">2</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.names"</span>: { $size: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">true</span>);
        });

        it(<span class="hljs-string">'$size operator works with empty arrays'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          model.match({ childrens: [] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">0</span> } }).should.equal(<span class="hljs-literal">true</span>);
          model.match({ childrens: [] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">2</span> } }).should.equal(<span class="hljs-literal">false</span>);
          model.match({ childrens: [] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">false</span>);
        });

        it(<span class="hljs-string">'Should throw an error if a query operator is used without comparing to an integer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>] }, { a: { $size: <span class="hljs-number">1.4</span> } }); }).should.throw();
          (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>] }, { a: { $size: <span class="hljs-string">'fdf'</span> } }); }).should.throw();
          (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>] }, { a: { $size: { $lt: <span class="hljs-number">5</span> } } }); }).should.throw();
        });

        it(<span class="hljs-string">'Using $size operator on a non-array field should prevent match but not throw'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          model.match({ a: <span class="hljs-number">5</span> }, { a: { $size: <span class="hljs-number">1</span> } }).should.equal(<span class="hljs-literal">false</span>);
        });
        
        it(<span class="hljs-string">'Can use $size several times in the same matcher'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          model.match({ childrens: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">3</span>, $size: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">true</span>);
          model.match({ childrens: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { <span class="hljs-string">"childrens"</span>: { $size: <span class="hljs-number">3</span>, $size: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">false</span>);   <span class="hljs-comment">// Of course this can never be true</span>
        });
        
    });
    

    describe(<span class="hljs-string">'Logical operators $or, $and, $not'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Any of the subqueries should match for an $or to match'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ hello: <span class="hljs-string">'world'</span> }, { $or: [ { hello: <span class="hljs-string">'pluton'</span> }, { hello: <span class="hljs-string">'world'</span> } ] }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ hello: <span class="hljs-string">'pluton'</span> }, { $or: [ { hello: <span class="hljs-string">'pluton'</span> }, { hello: <span class="hljs-string">'world'</span> } ] }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ hello: <span class="hljs-string">'nope'</span> }, { $or: [ { hello: <span class="hljs-string">'pluton'</span> }, { hello: <span class="hljs-string">'world'</span> } ] }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ hello: <span class="hljs-string">'world'</span>, age: <span class="hljs-number">15</span> }, { $or: [ { hello: <span class="hljs-string">'pluton'</span> }, { age: { $lt: <span class="hljs-number">20</span> } } ] }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ hello: <span class="hljs-string">'world'</span>, age: <span class="hljs-number">15</span> }, { $or: [ { hello: <span class="hljs-string">'pluton'</span> }, { age: { $lt: <span class="hljs-number">10</span> } } ] }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'All of the subqueries should match for an $and to match'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ hello: <span class="hljs-string">'world'</span>, age: <span class="hljs-number">15</span> }, { $and: [ { age: <span class="hljs-number">15</span> }, { hello: <span class="hljs-string">'world'</span> } ] }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ hello: <span class="hljs-string">'world'</span>, age: <span class="hljs-number">15</span> }, { $and: [ { age: <span class="hljs-number">16</span> }, { hello: <span class="hljs-string">'world'</span> } ] }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ hello: <span class="hljs-string">'world'</span>, age: <span class="hljs-number">15</span> }, { $and: [ { hello: <span class="hljs-string">'world'</span> }, { age: { $lt: <span class="hljs-number">20</span> } } ] }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ hello: <span class="hljs-string">'world'</span>, age: <span class="hljs-number">15</span> }, { $and: [ { hello: <span class="hljs-string">'pluton'</span> }, { age: { $lt: <span class="hljs-number">20</span> } } ] }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Subquery should not match for a $not to match'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span>, b: <span class="hljs-number">10</span> }, { a: <span class="hljs-number">5</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span>, b: <span class="hljs-number">10</span> }, { $not: { a: <span class="hljs-number">5</span> } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Logical operators are all top-level, only other logical operators can be above'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: { b: <span class="hljs-number">7</span> } }, { a: { $or: [ { b: <span class="hljs-number">5</span> }, { b: <span class="hljs-number">7</span> } ] } })}).should.throw();
        model.match({ a: { b: <span class="hljs-number">7</span> } }, { $or: [ { <span class="hljs-string">"a.b"</span>: <span class="hljs-number">5</span> }, { <span class="hljs-string">"a.b"</span>: <span class="hljs-number">7</span> } ] }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Logical operators can be combined as long as they are on top of the decision tree'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">5</span>, b: <span class="hljs-number">7</span>, c: <span class="hljs-number">12</span> }, { $or: [ { $and: [ { a: <span class="hljs-number">5</span> }, { b: <span class="hljs-number">8</span> } ] }, { $and: [{ a: <span class="hljs-number">5</span> }, { c : { $lt: <span class="hljs-number">40</span> } }] } ] }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">5</span>, b: <span class="hljs-number">7</span>, c: <span class="hljs-number">12</span> }, { $or: [ { $and: [ { a: <span class="hljs-number">5</span> }, { b: <span class="hljs-number">8</span> } ] }, { $and: [{ a: <span class="hljs-number">5</span> }, { c : { $lt: <span class="hljs-number">10</span> } }] } ] }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Should throw an error if a logical operator is used without an array or if an unknown logical operator is used'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: <span class="hljs-number">5</span> }, { $or: { a: <span class="hljs-number">5</span>, a: <span class="hljs-number">6</span> } }); }).should.throw();
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: <span class="hljs-number">5</span> }, { $and: { a: <span class="hljs-number">5</span>, a: <span class="hljs-number">6</span> } }); }).should.throw();
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: <span class="hljs-number">5</span> }, { $unknown: [ { a: <span class="hljs-number">5</span> } ] }); }).should.throw();
      });

    });


    describe(<span class="hljs-string">'Comparison operator $where'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Function should match and not match correctly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ a: <span class="hljs-number">4</span>}, { $where: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.a === <span class="hljs-number">4</span>; } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ a: <span class="hljs-number">4</span>}, { $where: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.a === <span class="hljs-number">5</span>; } }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'Should throw an error if the $where function is not, in fact, a function'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: <span class="hljs-number">4</span> }, { $where: <span class="hljs-string">'not a function'</span> }); }).should.throw();
      });

      it(<span class="hljs-string">'Should throw an error if the $where function returns a non-boolean'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ a: <span class="hljs-number">4</span> }, { $where: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">'not a boolean'</span>; } }); }).should.throw();
      });
      
      it(<span class="hljs-string">'Should be able to do the complex matching it must be used for'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> checkEmail = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.firstName || !<span class="hljs-keyword">this</span>.lastName) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firstName.toLowerCase() + <span class="hljs-string">"."</span> + <span class="hljs-keyword">this</span>.lastName.toLowerCase() + <span class="hljs-string">"@gmail.com"</span> === <span class="hljs-keyword">this</span>.email;
        };
        model.match({ firstName: <span class="hljs-string">"John"</span>, lastName: <span class="hljs-string">"Doe"</span>, email: <span class="hljs-string">"john.doe@gmail.com"</span> }, { $where: checkEmail }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ firstName: <span class="hljs-string">"john"</span>, lastName: <span class="hljs-string">"doe"</span>, email: <span class="hljs-string">"john.doe@gmail.com"</span> }, { $where: checkEmail }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ firstName: <span class="hljs-string">"Jane"</span>, lastName: <span class="hljs-string">"Doe"</span>, email: <span class="hljs-string">"john.doe@gmail.com"</span> }, { $where: checkEmail }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ firstName: <span class="hljs-string">"John"</span>, lastName: <span class="hljs-string">"Deere"</span>, email: <span class="hljs-string">"john.doe@gmail.com"</span> }, { $where: checkEmail }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ lastName: <span class="hljs-string">"Doe"</span>, email: <span class="hljs-string">"john.doe@gmail.com"</span> }, { $where: checkEmail }).should.equal(<span class="hljs-literal">false</span>);
      });

    });


    describe(<span class="hljs-string">'Array fields'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

      it(<span class="hljs-string">'Field equality'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ tags: [<span class="hljs-string">'node'</span>, <span class="hljs-string">'js'</span>, <span class="hljs-string">'db'</span>] }, { tags: <span class="hljs-string">'python'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ tags: [<span class="hljs-string">'node'</span>, <span class="hljs-string">'js'</span>, <span class="hljs-string">'db'</span>] }, { tagss: <span class="hljs-string">'js'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ tags: [<span class="hljs-string">'node'</span>, <span class="hljs-string">'js'</span>, <span class="hljs-string">'db'</span>] }, { tags: <span class="hljs-string">'js'</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ tags: [<span class="hljs-string">'node'</span>, <span class="hljs-string">'js'</span>, <span class="hljs-string">'db'</span>] }, { tags: <span class="hljs-string">'js'</span>, tags: <span class="hljs-string">'node'</span> }).should.equal(<span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Mixed matching with array and non array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        model.match({ tags: [<span class="hljs-string">'node'</span>, <span class="hljs-string">'js'</span>, <span class="hljs-string">'db'</span>], nedb: <span class="hljs-literal">true</span> }, { tags: <span class="hljs-string">'js'</span>, nedb: <span class="hljs-literal">true</span> }).should.equal(<span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Nested matching</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        model.match({ number: <span class="hljs-number">5</span>, data: { tags: [<span class="hljs-string">'node'</span>, <span class="hljs-string">'js'</span>, <span class="hljs-string">'db'</span>] } }, { <span class="hljs-string">"data.tags"</span>: <span class="hljs-string">'js'</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ number: <span class="hljs-number">5</span>, data: { tags: [<span class="hljs-string">'node'</span>, <span class="hljs-string">'js'</span>, <span class="hljs-string">'db'</span>] } }, { <span class="hljs-string">"data.tags"</span>: <span class="hljs-string">'j'</span> }).should.equal(<span class="hljs-literal">false</span>);
      });

      it(<span class="hljs-string">'With one comparison operator'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] }, { ages: { $lt: <span class="hljs-number">2</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] }, { ages: { $lt: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] }, { ages: { $lt: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] }, { ages: { $lt: <span class="hljs-number">8</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] }, { ages: { $lt: <span class="hljs-number">13</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Works with arrays that are in subdocuments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ children: { ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] } }, { <span class="hljs-string">"children.ages"</span>: { $lt: <span class="hljs-number">2</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ children: { ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] } }, { <span class="hljs-string">"children.ages"</span>: { $lt: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ children: { ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] } }, { <span class="hljs-string">"children.ages"</span>: { $lt: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ children: { ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] } }, { <span class="hljs-string">"children.ages"</span>: { $lt: <span class="hljs-number">8</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ children: { ages: [<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>] } }, { <span class="hljs-string">"children.ages"</span>: { $lt: <span class="hljs-number">13</span> } }).should.equal(<span class="hljs-literal">true</span>);
      });

      it(<span class="hljs-string">'Can query inside arrays thanks to dot notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.age"</span>: { $lt: <span class="hljs-number">2</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.age"</span>: { $lt: <span class="hljs-number">3</span> } }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.age"</span>: { $lt: <span class="hljs-number">4</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.age"</span>: { $lt: <span class="hljs-number">8</span> } }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.age"</span>: { $lt: <span class="hljs-number">13</span> } }).should.equal(<span class="hljs-literal">true</span>);
        
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.name"</span>: <span class="hljs-string">'Louis'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.name"</span>: <span class="hljs-string">'Louie'</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.name"</span>: <span class="hljs-string">'Lewi'</span> }).should.equal(<span class="hljs-literal">false</span>);
      });
      
      it(<span class="hljs-string">'Can query for a specific element inside arrays thanks to dot notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.0.name"</span>: <span class="hljs-string">'Louie'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.1.name"</span>: <span class="hljs-string">'Louie'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.2.name"</span>: <span class="hljs-string">'Louie'</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ childrens: [ { name: <span class="hljs-string">"Huey"</span>, age: <span class="hljs-number">3</span> }, { name: <span class="hljs-string">"Dewey"</span>, age: <span class="hljs-number">7</span> }, { name: <span class="hljs-string">"Louie"</span>, age: <span class="hljs-number">12</span> } ] }, { <span class="hljs-string">"childrens.3.name"</span>: <span class="hljs-string">'Louie'</span> }).should.equal(<span class="hljs-literal">false</span>);
      });
      
      it(<span class="hljs-string">'A single array-specific operator and the query is treated as array specific'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ model.match({ childrens: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { <span class="hljs-string">"childrens"</span>: { <span class="hljs-string">"Fifi"</span>: <span class="hljs-literal">true</span>, $size: <span class="hljs-number">3</span> } })}).should.throw();
      });
      
      it(<span class="hljs-string">'Can mix queries on array fields and non array filds with array specific operators'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        model.match({ uncle: <span class="hljs-string">'Donald'</span>, nephews: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { nephews: { $size: <span class="hljs-number">2</span> }, uncle: <span class="hljs-string">'Donald'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ uncle: <span class="hljs-string">'Donald'</span>, nephews: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { nephews: { $size: <span class="hljs-number">3</span> }, uncle: <span class="hljs-string">'Donald'</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ uncle: <span class="hljs-string">'Donald'</span>, nephews: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { nephews: { $size: <span class="hljs-number">4</span> }, uncle: <span class="hljs-string">'Donald'</span> }).should.equal(<span class="hljs-literal">false</span>);

        model.match({ uncle: <span class="hljs-string">'Donals'</span>, nephews: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { nephews: { $size: <span class="hljs-number">3</span> }, uncle: <span class="hljs-string">'Picsou'</span> }).should.equal(<span class="hljs-literal">false</span>);
        model.match({ uncle: <span class="hljs-string">'Donald'</span>, nephews: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { nephews: { $size: <span class="hljs-number">3</span> }, uncle: <span class="hljs-string">'Donald'</span> }).should.equal(<span class="hljs-literal">true</span>);
        model.match({ uncle: <span class="hljs-string">'Donald'</span>, nephews: [ <span class="hljs-string">'Riri'</span>, <span class="hljs-string">'Fifi'</span>, <span class="hljs-string">'Loulou'</span> ] }, { nephews: { $size: <span class="hljs-number">3</span> }, uncle: <span class="hljs-string">'Daisy'</span> }).should.equal(<span class="hljs-literal">false</span>);
      });
      
    });

  });   <span class="hljs-comment">// ==== End of 'Querying' ==== //</span>

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
